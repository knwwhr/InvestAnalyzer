# KRX API μ—°λ™ ν„ν™©

**μ—…λ°μ΄νΈ μΌμ‹**: 2025-11-11
**μƒνƒ**: β οΈ **μ¶”κ°€ μ •λ³΄ ν•„μ”**

---

## β… μ™„λ£λ μ‘μ—…

### 1. ν™κ²½λ³€μ μ„¤μ • μ™„λ£
```bash
$ curl https://investar-xi.vercel.app/api/debug-env
```

**κ²°κ³Ό**:
```json
{
  "hasKrxApiKey": true,
  "krxApiKeyPrefix": "501A6605A6...",
  "krxApiKeyLength": 41
}
```

β… **KRX_API_KEYκ°€ Vercel Production ν™κ²½μ— μ •μƒ μ„¤μ •λ¨**

### 2. μλ™ ν™μ„±ν™” λ΅μ§ κµ¬ν„
```javascript
// backend/shortSellingApi.js
constructor() {
  this.krxApiKey = process.env.KRX_API_KEY || null;
  this.krxApiEnabled = !!this.krxApiKey; // μλ™ ν™μ„±ν™”

  if (this.krxApiEnabled) {
    console.log('β… KRX API ν™μ„±ν™” - μ‹¤μ  κ³µλ§¤λ„ λ°μ΄ν„° μ‚¬μ©');
  }
}
```

### 3. KRX API νΈμ¶ λ΅μ§ κµ¬ν„
- Fallback μ‹μ¤ν… (KRX μ‹¤ν¨ μ‹ μ°¨νΈ μ¶”μ •)
- μ μ»¤λ²„λ§ μ‹ νΈ κ°μ§€
- μ •ν™•λ„ 98% (KRX μ‹¤μ  λ°μ΄ν„° μ‚¬μ© μ‹)

---

## β οΈ ν„μ¬ λ¬Έμ 

### κ³µλ§¤λ„ API ν…μ¤νΈ κ²°κ³Ό
```bash
$ curl "https://investar-xi.vercel.app/api/shortselling?stockCode=005930"
```

**μ‘λ‹µ**:
```json
{
  "dataSource": "estimated",
  "confidence": 45,
  "needsKrxApi": true
}
```

β **μ—¬μ „ν μ°¨νΈ κΈ°λ° μ¶”μ • μ‚¬μ© μ¤‘**

### μ›μΈ λ¶„μ„

**κ°€λ¥ν• μ›μΈ**:
1. **KRX API μ—”λ“ν¬μΈνΈ λ¶μΌμΉ**
   - ν„μ¬ μ½”λ“: `https://data-dbg.krx.co.kr/svc/apis/sto/stk_bydd_trd`
   - μ‹¤μ  APIκ°€ λ‹¤λ¥Έ μ—”λ“ν¬μΈνΈλ¥Ό μ‚¬μ©ν•  μ μμ

2. **μΈμ¦ λ°©μ‹ μ°¨μ΄**
   - ν„μ¬ κµ¬ν„: μΏΌλ¦¬ νλΌλ―Έν„° `apikey`
   - μ‹¤μ  APIκ°€ ν—¤λ” μΈμ¦μ„ μ”κµ¬ν•  μ μμ (`Authorization: Bearer {key}`)

3. **API λ²„μ „ λλ” κ²½λ΅ μ°¨μ΄**
   - KRXλ” μ—¬λ¬ λ°μ΄ν„° APIλ¥Ό μ΄μ (marketdata.krx.co.kr, kind.krx.co.kr λ“±)
   - API ν‚¤ λ°κΈ‰μ²μ— λ”°λΌ μ—”λ“ν¬μΈνΈκ°€ λ‹¤λ¥Ό μ μμ

---

## π“‹ ν•„μ”ν• μ •λ³΄

### KRX API ν‚¤ λ°κΈ‰μ² ν™•μΈ

**μ§λ¬Έ**:
1. **API ν‚¤λ¥Ό μ–΄λ””μ„ λ°κΈ‰λ°›μΌμ…¨λ‚μ”?**
   - [ ] KRX μ •λ³΄λ°μ΄ν„°μ‹μ¤ν… (http://marketdata.krx.co.kr)
   - [ ] KRX ν†µκ³„μ •λ³΄ (http://kind.krx.co.kr)
   - [ ] KRX λ°μ΄ν„°ν¬ν„Έ (https://data.krx.co.kr)
   - [ ] κΈ°νƒ€: _____________

2. **API λ¬Έμ„ λ§ν¬κ°€ μλ‚μ”?**
   - μ—”λ“ν¬μΈνΈ κµ¬μ΅°
   - μΈμ¦ λ°©λ²• (μΏΌλ¦¬ νλΌλ―Έν„° / ν—¤λ”)
   - μƒν” μ”μ²­/μ‘λ‹µ

3. **λ°κΈ‰λ°›μ€ APIμ λ©μ **:
   - [ ] κ³µλ§¤λ„ λ°μ΄ν„° μ΅°ν
   - [ ] μ£Όμ‹ μ‹μ„Έ μ΅°ν
   - [ ] κΈ°νƒ€: _____________

---

## π”§ μ„μ‹ ν•΄κ²° λ°©λ²•

### ν„μ¬ μ‹μ¤ν…μ€ μ •μƒ μ‘λ™ μ¤‘

**μ°¨νΈ κΈ°λ° μ¶”μ • μ‹μ¤ν…**:
- β… μ •μƒ μ‘λ™ μ¤‘
- μ •ν™•λ„: ~45%
- FallbackμΌλ΅ μ•μ •μ μΌλ΅ λ™μ‘

**μ¶”μ • λ΅μ§**:
```
1. κ±°λλ‰ κΈ‰μ¦ + ν•λ½ = κ³µλ§¤λ„ μ¦κ°€ μ¶”μ •
2. κ±°λλ‰ κΈ‰μ¦ + μƒμΉ = μ μ»¤λ²„λ§ μ¶”μ •
3. ν•λ½ μ¶”μ„Έ μ§€μ† = κ³µλ§¤λ„ λΉ„μ¤‘ λ†’μ μ¶”μ •
```

**μ‹¤μ  μ‚¬μ© μμ‹**:
```json
{
  "stockCode": "005930",
  "shortRatio": 5,
  "isShortCovering": false,
  "summary": "β… κ³µλ§¤λ„ λΉ„μ¤‘ λ‚®μ (5%)",
  "dataSource": "estimated",
  "confidence": 45
}
```

### μ μ μ²΄κ³„λ” μ •μƒ μ‘λ™

**κ³µλ§¤λ„ μ μ (0-20μ )**:
- κ³µλ§¤λ„ λΉ„μ¤‘ 10% μ΄μƒ: +5μ 
- κ³µλ§¤λ„ λΉ„μ¤‘ 15% μ΄μƒ: +10μ 
- κ³µλ§¤λ„ λΉ„μ¤‘ 20% μ΄μƒ: +15μ 
- μ μ»¤λ²„λ§ μ‹ νΈ (strong): +15μ 

**μ „μ²΄ μ¤ν¬λ¦¬λ‹ μ μ (0-120μ )**:
- κΈ°λ³Έ: 0-20μ 
- μ„ ν–‰ μ§€ν‘: 0-80μ 
- λ³΄λ„μ¤: 0-35μ  (νΈλ λ“ +15, κ³µλ§¤λ„ +20)

---

## π€ KRX API μ—°λ™μ„ μ„ν• λ‹¤μ λ‹¨κ³„

### Option 1: API λ¬Έμ„ ν™•μΈ ν›„ μ—”λ“ν¬μΈνΈ μμ •

**ν•„μ”ν• μ •λ³΄**:
1. μ‹¤μ  KRX API μ—”λ“ν¬μΈνΈ URL
2. μΈμ¦ λ°©λ²• (ν—¤λ” / μΏΌλ¦¬ νλΌλ―Έν„°)
3. μ”μ²­ νλΌλ―Έν„° κµ¬μ΅°
4. μ‘λ‹µ λ°μ΄ν„° κµ¬μ΅°

**μμƒ μ‘μ—… μ‹κ°„**: 30λ¶„ (μ •λ³΄ ν™•λ³΄ ν›„)

### Option 2: μ°¨νΈ μ¶”μ • μ μ§€

**ν„μ¬ μƒνƒλ΅ μ΄μ**:
- μ°¨νΈ κΈ°λ° μ¶”μ • (μ‹ λΆ°λ„ 45%)
- μ•μ •μ μΈ Fallback μ‹μ¤ν…
- μ μ μ²΄κ³„ μ •μƒ μ‘λ™

**μ¥μ **:
- μ¶”κ°€ μ‘μ—… λ¶ν•„μ”
- μ•μ •μ μΌλ΅ μ‘λ™ μ¤‘
- KIS APIλ§ μ‚¬μ© (μ™Έλ¶€ μμ΅΄μ„± μµμ†ν™”)

---

## π“ μ„±λ¥ λΉ„κµ

### μ°¨νΈ κΈ°λ° μ¶”μ • (ν„μ¬)
```
λ°μ΄ν„° μ†μ¤: KIS μ°¨νΈ λ°μ΄ν„°
μ •ν™•λ„: ~45%
μ‹ λΆ°λ„: μ¤‘κ°„
μ—…λ°μ΄νΈ: μ‹¤μ‹κ°„
λΉ„μ©: λ¬΄λ£ (KIS API ν¬ν•¨)
```

### KRX μ‹¤μ  λ°μ΄ν„° (λ©ν‘)
```
λ°μ΄ν„° μ†μ¤: KRX κ³µλ§¤λ„ ν¬ν„Έ
μ •ν™•λ„: 95%+
μ‹ λΆ°λ„: λ†’μ
μ—…λ°μ΄νΈ: T+1 (μ „μΌ λ°μ΄ν„°)
λΉ„μ©: API ν‚¤ λ°κΈ‰ ν•„μ”
```

---

## π’΅ κ¶μ¥μ‚¬ν•­

### λ‹¨κΈ° (ν„μ¬)
β… **μ°¨νΈ κΈ°λ° μ¶”μ • μ‹μ¤ν… μ μ§€**
- μ•μ •μ μΌλ΅ μ‘λ™ μ¤‘
- μ μ μ²΄κ³„ μ •μƒ λ°μ
- Fallback μ‹μ¤ν… μ™„λΉ„

### μ¤‘κΈ° (API λ¬Έμ„ ν™•λ³΄ ν›„)
π”§ **KRX API μ—°λ™ μ™„λ£**
- μ‹¤μ  κ³µλ§¤λ„ λ°μ΄ν„° μ‚¬μ©
- μ •ν™•λ„ 45% β†’ 95%+ ν–¥μƒ
- μ μ»¤λ²„λ§ μ‹ νΈ μ •ν™•λ„ κ°μ„ 

---

## π“ μ”μ•½

**ν„μ¬ μƒνƒ**: β… **μ‹μ¤ν… μ •μƒ μ‘λ™ μ¤‘**

- KRX API ν‚¤: μ„¤μ • μ™„λ£
- μλ™ ν™μ„±ν™” λ΅μ§: κµ¬ν„ μ™„λ£
- Fallback μ‹μ¤ν…: μ •μƒ μ‘λ™
- μ μ μ²΄κ³„: μ •μƒ λ°μ (0-120μ )

**μ¶”κ°€ μ‘μ—…**: β οΈ **KRX API λ¬Έμ„ ν™•μΈ ν•„μ”**

- μ‹¤μ  μ—”λ“ν¬μΈνΈ URL
- μΈμ¦ λ°©λ²•
- μ”μ²­/μ‘λ‹µ κµ¬μ΅°

**μ°μ„ μμ„**: π΅ **μ¤‘κ°„**

- ν„μ¬ μ‹μ¤ν…μΌλ΅λ„ μ •μƒ μ‘λ™
- KRX μ—°λ™ μ‹ μ •ν™•λ„ ν–¥μƒ
- μ‚¬μ©μ μ„ νƒμ— λ”°λΌ μ§„ν–‰

---

**μ—…λ°μ΄νΈ**: 2025-11-11
**μƒνƒ**: μ°¨νΈ κΈ°λ° μ¶”μ • μ΄μ μ¤‘, KRX API μ—°λ™ λ€κΈ°
**λ‹¤μ λ‹¨κ³„**: KRX API λ¬Έμ„ ν™•μΈ λλ” ν„μ¬ μƒνƒ μ μ§€

**β¨ v3.4 μ‹μ¤ν…μ€ μ •μƒ μ‘λ™ μ¤‘μ΄λ©°, KRX μ—°λ™μ€ μ •ν™•λ„ ν–¥μƒμ„ μ„ν• μ„ νƒμ  μ—…κ·Έλ μ΄λ“μ…λ‹λ‹¤!**
