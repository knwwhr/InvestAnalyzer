<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stock Volume Analyzer - AI ì¶”ì²œ ì¢…ëª©</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
    }

    .stock-card {
      transition: all 0.3s ease;
    }

    .stock-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .pulse-animation {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: .5; }
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .slide-in {
      animation: slideIn 0.5s ease-out;
    }

    .grade-S { background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%); }
    .grade-A { background: linear-gradient(135deg, #00cc00 0%, #008800 100%); }
    .grade-B { background: linear-gradient(135deg, #ffaa00 0%, #ff8800 100%); }
    .grade-C { background: linear-gradient(135deg, #888888 0%, #666666 100%); }
    .grade-D { background: linear-gradient(135deg, #cccccc 0%, #999999 100%); }
  </style>
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // API URL ìë™ ê°ì§€ (ë¡œì»¬ vs Vercel)
    const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
      ? 'http://localhost:3001/api'
      : 'https://investar-xi.vercel.app/api';  // Vercel ë°°í¬ í›„ ë³€ê²½

    // ë©”ì¸ ì•±
    function App() {
      const [recommendations, setRecommendations] = useState([]);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState(null);
      const [selectedStock, setSelectedStock] = useState(null);
      const [selectedCategory, setSelectedCategory] = useState('all');
      const [lastUpdate, setLastUpdate] = useState(null);
      const [activeTab, setActiveTab] = useState('screening'); // screening, performance, dna, trends
      const [screeningMetadata, setScreeningMetadata] = useState(null); // ìŠ¤í¬ë¦¬ë‹ ë©”íƒ€ë°ì´í„°

      // ì¶”ì²œ ì¢…ëª©ì„ Supabaseì— ì €ì¥ (ì„±ê³¼ ì¶”ì ìš©)
      const saveRecommendationsToSupabase = async (stocks) => {
        try {
          // ì ìˆ˜ 42ì  ì´ìƒ(Aë“±ê¸‰ ì´ìƒ)ë§Œ ì €ì¥ (100ì  ë§Œì  ì²´ê³„)
          // Aë“±ê¸‰(42-57ì , ìµœê³  ìˆ˜ìµë¥  +27.5%) ì´ìƒì„ ì„±ê³¼ ì¶”ì 
          const stocksToSave = stocks.filter(s => s.totalScore >= 42);

          if (stocksToSave.length === 0) {
            console.log('ì €ì¥í•  ì¶”ì²œ ì¢…ëª© ì—†ìŒ (42ì  ì´ìƒ ì—†ìŒ)');
            return;
          }

          const response = await fetch(`${API_BASE_URL}/recommendations/save`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ stocks: stocksToSave })
          });

          const result = await response.json();

          if (result.success) {
            console.log(`âœ… ${result.saved}ê°œ ì¶”ì²œ ì¢…ëª© ì €ì¥ ì™„ë£Œ (${result.date})`);
          } else {
            console.warn('ì¶”ì²œ ì¢…ëª© ì €ì¥ ì‹¤íŒ¨:', result.message);
          }
        } catch (err) {
          console.warn('Supabase ì €ì¥ ì‹¤íŒ¨ (ë¬´ì‹œ):', err.message);
        }
      };

      // ì¶”ì²œ ì¢…ëª© ë¶ˆëŸ¬ì˜¤ê¸°
      const fetchRecommendations = async (category = 'all') => {
        try {
          setLoading(true);
          setError(null);

          // limit ì œê±° - ì „ì²´ ì¢…ëª© í‘œì‹œ
          const url = category === 'all'
            ? `${API_BASE_URL}/screening/recommend`
            : `${API_BASE_URL}/screening/${category}`;

          const response = await fetch(url);
          const result = await response.json();

          if (result.success) {
            const stocks = result.recommendations || [];
            setRecommendations(stocks);
            setScreeningMetadata(result.metadata || null);
            setLastUpdate(new Date());

            // ì¢…í•©ì§‘ê³„ ì¹´í…Œê³ ë¦¬ì¼ ë•Œë§Œ ìë™ ì €ì¥
            if (category === 'all' && stocks.length > 0) {
              saveRecommendationsToSupabase(stocks);
            }
          } else {
            setError(result.error || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
          }
        } catch (err) {
          setError('ì„œë²„ì™€ ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + err.message);
        } finally {
          setLoading(false);
        }
      };

      // ì¢…ëª© ìƒì„¸ ë¶„ì„ (API í˜¸ì¶œ ì—†ì´ recommendations ë°ì´í„° ì‚¬ìš©)
      const fetchStockDetail = (stockCode) => {
        const stock = recommendations.find(s => s.stockCode === stockCode);
        if (stock) {
          setSelectedStock(stock);
        } else {
          console.error('ì¢…ëª© ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', stockCode);
        }
      };

      // ì¹´í…Œê³ ë¦¬ ë³€ê²½
      const handleCategoryChange = (category) => {
        setSelectedCategory(category);
        fetchRecommendations(category);
      };

      // ì´ˆê¸° ë¡œë“œ ì œê±° (ìˆ˜ë™ ë²„íŠ¼ í´ë¦­ìœ¼ë¡œë§Œ ì‹¤í–‰)
      // useEffect(() => {
      //   fetchRecommendations();
      // }, []);

      return (
        <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50">
          {/* í—¤ë” */}
          <header className="bg-white shadow-lg border-b-4 border-indigo-600">
            <div className="max-w-7xl mx-auto px-4 py-6">
              <div className="flex items-center justify-between">
                <div>
                  <h1 className="text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                    ğŸ¤– AI Stock Screener
                  </h1>
                  <p className="text-gray-600 mt-2">ê±°ë˜ëŸ‰ AIê°€ ì¶”ì²œí•˜ëŠ” ì˜¤ëŠ˜ì˜ ì¢…ëª©</p>
                </div>
                <button
                  onClick={() => activeTab === 'screening' ? fetchRecommendations(selectedCategory) : window.location.reload()}
                  disabled={loading}
                  className="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50 font-semibold shadow-lg"
                >
                  {loading ? 'ë¶„ì„ì¤‘...' : 'ğŸ”„ ìƒˆë¡œê³ ì¹¨'}
                </button>
              </div>
              {/* íƒ­ ë©”ë‰´ */}
              <div className="flex gap-4 mt-6 border-b border-gray-200">
                <button
                  onClick={() => setActiveTab('screening')}
                  className={`px-6 py-3 font-semibold transition-all ${
                    activeTab === 'screening'
                      ? 'text-indigo-600 border-b-4 border-indigo-600'
                      : 'text-gray-500 hover:text-gray-700'
                  }`}
                >
                  ğŸ“Š ì¢…ëª© ìŠ¤í¬ë¦¬ë‹
                </button>
                <button
                  onClick={() => setActiveTab('performance')}
                  className={`px-6 py-3 font-semibold transition-all ${
                    activeTab === 'performance'
                      ? 'text-indigo-600 border-b-4 border-indigo-600'
                      : 'text-gray-500 hover:text-gray-700'
                  }`}
                >
                  ğŸ“ˆ ì„±ê³¼ ê²€ì¦
                </button>
                <button
                  onClick={() => setActiveTab('dna')}
                  className={`px-6 py-3 font-semibold transition-all ${
                    activeTab === 'dna'
                      ? 'text-indigo-600 border-b-4 border-indigo-600'
                      : 'text-gray-500 hover:text-gray-700'
                  }`}
                >
                  ğŸ§¬ DNA ì¶”ì¶œ
                </button>
              </div>
            </div>
          </header>

          <main className="max-w-7xl mx-auto px-4 py-8">
            {/* ì—ëŸ¬ ë©”ì‹œì§€ */}
            {error && (
              <div className="bg-red-100 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded mb-4 shadow">
                <div className="flex justify-between">
                  <span>{error}</span>
                  <button onClick={() => setError(null)} className="font-bold">Ã—</button>
                </div>
              </div>
            )}

            {/* íƒ­ë³„ ì½˜í…ì¸  */}
            {activeTab === 'dna' ? (
              <DnaExtraction apiBaseUrl={API_BASE_URL} />
            ) : activeTab === 'screening' ? (
              <>
                {/* ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ */}
                {lastUpdate && (
                  <div className="text-sm text-gray-600 mb-4 text-center">
                    ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: {lastUpdate.toLocaleString('ko-KR')}
                  </div>
                )}

                {/* ìŠ¤í¬ë¦¬ë‹ ë©”íƒ€ë°ì´í„° */}
                {screeningMetadata && recommendations.length > 0 && (
                  <div className="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4 rounded">
                    <div className="flex items-center justify-center gap-6 text-sm">
                      <div>
                        <span className="text-gray-600">ë¶„ì„:</span>
                        <span className="font-bold text-blue-900 ml-1">{screeningMetadata.totalAnalyzed}ê°œ</span>
                      </div>
                      <div className="text-gray-400">|</div>
                      <div>
                        <span className="text-gray-600">ì¡°ê±´ ì¶©ì¡±:</span>
                        <span className="font-bold text-green-700 ml-1">{screeningMetadata.totalFound}ê°œ</span>
                      </div>
                      <div className="text-gray-400">|</div>
                      <div>
                        <span className="text-gray-600">í‘œì‹œ:</span>
                        <span className="font-bold text-indigo-700 ml-1">{screeningMetadata.returned}ê°œ</span>
                      </div>
                      {screeningMetadata.poolSize && (
                        <>
                          <div className="text-gray-400">|</div>
                          <div>
                            <span className="text-gray-600">í’€ í¬ê¸°:</span>
                            <span className="font-bold text-purple-700 ml-1">{screeningMetadata.poolSize}ê°œ</span>
                          </div>
                        </>
                      )}
                    </div>
                  </div>
                )}

                {/* ì¹´í…Œê³ ë¦¬ í•„í„° */}
                <CategoryFilter
                  selected={selectedCategory}
                  onChange={handleCategoryChange}
                  loading={loading}
                />

                {/* ì¶”ì²œ ì¢…ëª© ê·¸ë¦¬ë“œ */}
                {loading && recommendations.length === 0 ? (
                  <LoadingScreen />
                ) : recommendations.length === 0 ? (
                  <EmptyState category={selectedCategory} />
                ) : (
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-8">
                    {recommendations.map((stock, index) => (
                      <RecommendationCard
                        key={stock.stockCode}
                        stock={stock}
                        rank={index + 1}
                        onClick={() => fetchStockDetail(stock.stockCode)}
                      />
                    ))}
                  </div>
                )}

                {/* ì¢…ëª© ìƒì„¸ ëª¨ë‹¬ */}
                {selectedStock && (
                  <StockDetailModal
                    stock={selectedStock}
                    onClose={() => setSelectedStock(null)}
                  />
                )}
              </>
            ) : (
              <PerformanceVerification apiBaseUrl={API_BASE_URL} />
            )}
          </main>
        </div>
      );
    }

    // ì¹´í…Œê³ ë¦¬ í•„í„°
    function CategoryFilter({ selected, onChange, loading }) {
      const categories = [
        {
          id: 'all',
          name: 'ğŸ† ì¢…í•©ì§‘ê³„',
          icon: 'ğŸ†',
          desc: 'ëª¨ë“  ì§€í‘œë¥¼ ì¢…í•©í•˜ì—¬ ì ìˆ˜ê°€ ë†’ì€ ì¢…ëª© ì§‘ê³„'
        },
        {
          id: 'whale',
          name: 'ğŸ‹ ê³ ë˜ ê°ì§€',
          icon: 'ğŸ‹',
          desc: 'ê±°ë˜ëŸ‰ 2.5ë°° + ê°€ê²© 3% ì´ìƒ = ì„¸ë ¥ ë§¤ìˆ˜ ì‹ í˜¸'
        },
        {
          id: 'accumulation',
          name: 'ğŸ¤« ì¡°ìš©í•œ ë§¤ì§‘',
          icon: 'ğŸ¤«',
          desc: 'ê°€ê²© ì•ˆì • + ê±°ë˜ëŸ‰ ì¦ê°€ 20% = 1~2ì£¼ í›„ ê¸‰ë“± ì „ì¡°'
        }
      ];

      return (
        <div className="bg-white rounded-xl shadow-lg p-4">
          <div className="flex flex-wrap gap-3 justify-center">
            {categories.map(cat => (
              <div key={cat.id} className="relative group">
                <button
                  onClick={() => onChange(cat.id)}
                  disabled={loading}
                  className={`px-6 py-3 rounded-lg font-semibold transition-all ${
                    selected === cat.id
                      ? 'bg-indigo-600 text-white shadow-lg scale-105'
                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                  }`}
                >
                  <span className="text-xl mr-2">{cat.icon}</span>
                  {cat.name}
                </button>
                {/* íˆ´íŒ */}
                <div className="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-10 shadow-xl">
                  {cat.desc}
                  <div className="absolute top-full left-1/2 transform -translate-x-1/2 -mt-1">
                    <div className="border-4 border-transparent border-t-gray-900"></div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    // ì¶”ì²œ ì¢…ëª© ì¹´ë“œ
    function RecommendationCard({ stock, rank, onClick }) {
      const gradeClass = `grade-${stock.recommendation.grade}`;
      const isPositive = stock.changeRate >= 0;

      // ê±°ë˜ëŸ‰ ë¹„ìœ¨ ê³„ì‚°
      const volumeRatio = stock.volumeAnalysis.current.volumeMA20
        ? (stock.volume / stock.volumeAnalysis.current.volumeMA20).toFixed(1)
        : null;

      // ë±ƒì§€ ë°ì´í„°
      const badges = [];
      if (stock.rankBadges) {
        if (stock.rankBadges.volumeSurge) badges.push({ text: 'ê±°ë˜ëŸ‰ê¸‰ì¦', color: 'bg-red-500' });
        if (stock.rankBadges.tradingValue) badges.push({ text: 'ê±°ë˜ëŒ€ê¸ˆ', color: 'bg-orange-500' });
        if (stock.rankBadges.volume) badges.push({ text: 'ê±°ë˜ëŸ‰', color: 'bg-yellow-500' });
      }

      // íŒ¨í„´ ë±ƒì§€ ì¶”ê°€
      if (stock.patternMatch && stock.patternMatch.matched) {
        badges.push({
          text: `ê¸‰ë“±íŒ¨í„´ +${stock.patternMatch.bonusScore.toFixed(0)}ì `,
          color: 'bg-purple-500'
        });
      }

      return (
        <div
          className="stock-card bg-white rounded-xl shadow-lg overflow-hidden cursor-pointer slide-in"
          onClick={onClick}
        >
          {/* ë“±ê¸‰ ë°°ì§€ */}
          <div className={`${gradeClass} px-4 py-3 flex justify-between items-center`}>
            <span className="text-white font-bold text-lg">#{rank}</span>
            <span className="text-white font-bold text-2xl">{stock.recommendation.grade}</span>
            <span className="text-white text-sm">ì ìˆ˜: {stock.totalScore.toFixed(2)}</span>
          </div>

          {/* ì¢…ëª© ì •ë³´ */}
          <div className="p-5">
            <div className="flex justify-between items-start mb-4">
              <div className="flex-1">
                <h3 className="text-xl font-bold text-gray-900">{stock.stockName}</h3>
                <p className="text-sm text-gray-500">{stock.stockCode}</p>
                {/* ë­í‚¹ ë±ƒì§€ */}
                {badges.length > 0 && (
                  <div className="flex flex-wrap gap-1 mt-2">
                    {badges.map((badge, i) => (
                      <span key={i} className={`${badge.color} text-white text-xs px-2 py-1 rounded-full font-semibold`}>
                        ğŸ† {badge.text}
                      </span>
                    ))}
                  </div>
                )}
              </div>
              <div className="text-right">
                <p className="text-2xl font-bold text-gray-900">
                  {stock.currentPrice.toLocaleString()}
                </p>
                <p className={`text-sm font-semibold ${isPositive ? 'text-red-600' : 'text-blue-600'}`}>
                  {isPositive ? 'â–²' : 'â–¼'} {Math.abs(stock.changeRate).toFixed(2)}%
                </p>
              </div>
            </div>

            {/* ì¶”ì²œ ì´ìœ  */}
            <div className="bg-gray-50 rounded-lg p-3 mb-4">
              <p className="text-sm font-semibold text-indigo-600 mb-2">
                {stock.recommendation.text}
              </p>
              <div className="flex flex-wrap gap-1 mb-2">
                {stock.advancedAnalysis.signals.slice(0, 3).map((signal, i) => (
                  <span key={i} className="text-xs bg-white px-2 py-1 rounded-full border border-gray-200">
                    {signal}
                  </span>
                ))}
              </div>
              {/* ì¶”ì²œ ë“±ê¸‰ ê¸°ì¤€ */}
              <div className="bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 p-3 mt-2 rounded-lg">
                <div className="flex items-center gap-2 mb-2">
                  <span className="text-sm font-bold text-blue-900">ğŸ“Œ ì¶”ì²œ ë“±ê¸‰ ê¸°ì¤€</span>
                  <span className={`px-2 py-0.5 rounded-full text-xs font-bold ${
                    stock.recommendation.grade === 'S' ? 'bg-red-100 text-red-700' :
                    stock.recommendation.grade === 'A' ? 'bg-orange-100 text-orange-700' :
                    stock.recommendation.grade === 'B' ? 'bg-yellow-100 text-yellow-700' :
                    'bg-gray-100 text-gray-700'
                  }`}>{stock.recommendation.grade}ë“±ê¸‰</span>
                </div>

                {stock.recommendation.grade === 'S' && (
                  <div className="text-xs text-gray-800 space-y-1.5">
                    <div className="font-semibold text-red-600">ğŸ”¥ ìµœìš°ì„  ë§¤ìˆ˜ ì¶”ì²œ (64ì  ì´ìƒ / 85ì  ë§Œì )</div>
                    <div className="pl-3 space-y-0.5">
                      <div>â€¢ ê±°ë˜ëŸ‰ í­ë°œ + ê°€ê²© ë¯¸ë°˜ì˜ (ì¡°ìš©í•œ ë§¤ì§‘)</div>
                      <div>â€¢ ê¸°ê´€/ì™¸êµ­ì¸ ì ê·¹ ë§¤ìˆ˜ ì§„í–‰ ì¤‘</div>
                      <div>â€¢ 1~2ì£¼ ë‚´ ê¸‰ë“± ê°€ëŠ¥ì„± ë§¤ìš° ë†’ìŒ</div>
                    </div>
                  </div>
                )}

                {stock.recommendation.grade === 'A' && (
                  <div className="text-xs text-gray-800 space-y-1.5">
                    <div className="font-semibold text-orange-600">ğŸŸ¢ ì ê·¹ ë§¤ìˆ˜ ê³ ë ¤ (49~63ì )</div>
                    <div className="pl-3 space-y-0.5">
                      <div>â€¢ ê±°ë˜ëŸ‰ ì¦ê°€ + ê°€ê²© ìƒìŠ¹ ì´ˆê¸° ë‹¨ê³„</div>
                      <div>â€¢ ì„¸ë ¥ ë§¤ì§‘ ì‹ í˜¸ ê°•í•¨</div>
                      <div>â€¢ ë‹¨ê¸° ìˆ˜ìµ ê¸°ëŒ€ ê°€ëŠ¥</div>
                    </div>
                  </div>
                )}

                {stock.recommendation.grade === 'B' && (
                  <div className="text-xs text-gray-800 space-y-1.5">
                    <div className="font-semibold text-yellow-600">ğŸŸ¡ ê´€ì‹¬ ì¢…ëª© - ì„ í–‰ ì§€í‘œ (36~48ì )</div>
                    <div className="pl-3 space-y-0.5">
                      <div>â€¢ ì„ í–‰ íŒ¨í„´ í¬ì°© (ê¸‰ë“± ì „ì¡°)</div>
                      <div>â€¢ ê±°ë˜ëŸ‰ DNA ë˜ëŠ” Cup&Handle í˜•ì„±</div>
                      <div>â€¢ ì§€ì† ê´€ì°° í•„ìš”</div>
                    </div>
                  </div>
                )}

                {stock.recommendation.grade === 'C' && (
                  <div className="text-xs text-gray-800 space-y-1.5">
                    <div className="font-semibold text-gray-600">âšª ì£¼ëª© - ì°¸ê³ ìš© (21~35ì )</div>
                    <div className="pl-3 space-y-0.5">
                      <div>â€¢ ì¼ë¶€ ê¸ì • ì‹ í˜¸ ê°ì§€</div>
                      <div>â€¢ ì¶”ê°€ í™•ì¸ ì‹ í˜¸ í•„ìš”</div>
                      <div>â€¢ ì‹ ì¤‘í•œ ì ‘ê·¼ ê¶Œì¥</div>
                    </div>
                  </div>
                )}

                {/* ì ìš©ëœ ì„ í–‰ ì§€í‘œ (êµ¬ì²´ì  ì„¤ëª…) */}
                <div className="mt-3 pt-3 border-t border-blue-200">
                  <div className="text-xs font-semibold text-blue-900 mb-2">ğŸ¯ ì ìš©ëœ ì„ í–‰ ì§€í‘œ</div>
                  <div className="space-y-1.5 text-xs">
                    {/* ì„ í–‰ ì§€í‘œ (íŒ¨í„´+DNA) */}
                    {stock.leadingIndicators && stock.leadingIndicators.pattern && stock.leadingIndicators.pattern.matched && (
                      <div className="bg-blue-50 rounded p-2">
                        <span className="font-semibold text-blue-800">ğŸ“‹ íŒ¨í„´:</span>
                        <span className="text-gray-700 ml-1">
                          {stock.leadingIndicators.pattern.patterns && stock.leadingIndicators.pattern.patterns.length > 0
                            ? stock.leadingIndicators.pattern.patterns.slice(0, 2).map(p => `"${p.name}" (${(p.matchScore * 100).toFixed(0)}%)`).join(', ')
                            : 'íŒ¨í„´ ë§¤ì¹­'}
                        </span>
                      </div>
                    )}
                    {stock.leadingIndicators && stock.leadingIndicators.dna && stock.leadingIndicators.dna.matched && (
                      <div className="bg-purple-50 rounded p-2">
                        <span className="font-semibold text-purple-800">ğŸ§¬ DNA:</span>
                        <span className="text-gray-700 ml-1">
                          EMA {stock.leadingIndicators.dna.volumePattern?.emaAvg?.toFixed(1)}%,
                          íŠ¸ë Œë“œ {stock.leadingIndicators.dna.volumePattern?.segmented?.trend || 'N/A'}
                          {stock.leadingIndicators.dna.volumePattern?.urgency === 'high' && ' (ê¸‰ë“± ì„ë°•)'}
                        </span>
                      </div>
                    )}
                    {/* Cup&Handle íŒ¨í„´ */}
                    {stock.cupAndHandle && stock.cupAndHandle.detected && (
                      <div className="bg-green-50 rounded p-2">
                        <span className="font-semibold text-green-800">ğŸ† Cup&Handle:</span>
                        <span className="text-gray-700 ml-1">
                          ì»µ {stock.cupAndHandle.cupDays || 'N/A'}ì¼, ì†ì¡ì´ {stock.cupAndHandle.handleDays || 'N/A'}ì¼, ëŒíŒŒ ëŒ€ê¸°
                        </span>
                      </div>
                    )}
                    {/* ê¸°ê´€/ì™¸êµ­ì¸ ìˆ˜ê¸‰ */}
                    {stock.institutionalFlow && stock.institutionalFlow.detected && (
                      <div className="bg-yellow-50 rounded p-2">
                        <span className="font-semibold text-yellow-800">ğŸ’¼ ê¸°ê´€/ì™¸êµ­ì¸:</span>
                        <span className="text-gray-700 ml-1">
                          {stock.institutionalFlow.institution?.consecutive > 0 && `ê¸°ê´€ ${stock.institutionalFlow.institution.consecutive}ì¼ ë§¤ìˆ˜`}
                          {stock.institutionalFlow.institution?.consecutive > 0 && stock.institutionalFlow.foreign?.consecutive > 0 && ', '}
                          {stock.institutionalFlow.foreign?.consecutive > 0 && `ì™¸êµ­ì¸ ${stock.institutionalFlow.foreign.consecutive}ì¼ ë§¤ìˆ˜`}
                        </span>
                      </div>
                    )}
                    {/* í•©ë¥˜ì  */}
                    {stock.confluence && stock.confluence.confluenceCount >= 2 && (
                      <div className="bg-indigo-50 rounded p-2">
                        <span className="font-semibold text-indigo-800">ğŸ“Š í•©ë¥˜ì :</span>
                        <span className="text-gray-700 ml-1">
                          {stock.confluence.signals && stock.confluence.signals.length > 0
                            ? stock.confluence.signals.slice(0, 3).join(', ') + (stock.confluence.signals.length > 3 ? ` ì™¸ ${stock.confluence.signals.length - 3}ê°œ` : '')
                            : `${stock.confluence.confluenceCount}ê°œ ì‹ í˜¸`}
                        </span>
                      </div>
                    )}
                    {/* ì„ í–‰ ì§€í‘œê°€ í•˜ë‚˜ë„ ì—†ì„ ê²½ìš° */}
                    {(!stock.leadingIndicators || (!stock.leadingIndicators.pattern?.matched && !stock.leadingIndicators.dna?.matched))
                      && (!stock.cupAndHandle || !stock.cupAndHandle.detected)
                      && (!stock.institutionalFlow || !stock.institutionalFlow.detected)
                      && (!stock.confluence || stock.confluence.confluenceCount < 2) && (
                      <div className="bg-gray-50 rounded p-2 text-gray-500 text-center">
                        ì„ í–‰ ì§€í‘œ ë¯¸ê°ì§€ (ê¸°ë³¸ ì§€í‘œ ê¸°ë°˜ ì¶”ì²œ)
                      </div>
                    )}
                  </div>
                </div>
              </div>
            </div>


            {/* ì£¼ìš” ì§€í‘œ */}
            <div className="grid grid-cols-3 gap-2 text-sm">
              <div className="bg-blue-50 p-2 rounded relative group">
                <p className="text-gray-600 text-xs">ê±°ë˜ëŸ‰ ë¹„ìœ¨ â“˜</p>
                <p className="font-bold text-blue-700">{volumeRatio ? `${volumeRatio}x` : 'N/A'}</p>
                {/* íˆ´íŒ - ì™¼ìª½ ì •ë ¬ */}
                <div className="absolute bottom-full left-0 mb-2 w-72 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 shadow-xl">
                  <div className="font-bold mb-1">ğŸ“Š ê±°ë˜ëŸ‰ ë¹„ìœ¨ (ì¼ë´‰ 20ì¼ ê¸°ì¤€)</div>
                  <div className="space-y-1">
                    <div className="text-yellow-300 font-semibold">"ë‹¹ì¼ ê±°ë˜ëŸ‰ Ã· ìµœê·¼ 20ì¼ ì´ë™í‰ê· "</div>
                    <div className="border-t border-gray-700 my-1"></div>
                    <div>â€¢ í˜„ì¬ ê±°ë˜ëŸ‰: {stock.volume ? (stock.volume / 1000).toFixed(0) + 'Kì£¼' : 'N/A'}</div>
                    <div>â€¢ 20ì¼ í‰ê· : {stock.volumeAnalysis.current.volumeMA20 ? (stock.volumeAnalysis.current.volumeMA20 / 1000).toFixed(0) + 'Kì£¼' : 'N/A'}</div>
                    <div>â€¢ ë¹„ìœ¨: <span className="text-yellow-300 font-bold">{volumeRatio}ë°°</span></div>
                    <div className="border-t border-gray-700 my-1"></div>
                    <div>â€¢ 5ë°°+ : ğŸ”¥ğŸ”¥ğŸ”¥ ì´ˆëŒ€ëŸ‰ (ì´ë²¤íŠ¸)</div>
                    <div>â€¢ 3-5ë°°: ğŸ”¥ğŸ”¥ ëŒ€ëŸ‰ (ì„¸ë ¥)</div>
                    <div>â€¢ 2-3ë°°: ğŸ”¥ ê¸‰ì¦ (ê´€ì‹¬)</div>
                    <div>â€¢ 1.5ë°°-: ğŸ“ˆ ì •ìƒ</div>
                    <div className="text-red-300 mt-1">âš ï¸ 10ë°°+ = ê³¼ì—´ ìœ„í—˜</div>
                  </div>
                  <div className="absolute top-full left-6 transform -mt-1">
                    <div className="border-4 border-transparent border-t-gray-900"></div>
                  </div>
                </div>
              </div>
              <div className="bg-purple-50 p-2 rounded relative group">
                <p className="text-gray-600 text-xs">MFI â“˜</p>
                <p className="font-bold text-purple-700">
                  {stock.volumeAnalysis.indicators.mfi?.toFixed(1) || 'N/A'}
                </p>
                {/* íˆ´íŒ - ì¤‘ì•™ ì •ë ¬ */}
                <div className="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-72 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 shadow-xl">
                  <div className="font-bold mb-1">ğŸ’° MFI (ì¼ë´‰ 14ì¼ ê¸°ì¤€)</div>
                  <div className="space-y-1">
                    <div className="text-yellow-300 font-semibold">"Money Flow Index (ìê¸ˆíë¦„ì§€ìˆ˜)"</div>
                    <div className="border-t border-gray-700 my-1"></div>
                    <div>â€¢ ê¸°ê°„: ìµœê·¼ 14ì¼ê°„ ì¼ë´‰</div>
                    <div>â€¢ ê³„ì‚°: ê³ ê°€/ì €ê°€/ì¢…ê°€/ê±°ë˜ëŸ‰ ê¸°ë°˜</div>
                    <div>â€¢ í˜„ì¬ ê°’: <span className="text-yellow-300 font-bold">{stock.volumeAnalysis.indicators.mfi?.toFixed(1) || 'N/A'}</span></div>
                    <div className="border-t border-gray-700 my-1"></div>
                    <div className="text-red-300">â€¢ 90+: ğŸ”´ ê·¹ê³¼ë§¤ìˆ˜ (ìœ„í—˜)</div>
                    <div className="text-orange-300">â€¢ 80-90: ğŸŸ  ê³¼ë§¤ìˆ˜ (ì‹ ì¤‘)</div>
                    <div className="text-yellow-300">â€¢ 70-80: ğŸŸ¡ ê°•ì„¸ (ì§€ì†)</div>
                    <div className="text-green-300">â€¢ 50-70: ğŸŸ¢ ì •ìƒ (ë§¤ìˆ˜)</div>
                    <div className="text-blue-300">â€¢ 20-30: ğŸ”µ ê³¼ë§¤ë„ (ê¸°íšŒ)</div>
                    <div className="text-indigo-300">â€¢ 20-: ğŸ’™ ê·¹ê³¼ë§¤ë„ (ìµœëŒ€ê¸°íšŒ)</div>
                    <div className="text-yellow-300 mt-1">âš ï¸ ê³¼ë§¤ìˆ˜ â‰  ë§¤ë„ (ê°•ì„¸ ì§€ì† ê°€ëŠ¥)</div>
                  </div>
                  <div className="absolute top-full left-1/2 transform -translate-x-1/2 -mt-1">
                    <div className="border-4 border-transparent border-t-gray-900"></div>
                  </div>
                </div>
              </div>
              <div className="bg-green-50 p-2 rounded relative group">
                <p className="text-gray-600 text-xs">ë¹„ëŒ€ì¹­ â“˜</p>
                <p className="font-bold text-green-700">
                  {stock.advancedAnalysis.indicators.asymmetric.ratio || 'N/A'}
                </p>
                {/* íˆ´íŒ - ì˜¤ë¥¸ìª½ ì •ë ¬ */}
                <div className="absolute bottom-full right-0 mb-2 w-72 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 shadow-xl">
                  <div className="font-bold mb-1">ğŸ“Š ë¹„ëŒ€ì¹­ ë¹„ìœ¨ (ì¼ë´‰ 20ì¼ ê¸°ì¤€)</div>
                  <div className="space-y-1">
                    <div className="text-yellow-300 font-semibold">"ìƒìŠ¹ì¼ vs í•˜ë½ì¼ ê±°ë˜ëŸ‰ ë¹„êµ"</div>
                    <div className="border-t border-gray-700 my-1"></div>
                    <div>â€¢ ë¶„ì„ ê¸°ê°„: ìµœê·¼ 20ì¼ê°„ ì¼ë´‰</div>
                    <div>â€¢ ìƒìŠ¹ì¼: {stock.advancedAnalysis.indicators.asymmetric.upDays}ì¼ ({(stock.advancedAnalysis.indicators.asymmetric.upVolume / 1000000).toFixed(1)}Mì£¼)</div>
                    <div>â€¢ í•˜ë½ì¼: {stock.advancedAnalysis.indicators.asymmetric.downDays}ì¼ ({(stock.advancedAnalysis.indicators.asymmetric.downVolume / 1000000).toFixed(1)}Mì£¼)</div>
                    <div>â€¢ ë¹„ìœ¨: <span className="text-yellow-300 font-bold">{stock.advancedAnalysis.indicators.asymmetric.ratio}ë°°</span></div>
                    <div className="border-t border-gray-700 my-1"></div>
                    <div className="text-green-300">â†’ í•´ì„: {stock.advancedAnalysis.indicators.asymmetric.signal}</div>
                    <div className="text-gray-300">â€¢ 2ë°°+ : ê°•í•œ ë§¤ìˆ˜ì„¸</div>
                    <div className="text-gray-300">â€¢ 1.5~2ë°° : ë§¤ìˆ˜ ìš°ìœ„</div>
                    <div className="text-gray-300">â€¢ 0.5~1.5ë°° : ì¤‘ë¦½</div>
                    <div className="text-gray-300">â€¢ 0.5ë°°- : ê°•í•œ ë§¤ë„ì„¸</div>
                  </div>
                  <div className="absolute top-full right-6 transform -mt-1">
                    <div className="border-4 border-transparent border-t-gray-900"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ë¡œë”© í™”ë©´
    function LoadingScreen() {
      return (
        <div className="text-center py-20">
          <div className="inline-block animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-indigo-600 mb-4"></div>
          <h3 className="text-2xl font-bold text-gray-800 mb-2">AIê°€ ì¢…ëª©ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</h3>
          <p className="text-gray-600">ì „ì²´ ì¢…ëª© ìŠ¤í¬ë¦¬ë‹ ì¤‘ (ìˆ˜ ë¶„ ì†Œìš”)</p>
        </div>
      );
    }

    // ë¹ˆ ìƒíƒœ í™”ë©´
    function EmptyState({ category }) {
      const categoryNames = {
        'all': 'ì¢…í•©ì§‘ê³„',
        'whale': 'ê³ ë˜ ê°ì§€',
        'accumulation': 'ì¡°ìš©í•œ ë§¤ì§‘'
      };

      return (
        <div className="text-center py-20">
          <div className="text-6xl mb-4">ğŸš€</div>
          <h3 className="text-2xl font-bold text-gray-800 mb-2">
            ì¢…ëª© ìŠ¤í¬ë¦¬ë‹ì„ ì‹œì‘í•˜ì„¸ìš”
          </h3>
          <p className="text-gray-600 mb-6">
            ìƒë‹¨ì˜ <span className="font-semibold text-indigo-600">ğŸ”„ ìƒˆë¡œê³ ì¹¨</span> ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¢…ëª© ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”
          </p>
          <div className="bg-blue-50 border-l-4 border-blue-500 p-4 max-w-md mx-auto rounded">
            <p className="text-sm text-blue-800">
              ğŸ’¡ <strong>íŒ:</strong> íŒ¨í„´ ë¶„ì„ì€ ìƒë‹¨ì˜ <strong>íŒ¨í„´ ë¶„ì„</strong> íƒ­ì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
          </div>
        </div>
      );
    }

    // ì¢…ëª© ìƒì„¸ ëª¨ë‹¬
    function StockDetailModal({ stock, onClose }) {
      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" onClick={onClose}>
          <div className="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl" onClick={(e) => e.stopPropagation()}>
            {/* í—¤ë” */}
            <div className="sticky top-0 bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-6 rounded-t-2xl">
              <div className="flex justify-between items-start">
                <div>
                  <h2 className="text-3xl font-bold">{stock.stockName}</h2>
                  <p className="text-indigo-100 mt-1">{stock.stockCode}</p>
                </div>
                <button
                  onClick={onClose}
                  className="text-white hover:text-gray-200 text-3xl leading-none"
                >
                  Ã—
                </button>
              </div>

              <div className="mt-4 flex items-baseline gap-4">
                <span className="text-4xl font-bold">{stock.currentPrice.toLocaleString()}ì›</span>
                <span className={`text-xl font-semibold ${stock.changeRate >= 0 ? 'text-red-300' : 'text-blue-300'}`}>
                  {stock.changeRate >= 0 ? 'â–²' : 'â–¼'} {Math.abs(stock.changeRate).toFixed(2)}%
                </span>
              </div>
            </div>

            {/* ì½˜í…ì¸  */}
            <div className="p-6 space-y-6">
              {/* ì¢…í•© í‰ê°€ */}
              <div className="bg-gradient-to-br from-yellow-50 to-orange-50 border-2 border-yellow-300 rounded-xl p-6">
                <h3 className="text-xl font-bold mb-3">ğŸ¯ ì¢…í•© í‰ê°€</h3>
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-3xl font-bold text-indigo-600">{stock.totalScore}ì </p>
                    <p className="text-gray-600 mt-1">{stock.recommendation.text}</p>
                  </div>
                  <div className={`grade-${stock.recommendation.grade} w-24 h-24 rounded-full flex items-center justify-center`}>
                    <span className="text-white text-5xl font-bold">{stock.recommendation.grade}</span>
                  </div>
                </div>
              </div>

              {/* ì ìˆ˜ ìƒì„¸ ë¶„ì„ (scoreBreakdown) */}
              {stock.scoreBreakdown && (
                <div className="bg-gradient-to-br from-green-50 to-teal-50 border-2 border-green-300 rounded-xl p-6">
                  <h3 className="text-xl font-bold mb-4">ğŸ“Š ì ìˆ˜ ìƒì„¸ ë¶„ì„</h3>

                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div className="bg-white p-4 rounded-lg border border-gray-200">
                      <p className="text-gray-600 text-sm mb-1">ê¸°ë³¸ ì ìˆ˜</p>
                      <p className="text-2xl font-bold text-blue-600">{stock.scoreBreakdown.baseScore}ì </p>
                      <p className="text-xs text-gray-500 mt-1">ê¸°ìˆ ì  ì§€í‘œ (70% ê°€ì¤‘ì¹˜)</p>
                    </div>

                    <div className="bg-white p-4 rounded-lg border border-gray-200">
                      <p className="text-gray-600 text-sm mb-1">ë³´ë„ˆìŠ¤ í•©ê³„</p>
                      <p className="text-2xl font-bold text-green-600">
                        +{stock.scoreBreakdown.bonuses.reduce((sum, b) => sum + b.value, 0)}ì 
                      </p>
                      <p className="text-xs text-gray-500 mt-1">{stock.scoreBreakdown.bonuses.length}ê°œ ì ìš©</p>
                    </div>

                    <div className="bg-white p-4 rounded-lg border border-gray-200">
                      <p className="text-gray-600 text-sm mb-1">í˜ë„í‹° í•©ê³„</p>
                      <p className="text-2xl font-bold text-red-600">
                        {stock.scoreBreakdown.penalties.reduce((sum, p) => sum + p.value, 0)}ì 
                      </p>
                      <p className="text-xs text-gray-500 mt-1">{stock.scoreBreakdown.penalties.length}ê°œ ì ìš©</p>
                    </div>
                  </div>

                  {/* ë³´ë„ˆìŠ¤ ëª©ë¡ */}
                  {stock.scoreBreakdown.bonuses && stock.scoreBreakdown.bonuses.length > 0 && (
                    <div className="mb-4">
                      <h4 className="font-bold text-green-700 mb-2">âœ… ë³´ë„ˆìŠ¤ í•­ëª©</h4>
                      <div className="space-y-2">
                        {stock.scoreBreakdown.bonuses.map((bonus, idx) => (
                          <div key={idx} className="flex justify-between items-center bg-green-50 p-2 rounded border border-green-200">
                            <span className="text-sm text-green-800">{bonus.name}</span>
                            <span className="font-bold text-green-700">+{bonus.value}ì </span>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* í˜ë„í‹° ëª©ë¡ */}
                  {stock.scoreBreakdown.penalties && stock.scoreBreakdown.penalties.length > 0 && (
                    <div>
                      <h4 className="font-bold text-red-700 mb-2">âš ï¸ í˜ë„í‹° í•­ëª©</h4>
                      <div className="space-y-2">
                        {stock.scoreBreakdown.penalties.map((penalty, idx) => (
                          <div key={idx} className="flex justify-between items-center bg-red-50 p-2 rounded border border-red-200">
                            <span className="text-sm text-red-800">{penalty.name}</span>
                            <span className="font-bold text-red-700">{penalty.value}ì </span>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* ìµœì¢… ê³„ì‚° */}
                  <div className="mt-4 pt-4 border-t-2 border-green-300">
                    <div className="flex justify-between items-center">
                      <span className="font-bold text-lg">ìµœì¢… ì ìˆ˜</span>
                      <span className="text-3xl font-bold text-indigo-600">{stock.totalScore}ì </span>
                    </div>
                    <div className="text-xs text-gray-600 mt-2 text-right">
                      = ê¸°ë³¸ {stock.scoreBreakdown.baseScore}ì 
                      + ë³´ë„ˆìŠ¤ {stock.scoreBreakdown.bonuses.reduce((sum, b) => sum + b.value, 0)}ì 
                      + í˜ë„í‹° {stock.scoreBreakdown.penalties.reduce((sum, p) => sum + p.value, 0)}ì 
                    </div>
                  </div>
                </div>
              )}

              {/* ì°½ì˜ì  ì§€í‘œ */}
              <div className="bg-white border-2 border-gray-200 rounded-xl p-6">
                <h3 className="text-xl font-bold mb-4">ğŸ” ì°½ì˜ì  ì§€í‘œ ë¶„ì„</h3>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {/* ê³ ë˜ ê°ì§€ */}
                  <IndicatorBox
                    title="ğŸ‹ ê³ ë˜ ê°ì§€"
                    detected={stock.advancedAnalysis.indicators.whale.length > 0}
                    signal={stock.advancedAnalysis.indicators.whale.length > 0 ? `${stock.advancedAnalysis.indicators.whale.length}ê±´ ê°ì§€` : 'ì—†ìŒ'}
                    detail={stock.advancedAnalysis.indicators.whale.length > 0 ?
                      stock.advancedAnalysis.indicators.whale.map(w =>
                        `${w.date.slice(4,6)}/${w.date.slice(6,8)}: ê±°ë˜ëŸ‰ ${w.volumeRatio}ë°°, ê°€ê²© +${w.priceChange}%, ê°•ë„ ${w.intensity.toFixed(1)}`
                      ).join(' | ') : 'ê±°ë˜ëŸ‰ ê¸‰ì¦ + ê°€ê²© ìƒìŠ¹ ì¡°í•© ë¯¸ë°œê²¬'}
                  />

                  {/* ì¡°ìš©í•œ ë§¤ì§‘ */}
                  <IndicatorBox
                    title="ğŸ¤« ì¡°ìš©í•œ ë§¤ì§‘"
                    detected={stock.advancedAnalysis.indicators.accumulation.detected}
                    signal={stock.advancedAnalysis.indicators.accumulation.signal}
                    detail={`ê±°ë˜ëŸ‰â†‘${stock.advancedAnalysis.indicators.accumulation.volumeGrowth}% / ê°€ê²©ë³€ë™ ${stock.advancedAnalysis.indicators.accumulation.priceRange}% / í‰ê· ê°€ ${stock.advancedAnalysis.indicators.accumulation.avgPrice.toLocaleString()}ì› / ì ìˆ˜ ${stock.advancedAnalysis.indicators.accumulation.score}`}
                  />

                  {/* íƒˆì¶œ ì†ë„ */}
                  <IndicatorBox
                    title="ğŸš€ íƒˆì¶œ ì†ë„"
                    detected={stock.advancedAnalysis.indicators.escape.detected}
                    signal={stock.advancedAnalysis.indicators.escape.signal}
                    detail={stock.advancedAnalysis.indicators.escape.detected ?
                      `ì €í•­ì„  ${stock.advancedAnalysis.indicators.escape.resistance.toLocaleString()}ì› â†’ í˜„ì¬ ${stock.advancedAnalysis.indicators.escape.currentPrice.toLocaleString()}ì› (+${stock.advancedAnalysis.indicators.escape.priceBreakout}%) / ê±°ë˜ëŸ‰ ${stock.advancedAnalysis.indicators.escape.volumeRatio}ë°° / ëª¨ë©˜í…€ ${stock.advancedAnalysis.indicators.escape.momentum} / ì ìˆ˜ ${stock.advancedAnalysis.indicators.escape.score.toFixed(1)}`
                      : `ì €í•­ì„  ëŒíŒŒ ì‹¤íŒ¨ / ì ìˆ˜ ${stock.advancedAnalysis.indicators.escape.score}`}
                  />

                  {/* ìœ ë™ì„± ê³ ê°ˆ */}
                  <IndicatorBox
                    title="ğŸ’§ ìœ ë™ì„± ê³ ê°ˆ"
                    detected={stock.advancedAnalysis.indicators.drain.detected}
                    signal={stock.advancedAnalysis.indicators.drain.signal}
                    detail={`ê±°ë˜ëŸ‰â†“${stock.advancedAnalysis.indicators.drain.volumeDecline}% / ë³€ë™ì„±â†“${stock.advancedAnalysis.indicators.drain.volatilityDecline}% / ìµœê·¼í‰ê·  ${(stock.advancedAnalysis.indicators.drain.avgVolumeRecent / 1000).toFixed(0)}K / ì ìˆ˜ ${stock.advancedAnalysis.indicators.drain.score}`}
                  />

                  {/* ë¹„ëŒ€ì¹­ ê±°ë˜ëŸ‰ */}
                  <IndicatorBox
                    title="ğŸ“Š ë¹„ëŒ€ì¹­ ê±°ë˜ëŸ‰"
                    detected={stock.advancedAnalysis.indicators.asymmetric.ratio >= 1.5}
                    signal={stock.advancedAnalysis.indicators.asymmetric.signal}
                    detail={`ë¹„ìœ¨ ${stock.advancedAnalysis.indicators.asymmetric.ratio} | ìƒìŠ¹ ${stock.advancedAnalysis.indicators.asymmetric.upDays}ì¼ (${(stock.advancedAnalysis.indicators.asymmetric.upVolume / 1000000).toFixed(1)}M) vs í•˜ë½ ${stock.advancedAnalysis.indicators.asymmetric.downDays}ì¼ (${(stock.advancedAnalysis.indicators.asymmetric.downVolume / 1000000).toFixed(1)}M) | ìƒìŠ¹ì¼ ê±°ë˜ëŸ‰ì´ ${stock.advancedAnalysis.indicators.asymmetric.ratio}ë°° ë” ë§ìŒ â†’ ${stock.advancedAnalysis.indicators.asymmetric.ratio >= 3 ? 'ì„¸ë ¥ ê°•ë ¥ ë§¤ì§‘ ğŸ”¥ğŸ”¥' : stock.advancedAnalysis.indicators.asymmetric.ratio >= 1.5 ? 'ì„¸ë ¥ ë§¤ì§‘ ì¤‘ ğŸ”¥' : stock.advancedAnalysis.indicators.asymmetric.ratio <= 0.7 ? 'ì„¸ë ¥ ë§¤ë„ ì¤‘ âš ï¸' : 'ì¤‘ë¦½ âš–ï¸'} / ì ìˆ˜ ${stock.advancedAnalysis.indicators.asymmetric.score.toFixed(1)}`}
                  />

                  {/* VPM (Volume-Price Momentum) */}
                  {stock.vpm && (
                    <IndicatorBox
                      title="ğŸ“Š VPM (ê±°ë˜ëŸ‰-ê°€ê²© ëª¨ë©˜í…€)"
                      detected={stock.vpm.divergence.confidence >= 70}
                      signal={stock.vpm.signal}
                      detail={`${stock.vpm.divergence.pattern} | ì‹ ë¢°ë„ ${stock.vpm.divergence.confidence}% | VPT ${stock.vpm.vpt.trend} (${stock.vpm.vpt.signal}) | ì˜ˆì¸¡ê±°ë˜ëŸ‰ ${(stock.vpm.volumeForecast.predicted / 1000).toFixed(0)}K (${stock.vpm.volumeForecast.signal}) | ê°€ê²©ì˜ˆì¸¡: ${stock.vpm.priceDirection.prediction} (${stock.vpm.priceDirection.probability}%, ${stock.vpm.priceDirection.expectedMove}, ${stock.vpm.priceDirection.timeframe}) | ì ìˆ˜ ${stock.vpm.score}`}
                    />
                  )}

                  {/* Cup&Handle íŒ¨í„´ */}
                  {stock.cupAndHandle && stock.cupAndHandle.detected && (
                    <IndicatorBox
                      title="ğŸ† Cup&Handle íŒ¨í„´"
                      detected={true}
                      signal={stock.cupAndHandle.signal}
                      detail={`Uìí˜• ë°”ë‹¥ + ì†ì¡ì´ í˜•ì„± ì™„ë£Œ | ëŒíŒŒ ì„ë°• | ì ìˆ˜ ${stock.cupAndHandle.score}`}
                    />
                  )}

                  {/* Triangle íŒ¨í„´ */}
                  {stock.triangle && stock.triangle.detected && (
                    <IndicatorBox
                      title="ğŸ“ Triangle íŒ¨í„´"
                      detected={true}
                      signal={stock.triangle.signal}
                      detail={`ëŒ€ì¹­ ì‚¼ê°í˜• ìˆ˜ë ´ | ìˆ˜ë ´ë„ ${stock.triangle.convergence}% | ${stock.triangle.interpretation} | ì ìˆ˜ ${stock.triangle.score}`}
                    />
                  )}
                </div>

                <div className="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                  <h4 className="font-bold text-blue-900 mb-2">ğŸ’¡ ë¹„ëŒ€ì¹­ ê±°ë˜ëŸ‰ í•´ì„</h4>
                  <div className="text-sm text-blue-800 space-y-1">
                    <div>â€¢ ë¹„ìœ¨ &gt; 3.0: ì„¸ë ¥ì´ ê°•ë ¥í•˜ê²Œ ë§¤ì§‘ ì¤‘ (ìƒìŠ¹ì¼ ê±°ë˜ëŸ‰ì´ 3ë°° ì´ìƒ) ğŸ”¥ğŸ”¥ğŸ”¥</div>
                    <div>â€¢ ë¹„ìœ¨ 1.5~3.0: ì„¸ë ¥ì´ ë§¤ì§‘ ì¤‘ (ìƒìŠ¹ì¼ ê±°ë˜ëŸ‰ ìš°ìœ„) ğŸ”¥</div>
                    <div>â€¢ ë¹„ìœ¨ 0.7~1.5: ì¤‘ë¦½ (ê· í˜•) âš–ï¸</div>
                    <div>â€¢ ë¹„ìœ¨ &lt; 0.7: ì„¸ë ¥ì´ ë§¤ë„ ì¤‘ (í•˜ë½ì¼ ê±°ë˜ëŸ‰ ë” ë§ìŒ) âš ï¸</div>
                  </div>
                </div>
              </div>

              {/* ì¶”ì„¸ ë¶„ì„ (ìµœê·¼ 5ì¼) */}
              {stock.trendAnalysis && stock.trendAnalysis.dailyData && stock.trendAnalysis.dailyData.length > 0 && (
                <div className="bg-gradient-to-br from-purple-50 to-pink-50 border-2 border-purple-300 rounded-xl p-6">
                  <h3 className="text-xl font-bold mb-4 text-purple-900">ğŸ“ˆ ìµœê·¼ 5ì¼ ì¶”ì„¸ ë¶„ì„</h3>

                  <div className="overflow-x-auto">
                    <table className="w-full text-sm">
                      <thead>
                        <tr className="border-b-2 border-purple-300">
                          <th className="text-left py-3 px-3 font-bold text-purple-900">êµ¬ë¶„</th>
                          <th className="text-center py-3 px-3 font-bold text-purple-900">ì¢…ê°€/í˜„ì¬ê°€</th>
                          <th className="text-center py-3 px-3 font-bold text-purple-900">ì „ì¼ëŒ€ë¹„</th>
                          <th className="text-center py-3 px-3 font-bold text-purple-900">ê±°ë˜ëŸ‰</th>
                          <th className="text-center py-3 px-3 font-bold text-purple-900">ê±°ë˜ëŸ‰ ì „ì¼ëŒ€ë¹„</th>
                          <th className="text-center py-3 px-3 font-bold text-purple-900">ê¸°ê°„ ëˆ„ì </th>
                        </tr>
                      </thead>
                      <tbody>
                        {stock.trendAnalysis.dailyData.map((day, idx) => {
                          const isToday = idx === 0;
                          const rowClass = isToday ? 'bg-yellow-100 font-bold' : 'bg-white';
                          const priceColor = day.priceChange >= 0 ? 'text-red-600' : 'text-blue-600';
                          const volumeColor = day.volumeChange >= 20 ? 'text-red-600' :
                                              day.volumeChange >= 0 ? 'text-orange-600' :
                                              'text-gray-600';

                          return (
                            <tr key={idx} className={`${rowClass} border-b border-purple-100`}>
                              <td className="py-3 px-3 font-semibold">
                                {isToday ? 'ì˜¤ëŠ˜' : `${idx}ì¼ì „`}
                                <div className="text-xs text-gray-500 mt-1">
                                  {day.date.slice(4,6)}/{day.date.slice(6,8)}
                                </div>
                              </td>
                              <td className="text-center py-3 px-3 font-bold">
                                {day.close.toLocaleString()}ì›
                                {isToday && (
                                  <div className="text-xs text-red-600 mt-1">
                                    (í˜„ì¬ê°€)
                                  </div>
                                )}
                                {!isToday && (
                                  <div className="text-xs text-gray-500 mt-1">
                                    (ì¢…ê°€)
                                  </div>
                                )}
                              </td>
                              <td className={`text-center py-3 px-3 font-bold ${priceColor}`}>
                                {day.priceChange >= 0 ? 'â–²' : 'â–¼'} {Math.abs(day.priceChange).toFixed(2)}%
                              </td>
                              <td className="text-center py-3 px-3">
                                {(day.volume / 1000).toFixed(0)}K
                              </td>
                              <td className={`text-center py-3 px-3 font-bold ${volumeColor}`}>
                                {day.volumeChange >= 0 ? '+' : ''}{day.volumeChange.toFixed(1)}%
                              </td>
                              <td className="text-center py-3 px-3 text-xs">
                                <div className={day.periodPriceChange >= 0 ? 'text-red-600' : 'text-blue-600'}>
                                  ì£¼ê°€: {day.periodPriceChange >= 0 ? '+' : ''}{day.periodPriceChange.toFixed(2)}%
                                </div>
                                <div className="text-gray-600 mt-1">
                                  ê±°ë˜ëŸ‰: {day.periodVolumeChange >= 0 ? '+' : ''}{day.periodVolumeChange.toFixed(1)}%
                                </div>
                              </td>
                            </tr>
                          );
                        })}
                      </tbody>
                    </table>
                  </div>

                  {/* ìš”ì•½ */}
                  <div className="mt-4 p-4 bg-purple-100 rounded-lg border border-purple-300">
                    <h4 className="font-bold text-purple-900 mb-2">ğŸ’¡ 5ì¼ ì¶”ì„¸ ìš”ì•½</h4>
                    <div className="grid grid-cols-2 gap-4 text-sm">
                      <div>
                        <span className="text-purple-700 font-semibold">ì´ ì£¼ê°€ ë³€ë™:</span>
                        <span className={`ml-2 font-bold ${stock.trendAnalysis.summary.totalPriceChange >= 0 ? 'text-red-600' : 'text-blue-600'}`}>
                          {stock.trendAnalysis.summary.totalPriceChange >= 0 ? 'â–²' : 'â–¼'}
                          {Math.abs(stock.trendAnalysis.summary.totalPriceChange).toFixed(2)}%
                        </span>
                      </div>
                      <div>
                        <span className="text-purple-700 font-semibold">ì´ ê±°ë˜ëŸ‰ ë³€ë™:</span>
                        <span className="ml-2 font-bold text-orange-600">
                          {stock.trendAnalysis.summary.totalVolumeChange >= 0 ? '+' : ''}
                          {stock.trendAnalysis.summary.totalVolumeChange}%
                        </span>
                      </div>
                      <div>
                        <span className="text-purple-700 font-semibold">ì¼í‰ê·  ì£¼ê°€ ë³€ë™:</span>
                        <span className="ml-2 font-bold text-gray-700">
                          {stock.trendAnalysis.summary.avgDailyPriceChange >= 0 ? '+' : ''}
                          {stock.trendAnalysis.summary.avgDailyPriceChange}%
                        </span>
                      </div>
                      <div>
                        <span className="text-purple-700 font-semibold">ì¼í‰ê·  ê±°ë˜ëŸ‰ ë³€ë™:</span>
                        <span className="ml-2 font-bold text-gray-700">
                          {stock.trendAnalysis.summary.avgDailyVolumeChange >= 0 ? '+' : ''}
                          {stock.trendAnalysis.summary.avgDailyVolumeChange}%
                        </span>
                      </div>
                    </div>
                  </div>

                  <div className="mt-3 text-xs text-purple-700">
                    <span className="font-semibold">ğŸ“Œ í•´ì„:</span>
                    ì „ì¼ëŒ€ë¹„ = ì–´ì œì™€ ë¹„êµ | ê¸°ê°„ ëˆ„ì  = í•´ë‹¹ ì¼ìˆ˜ ì „ê³¼ ë¹„êµ | ê±°ë˜ëŸ‰ 20%+ = ê¸‰ì¦ ì‹œê·¸ë„
                  </div>
                </div>
              )}

              {/* ê±°ë˜ëŸ‰ ì§€í‘œ */}
              <div className="bg-white border-2 border-gray-200 rounded-xl p-6">
                <h3 className="text-xl font-bold mb-4">ğŸ“Š ê±°ë˜ëŸ‰ ì§€í‘œ</h3>
                <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                  <StatBox
                    label="MFI (ìê¸ˆíë¦„ì§€ìˆ˜)"
                    value={stock.volumeAnalysis.indicators.mfi?.toFixed(1)}
                    desc={
                      stock.volumeAnalysis.indicators.mfi >= 70 ? 'ê³¼ë§¤ìˆ˜' :
                      stock.volumeAnalysis.indicators.mfi <= 30 ? 'ê³¼ë§¤ë„' : 'ì¤‘ë¦½'
                    }
                  />
                  <StatBox
                    label="OBV (ê±°ë˜ëŸ‰ ì¶”ì„¸)"
                    value={(stock.volumeAnalysis.indicators.obv / 1000000).toFixed(1) + 'M'}
                    desc={stock.volumeAnalysis.signals.obvTrend}
                  />
                  <StatBox
                    label="VWAP (í‰ê· ê°€)"
                    value={stock.volumeAnalysis.indicators.vwap?.toLocaleString()}
                    desc={stock.volumeAnalysis.signals.priceVsVWAP}
                  />
                </div>
                <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                  <StatBox
                    label="ê±°ë˜ëŸ‰ ë¹„ìœ¨"
                    value={stock.volumeAnalysis.current.volumeMA20 ?
                      (stock.volume / stock.volumeAnalysis.current.volumeMA20).toFixed(1) + 'x' : 'N/A'}
                    desc="vs 20ì¼ í‰ê· "
                  />
                  <StatBox
                    label="ë¹„ëŒ€ì¹­ ë¹„ìœ¨ (ìƒìŠ¹ì¼/í•˜ë½ì¼)"
                    value={stock.advancedAnalysis.indicators.asymmetric.ratio}
                    desc={`${stock.advancedAnalysis.indicators.asymmetric.signal} | ìƒìŠ¹ ${stock.advancedAnalysis.indicators.asymmetric.upDays}ì¼(${(stock.advancedAnalysis.indicators.asymmetric.upVolume / 1000000).toFixed(0)}M) vs í•˜ë½ ${stock.advancedAnalysis.indicators.asymmetric.downDays}ì¼(${(stock.advancedAnalysis.indicators.asymmetric.downVolume / 1000000).toFixed(0)}M)`}
                  />
                  <StatBox
                    label="ìµœê·¼ 5ì¼ ê±°ë˜ëŸ‰ ë³€ë™ìœ¨"
                    value={stock.trendAnalysis && stock.trendAnalysis.dailyData.length >= 5 ?
                      (() => {
                        // ê¸°í•˜í‰ê·  ê³„ì‚°: (v1 * v2 * v3 * v4 * v5)^(1/5)
                        const changes = stock.trendAnalysis.dailyData.slice(0, 5).map(d => d.volumeChange);
                        const positiveChanges = changes.map(c => 1 + (c / 100)); // ë³€ë™ìœ¨ì„ ìŠ¹ìˆ˜ë¡œ ë³€í™˜
                        const product = positiveChanges.reduce((acc, val) => acc * val, 1);
                        const geometricMean = Math.pow(product, 1 / positiveChanges.length);
                        const avgChange = (geometricMean - 1) * 100;
                        return (avgChange >= 0 ? '+' : '') + avgChange.toFixed(1) + '%';
                      })()
                      : 'N/A'}
                    desc="5ì¼ ê¸°í•˜í‰ê· "
                  />
                </div>
              </div>

              {/* ì‹ í˜¸ ìš”ì•½ */}
              <div className="bg-indigo-50 border-2 border-indigo-200 rounded-xl p-6">
                <h3 className="text-xl font-bold mb-4 text-indigo-900">ğŸ“¢ ê°ì§€ëœ ì‹ í˜¸</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                  {stock.advancedAnalysis.signals.map((signal, i) => {
                    // ì‹ í˜¸ë³„ ì„¸ë¶€ ë°ì´í„° êµ¬ì„±
                    let tooltipContent = null;

                    // ì•½í•œ ë§ˆê° / ìœ—ê¼¬ë¦¬ ì‹ í˜¸
                    if (signal.includes('ì•½í•œ ë§ˆê°') || signal.includes('ìœ—ê¼¬ë¦¬')) {
                      const escapeData = stock.advancedAnalysis.indicators.escape;
                      tooltipContent = escapeData && (
                        <div className="space-y-1">
                          <div className="font-bold text-yellow-300">âš ï¸ ìœ—ê¼¬ë¦¬ ê¸´ ìŒë´‰ (Weak Close)</div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div>â€¢ ì¢…ê°€: {stock.currentPrice.toLocaleString()}ì›</div>
                          <div>â€¢ ê³ ê°€: {escapeData.resistance ? escapeData.resistance.toLocaleString() : 'N/A'}ì›</div>
                          <div>â€¢ ìœ—ê¼¬ë¦¬ ë¹„ìœ¨: <span className="text-red-300">{escapeData.upperShadow || 'N/A'}%</span></div>
                          <div>â€¢ ê³ ê°€ ëŒ€ë¹„ ë‚™í­: <span className="text-red-300">{escapeData.highDecline || 'N/A'}%</span></div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div className="text-yellow-300">â†’ í•´ì„: ê³ ê°€ ëŒ€ë¹„ í•˜ë½ ë§ˆê°, ë§¤ë„ ì••ë ¥ ì¡´ì¬</div>
                        </div>
                      );
                    }

                    // ìœ ë™ì„± ê³ ê°ˆ ì‹ í˜¸
                    if (signal.includes('ìœ ë™ì„± ê³ ê°ˆ')) {
                      const liquidityData = stock.liquidity;
                      tooltipContent = liquidityData && (
                        <div className="space-y-1">
                          <div className="font-bold text-yellow-300">ğŸ’§ ê±°ë˜ëŒ€ê¸ˆ ë¶€ì¡± (Low Liquidity)</div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div>â€¢ ê±°ë˜ëŒ€ê¸ˆ: {liquidityData.tradingValue ? (liquidityData.tradingValue / 100000000).toFixed(0) : 'N/A'}ì–µì›</div>
                          <div>â€¢ ì‹œê°€ì´ì•¡: {stock.marketCap ? (stock.marketCap / 100000000).toFixed(0) : 'N/A'}ì–µì›</div>
                          <div>â€¢ íšŒì „ìœ¨: <span className="text-yellow-300">{liquidityData.turnoverRate ? liquidityData.turnoverRate.toFixed(2) : 'N/A'}%</span></div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div className="text-yellow-300">â†’ í•´ì„: ì‹œì´ ëŒ€ë¹„ ê±°ë˜ ì ì–´ ê°€ê²© ë³€ë™ì„± ë†’ì„ ìˆ˜ ìˆìŒ</div>
                        </div>
                      );
                    }

                    // ê°•í•œ ë§¤ë„ì„¸ ì‹ í˜¸
                    if (signal.includes('ë§¤ë„ì„¸') || signal.includes('í•˜ë½ì¼ ê±°ë˜')) {
                      const asymmetric = stock.advancedAnalysis.indicators.asymmetric;
                      tooltipContent = asymmetric && (
                        <div className="space-y-1">
                          <div className="font-bold text-red-300">ğŸ“‰ í•˜ë½ì¼ ê±°ë˜ëŸ‰ ì§‘ì¤‘ (Strong Selling)</div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div>â€¢ ë¶„ì„ ê¸°ê°„: ìµœê·¼ 20ì¼ê°„</div>
                          <div>â€¢ í•˜ë½ì¼ í‰ê· : <span className="text-red-300">{asymmetric.downDays ? (asymmetric.downVolume / asymmetric.downDays / 1000).toFixed(0) : 'N/A'}Kì£¼/ì¼</span></div>
                          <div>â€¢ ìƒìŠ¹ì¼ í‰ê· : {asymmetric.upDays ? (asymmetric.upVolume / asymmetric.upDays / 1000).toFixed(0) : 'N/A'}Kì£¼/ì¼</div>
                          <div>â€¢ ë¹„ìœ¨: <span className="text-red-300">{asymmetric.ratio ? (1 / asymmetric.ratio).toFixed(2) : 'N/A'}ë°°</span></div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div className="text-yellow-300">â†’ í•´ì„: í•˜ë½í•  ë•Œ ê±°ë˜ëŸ‰ ë§ì•„ ë§¤ë„ ì••ë ¥ ê°•í•¨</div>
                        </div>
                      );
                    }

                    // ê°•í•œ ë§¤ìˆ˜ì„¸ ì‹ í˜¸
                    if (signal.includes('ë§¤ìˆ˜ì„¸') || signal.includes('ìƒìŠ¹ì¼ ê±°ë˜') || signal.includes('ë¹„ëŒ€ì¹­')) {
                      const asymmetric = stock.advancedAnalysis.indicators.asymmetric;
                      tooltipContent = asymmetric && (
                        <div className="space-y-1">
                          <div className="font-bold text-green-300">ğŸ“ˆ ìƒìŠ¹ì¼ ê±°ë˜ëŸ‰ ì§‘ì¤‘ (Strong Buying)</div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div>â€¢ ë¶„ì„ ê¸°ê°„: ìµœê·¼ 20ì¼ê°„</div>
                          <div>â€¢ ìƒìŠ¹ì¼ í‰ê· : <span className="text-green-300">{asymmetric.upDays ? (asymmetric.upVolume / asymmetric.upDays / 1000).toFixed(0) : 'N/A'}Kì£¼/ì¼</span></div>
                          <div>â€¢ í•˜ë½ì¼ í‰ê· : {asymmetric.downDays ? (asymmetric.downVolume / asymmetric.downDays / 1000).toFixed(0) : 'N/A'}Kì£¼/ì¼</div>
                          <div>â€¢ ë¹„ìœ¨: <span className="text-green-300">{asymmetric.ratio}ë°°</span></div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div className="text-yellow-300">â†’ í•´ì„: ìƒìŠ¹í•  ë•Œ ê±°ë˜ëŸ‰ {asymmetric.ratio}ë°° ë§ì•„ ë§¤ìˆ˜ ì••ë ¥ ê°•í•¨</div>
                        </div>
                      );
                    }

                    // ê³ ë˜ ê°ì§€ ì‹ í˜¸
                    if (signal.includes('ê³ ë˜') || signal.includes('ğŸ‹')) {
                      const whaleData = stock.advancedAnalysis.indicators.whale;
                      const latestWhale = whaleData && whaleData.length > 0 ? whaleData[whaleData.length - 1] : null;
                      tooltipContent = latestWhale && (
                        <div className="space-y-1">
                          <div className="font-bold text-blue-300">ğŸ‹ ëŒ€ëŸ‰ ê±°ë˜ ê°ì§€ (Whale Detection)</div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div>â€¢ ë‚ ì§œ: {latestWhale.date}</div>
                          <div>â€¢ ê±°ë˜ëŸ‰ ë¹„ìœ¨: <span className="text-blue-300">{latestWhale.volumeRatio}ë°°</span></div>
                          <div>â€¢ ê°€ê²© ë³€ë™: {latestWhale.priceChange}%</div>
                          <div>â€¢ ìœ—ê¼¬ë¦¬: {latestWhale.upperShadow}%</div>
                          {latestWhale.warning && (
                            <div className="text-red-300">âš ï¸ {latestWhale.warning}</div>
                          )}
                          <div className="border-t border-gray-700 my-1"></div>
                          <div className="text-yellow-300">â†’ í•´ì„: ê¸°ê´€/ì™¸êµ­ì¸ ë“± ì„¸ë ¥ ë§¤ìˆ˜ ì‹ í˜¸</div>
                        </div>
                      );
                    }

                    // ìŠ¤ë§ˆíŠ¸ë¨¸ë‹ˆ ìœ ì… ì‹ í˜¸
                    if (signal.includes('ìŠ¤ë§ˆíŠ¸ë¨¸ë‹ˆ')) {
                      const smartMoneyData = stock.advancedAnalysis.indicators.smartMoney;
                      tooltipContent = smartMoneyData && (
                        <div className="space-y-1">
                          <div className="font-bold text-blue-300">ğŸ§  ìŠ¤ë§ˆíŠ¸ë¨¸ë‹ˆ ìœ ì… (Smart Money)</div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div>â€¢ ëŒ€í˜• ê±°ë˜ í‰ê·  ìˆ˜ìµë¥ : <span className="text-green-300">{smartMoneyData.bigVolumeReturn}%</span></div>
                          <div>â€¢ ì†Œí˜• ê±°ë˜ í‰ê·  ìˆ˜ìµë¥ : <span className="text-red-300">{smartMoneyData.smallVolumeReturn}%</span></div>
                          <div>â€¢ ëŒ€í˜•/ì†Œí˜• ë¹„ìœ¨: <span className="text-blue-300">{smartMoneyData.ratio}ë°°</span></div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div className="text-yellow-300">â†’ í•´ì„: {smartMoneyData.interpretation}</div>
                        </div>
                      );
                    }

                    // ì¡°ìš©í•œ ë§¤ì§‘ ì‹ í˜¸
                    if (signal.includes('ì¡°ìš©í•œ ë§¤ì§‘')) {
                      const accumData = stock.advancedAnalysis.indicators.accumulation;
                      tooltipContent = accumData && (
                        <div className="space-y-1">
                          <div className="font-bold text-green-300">ğŸ¤« ì¡°ìš©í•œ ë§¤ì§‘ (Silent Accumulation)</div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div>â€¢ ê°€ê²© ë³€ë™í­: {accumData.priceRange}%</div>
                          <div>â€¢ ê±°ë˜ëŸ‰ ì¦ê°€ìœ¨: <span className="text-green-300">+{accumData.volumeGrowth}%</span></div>
                          <div>â€¢ í‰ê· ê°€: {accumData.avgPrice ? accumData.avgPrice.toLocaleString() : 'N/A'}ì›</div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div className="text-yellow-300">â†’ í•´ì„: ê°€ê²© íš¡ë³´ ì¤‘ ê±°ë˜ëŸ‰ ì¦ê°€ = ì„¸ë ¥ ë§¤ì§‘</div>
                        </div>
                      );
                    }

                    // íƒˆì¶œ ì†ë„ ì‹ í˜¸
                    if (signal.includes('íƒˆì¶œ ì†ë„')) {
                      const escapeData = stock.advancedAnalysis.indicators.escape;
                      tooltipContent = escapeData && (
                        <div className="space-y-1">
                          <div className="font-bold text-orange-300">ğŸš€ íƒˆì¶œ ì†ë„ (Escape Velocity)</div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div>â€¢ ì €í•­ì„ : {escapeData.resistance ? escapeData.resistance.toLocaleString() : 'N/A'}ì›</div>
                          <div>â€¢ í˜„ì¬ê°€: {stock.currentPrice.toLocaleString()}ì›</div>
                          <div>â€¢ ê±°ë˜ëŸ‰ ë¹„ìœ¨: <span className="text-blue-300">{escapeData.volumeRatio}ë°°</span></div>
                          <div>â€¢ Closing Strength: <span className="text-green-300">{escapeData.closingStrength}%</span></div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div className="text-yellow-300">â†’ í•´ì„: ì €í•­ì„  ëŒíŒŒ + ê±°ë˜ëŸ‰ í­ë°œ + ê°•í•œ ë§ˆê°</div>
                        </div>
                      );
                    }

                    // ì¡°ìš©í•œ ëˆ„ì  ì‹ í˜¸
                    if (signal.includes('ì¡°ìš©í•œ ëˆ„ì ')) {
                      const gradualData = stock.advancedAnalysis.indicators.gradualAccumulation;
                      tooltipContent = gradualData && (
                        <div className="space-y-1">
                          <div className="font-bold text-purple-300">ğŸŒ ì¡°ìš©í•œ ëˆ„ì  (Gradual Accumulation)</div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div>â€¢ ê±°ë˜ëŸ‰ ì¦ê°€ìœ¨: <span className="text-green-300">+{gradualData.growthRate}%</span></div>
                          <div>â€¢ ê°€ê²© ë³€ë™: {gradualData.priceChange}% (ì•ˆì •ì )</div>
                          <div>â€¢ ì—°ì† ê±°ë˜ëŸ‰ ì¦ê°€: {gradualData.consecutiveDays}ì¼</div>
                          <div>â€¢ ê¸‰ë“± ì˜ˆìƒ: {gradualData.readyIn}</div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div className="text-yellow-300">â†’ í•´ì„: {gradualData.interpretation}</div>
                        </div>
                      );
                    }

                    // ì €ì  í˜•ì„± ì‹ í˜¸
                    if (signal.includes('ì €ì  í˜•ì„±')) {
                      const bottomData = stock.advancedAnalysis.indicators.bottomFormation;
                      tooltipContent = bottomData && (
                        <div className="space-y-1">
                          <div className="font-bold text-teal-300">ğŸŒ± ì €ì  í˜•ì„± (Bottom Formation)</div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div>â€¢ ê³ ì : {bottomData.highPrice ? bottomData.highPrice.toLocaleString() : 'N/A'}ì›</div>
                          <div>â€¢ í˜„ì¬ê°€: {bottomData.currentPrice ? bottomData.currentPrice.toLocaleString() : 'N/A'}ì›</div>
                          <div>â€¢ í•˜ë½í­: <span className="text-red-300">{bottomData.decline}%</span></div>
                          <div>â€¢ ê±°ë˜ëŸ‰ ë¹„ìœ¨: {bottomData.volumeRatio}ë°° (ê³ ê°ˆ)</div>
                          <div>â€¢ ê°€ê²© ë³€ë™í­: {bottomData.priceRange}% (ì•ˆì •)</div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div className="text-yellow-300">â†’ í•´ì„: {bottomData.interpretation}</div>
                        </div>
                      );
                    }

                    // ì €í•­ì„  ëŒíŒŒ ì¤€ë¹„ ì‹ í˜¸
                    if (signal.includes('ëŒíŒŒ ì¤€ë¹„')) {
                      const breakoutPrepData = stock.advancedAnalysis.indicators.breakoutPrep;
                      tooltipContent = breakoutPrepData && (
                        <div className="space-y-1">
                          <div className="font-bold text-pink-300">ğŸšª ì €í•­ì„  ëŒíŒŒ ì¤€ë¹„ (Breakout Prep)</div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div>â€¢ ì €í•­ì„ : {breakoutPrepData.resistance ? breakoutPrepData.resistance.toLocaleString() : 'N/A'}ì›</div>
                          <div>â€¢ í˜„ì¬ê°€: {breakoutPrepData.currentPrice ? breakoutPrepData.currentPrice.toLocaleString() : 'N/A'}ì›</div>
                          <div>â€¢ ê²©ì°¨: <span className="text-yellow-300">{breakoutPrepData.gap}%</span></div>
                          <div>â€¢ í„°ì¹˜ íšŸìˆ˜: {breakoutPrepData.touchCount}íšŒ</div>
                          <div>â€¢ ê±°ë˜ëŸ‰ ì¦ê°€: <span className="text-green-300">+{breakoutPrepData.volumeGrowth}%</span></div>
                          <div className="border-t border-gray-700 my-1"></div>
                          <div className="text-yellow-300">â†’ í•´ì„: {breakoutPrepData.interpretation}</div>
                          {breakoutPrepData.triggerPrice && (
                            <div className="text-orange-300">â†’ ë§¤ìˆ˜ íŠ¸ë¦¬ê±°: {breakoutPrepData.triggerPrice.toLocaleString()}ì›</div>
                          )}
                        </div>
                      );
                    }

                    return (
                      <div key={i} className="bg-white p-3 rounded-lg border-2 border-indigo-300 relative group">
                        <div className="font-semibold text-indigo-700 mb-1">{signal} {tooltipContent && 'â“˜'}</div>

                        {/* Tooltip */}
                        {tooltipContent && (
                          <div className="absolute bottom-full left-0 mb-2 w-80 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 shadow-xl">
                            {tooltipContent}
                            <div className="absolute top-full left-6 transform -mt-1">
                              <div className="border-4 border-transparent border-t-gray-900"></div>
                            </div>
                          </div>
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>

              {/* ì ìˆ˜ ì‚°ì¶œ ê¸°ì¤€ */}
              {stock.scoreBreakdown && (
                <div className="bg-gradient-to-br from-yellow-50 to-orange-50 border-2 border-yellow-300 rounded-xl p-6">
                  <h3 className="text-2xl font-bold mb-4 text-orange-900 flex items-center gap-2">
                    ğŸ¯ ì ìˆ˜ ì‚°ì¶œ ê¸°ì¤€
                    <span className="text-lg font-normal text-gray-700">
                      (ì´ {typeof stock.scoreBreakdown.finalScore === 'number' ? stock.scoreBreakdown.finalScore.toFixed(2) : stock.scoreBreakdown.finalScore}ì  / 100ì )
                    </span>
                  </h3>

                  {/* ê¸°ë³¸ ì ìˆ˜ */}
                  <div className="bg-white rounded-lg p-4 mb-4 border-2 border-blue-200">
                    <h4 className="font-bold text-lg text-blue-900 mb-3 flex items-center gap-2">
                      ğŸ“Š ê¸°ë³¸ ì ìˆ˜: {stock.scoreBreakdown.baseScore}ì 
                      <span className="text-sm font-normal text-gray-600">(0-20ì  ë²”ìœ„)</span>
                    </h4>
                    <div className="space-y-2 text-sm">
                      <div className="flex justify-between items-start p-2 bg-blue-50 rounded">
                        <div className="flex-1">
                          <div className="font-semibold text-blue-900">1. ê±°ë˜ëŸ‰ ë¹„ìœ¨ (0-8ì )</div>
                          <div className="text-gray-700 mt-1">
                            â€¢ í˜„ì¬ ê±°ë˜ëŸ‰: {(stock.volume / 1000).toFixed(0)}K<br/>
                            â€¢ 20ì¼ í‰ê· : {stock.volumeAnalysis.current.volumeMA20 ? (stock.volumeAnalysis.current.volumeMA20 / 1000).toFixed(0) + 'K' : 'N/A'}<br/>
                            â€¢ ë¹„ìœ¨: {stock.volumeAnalysis.current.volumeMA20 ? (stock.volume / stock.volumeAnalysis.current.volumeMA20).toFixed(2) + 'ë°°' : 'N/A'}
                          </div>
                        </div>
                      </div>
                      <div className="flex justify-between items-start p-2 bg-blue-50 rounded">
                        <div className="flex-1">
                          <div className="font-semibold text-blue-900">2. OBV ì¶”ì„¸ (0-7ì )</div>
                          <div className="text-gray-700 mt-1">
                            â€¢ OBV ê°’: {(stock.volumeAnalysis.indicators.obv / 1000000).toFixed(1)}M<br/>
                            â€¢ ì¶”ì„¸: {stock.volumeAnalysis.signals.obvTrend}
                          </div>
                        </div>
                      </div>
                      <div className="flex justify-between items-start p-2 bg-blue-50 rounded">
                        <div className="flex-1">
                          <div className="font-semibold text-blue-900">3. VWAP ëª¨ë©˜í…€ (0-5ì )</div>
                          <div className="text-gray-700 mt-1">
                            â€¢ VWAP: {stock.volumeAnalysis.indicators.vwap?.toLocaleString()}ì›<br/>
                            â€¢ í˜„ì¬ê°€: {stock.currentPrice.toLocaleString()}ì›<br/>
                            â€¢ ëª¨ë©˜í…€: {stock.volumeAnalysis.signals.priceVsVWAP}
                          </div>
                        </div>
                      </div>
                      <div className="flex justify-between items-start p-2 bg-blue-50 rounded">
                        <div className="flex-1">
                          <div className="font-semibold text-blue-900">4. ë¹„ëŒ€ì¹­ ë¹„ìœ¨ (0-5ì )</div>
                          <div className="text-gray-700 mt-1">
                            â€¢ ìƒìŠ¹ì¼: {stock.advancedAnalysis.indicators.asymmetric.upDays}ì¼ ({(stock.advancedAnalysis.indicators.asymmetric.upVolume / 1000000).toFixed(1)}M)<br/>
                            â€¢ í•˜ë½ì¼: {stock.advancedAnalysis.indicators.asymmetric.downDays}ì¼ ({(stock.advancedAnalysis.indicators.asymmetric.downVolume / 1000000).toFixed(1)}M)<br/>
                            â€¢ ë¹„ìœ¨: {stock.advancedAnalysis.indicators.asymmetric.ratio}ë°° ({stock.advancedAnalysis.indicators.asymmetric.signal})
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* ê°€ì  í•­ëª© */}
                  <div className="bg-white rounded-lg p-4 border-2 border-green-200">
                    <h4 className="font-bold text-lg text-green-900 mb-3 flex items-center gap-2">
                      â• ê°€ì  í•­ëª©: {stock.scoreBreakdown.bonuses.reduce((sum, b) => sum + b.value, 0)}ì 
                      <span className="text-sm font-normal text-gray-600">(0-80ì  ë²”ìœ„)</span>
                    </h4>
                    <div className="space-y-2">
                      {stock.scoreBreakdown.bonuses.map((bonus, idx) => {
                        // ë³´ë„ˆìŠ¤ í•­ëª©ë³„ ë°°ì  ê¸°ì¤€ ë§¤í•‘
                        const scoringCriteria = {
                          'VPD (ê±°ë˜ëŸ‰-ê°€ê²© ë‹¤ì´ë²„ì „ìŠ¤)': {
                            max: 35,
                            criteria: [
                              'ì¡°ìš©í•œ ë§¤ì§‘ (divergence 3.0+, ê°€ê²© Â±10%): 28-35ì ',
                              'ì´ˆê¸° ë‹¨ê³„ (divergence 2.0-3.0, ê°€ê²© Â±15%): 20-27ì ',
                              'ì¤‘ê°„ ë‹¨ê³„ (divergence 1.0-2.0): 12-19ì '
                            ]
                          },
                          'ê¸°ê´€/ì™¸êµ­ì¸ ìˆ˜ê¸‰': {
                            max: 15,
                            criteria: [
                              'ê¸°ê´€+ì™¸êµ­ì¸ ë™ë°˜ ë§¤ìˆ˜ (ì—°ì† 3ì¼+): 15ì ',
                              'ê¸°ê´€ ë˜ëŠ” ì™¸êµ­ì¸ ì—°ì† ë§¤ìˆ˜: 10ì '
                            ]
                          },
                          'í•©ë¥˜ì  (Confluence)': {
                            max: 12,
                            criteria: [
                              '5ê°œ ì´ìƒ ì§€í‘œ ë™ì‹œ ì‹ í˜¸: 12ì ',
                              '3-4ê°œ ì§€í‘œ ì‹ í˜¸: 9ì ',
                              '2ê°œ ì§€í‘œ ì‹ í˜¸: 6ì '
                            ]
                          },
                          'ì„ í–‰ ì§€í‘œ (íŒ¨í„´+DNA)': {
                            max: 10,
                            criteria: [
                              'íŒ¨í„´ ë§¤ì¹­ë„ 70% ì´ìƒ: 5-7ì ',
                              'DNA ìœ ì‚¬ë„ 70% ì´ìƒ: 5-7ì ',
                              'í•˜ì´ë¸Œë¦¬ë“œ ì ìˆ˜ = íŒ¨í„´ 50% + DNA 50%'
                            ]
                          }
                        };

                        const criteria = scoringCriteria[bonus.name];

                        return (
                          <div key={idx} className="p-3 bg-green-50 rounded-lg border border-green-200">
                            <div className="flex justify-between items-start mb-2">
                              <div>
                                <div className="font-semibold text-green-900">{bonus.name}</div>
                                {criteria && (
                                  <div className="text-xs text-gray-600 mt-1">(ìµœëŒ€ {criteria.max}ì )</div>
                                )}
                              </div>
                              <div className="text-lg font-bold text-green-700">+{bonus.value}ì </div>
                            </div>

                            {/* ë°°ì  ê¸°ì¤€ í‘œì‹œ */}
                            {criteria && (
                              <div className="text-xs text-gray-600 bg-yellow-50 p-2 rounded mt-2 border border-yellow-200">
                                <div className="font-semibold mb-1">ğŸ“Š ë°°ì  ê¸°ì¤€:</div>
                                {criteria.criteria.map((c, i) => (
                                  <div key={i} className="ml-2">â€¢ {c}</div>
                                ))}
                              </div>
                            )}

                            {bonus.details && (
                              <div className="text-xs text-gray-700 mt-2 p-2 bg-white rounded border border-gray-200">
                              {/* VPD ì„¸ë¶€ ì •ë³´ */}
                              {bonus.details.divergence !== undefined && (
                                <div className="space-y-1">
                                  <div>â€¢ ê±°ë˜ëŸ‰ ë¹„ìœ¨: {bonus.details.volumeRatio}ë°°</div>
                                  <div>â€¢ ê°€ê²© ë³€ë™: {bonus.details.priceChange >= 0 ? '+' : ''}{bonus.details.priceChange}%</div>
                                  <div>â€¢ Divergence: {bonus.details.divergence.toFixed(2)}</div>
                                  <div>â€¢ ì‹ í˜¸: {bonus.details.signal}</div>
                                </div>
                              )}
                              {/* ì„ í–‰ ì§€í‘œ ì„¸ë¶€ ì •ë³´ */}
                              {bonus.details.strength && (
                                <div className="space-y-1">
                                  <div>â€¢ ê°•ë„: {bonus.details.strength}</div>
                                  <div>â€¢ íŒ¨í„´ ë§¤ì¹­: {bonus.details.patternMatched ? 'âœ…' : 'âŒ'}</div>
                                  <div>â€¢ DNA ë§¤ì¹­: {bonus.details.dnaMatched ? 'âœ…' : 'âŒ'}</div>
                                  <div>â€¢ ì‹ ë¢°ë„: {bonus.details.confidence}%</div>

                                  {/* ì „ì²´ íŒ¨í„´ í’€ í‘œì‹œ (18ê°œ, ì²´í¬ë§ˆí¬ ë°©ì‹) */}
                                  {stock.leadingIndicators && stock.leadingIndicators.pattern && (
                                    <div className="mt-2 pt-2 border-t border-gray-200">
                                      <div className="font-semibold mb-1 text-blue-800">ğŸ“‹ íŒ¨í„´ í’€ ({stock.leadingIndicators.pattern.totalMatched || 0}/18 ë§¤ì¹­):</div>
                                      {(() => {
                                        // ì „ì²´ 18ê°œ íŒ¨í„´ ì •ì˜ (10 D-5 + 8 existing)
                                        const allPatterns = [
                                          // D-5 ì„ í–‰ íŒ¨í„´ (10ê°œ)
                                          { key: 'pre_5d_accumulation', name: '5ì¼ ì¡°ìš©í•œ ë§¤ì§‘', category: 'D-5' },
                                          { key: 'pre_5d_accumulation_whale', name: '5ì¼ ë§¤ì§‘+ê³ ë˜', category: 'D-5' },
                                          { key: 'pre_5d_obv_rising', name: '5ì¼ OBVìƒìŠ¹', category: 'D-5' },
                                          { key: 'pre_5d_volume_gradual', name: '5ì¼ ê±°ë˜ëŸ‰ì¦ê°€', category: 'D-5' },
                                          { key: 'pre_5d_rsi_volume', name: '5ì¼ RSIì¤‘ë¦½+ê±°ë˜ëŸ‰', category: 'D-5' },
                                          { key: 'pre_5d_volume_2x', name: '5ì¼ ê±°ë˜ëŸ‰ 2ë°°', category: 'D-5' },
                                          { key: 'pre_5d_volume_3x', name: '5ì¼ ê±°ë˜ëŸ‰ 3ë°°', category: 'D-5' },
                                          { key: 'pre_5d_volume_5x', name: '5ì¼ ê±°ë˜ëŸ‰ 5ë°°', category: 'D-5' },
                                          { key: 'pre_5d_volume_10x', name: '5ì¼ ê±°ë˜ëŸ‰ 10ë°°+', category: 'D-5' },
                                          { key: 'pre_5d_stable_rsi', name: '5ì¼ ì•ˆì •RSI', category: 'D-5' },
                                          // ê¸°ì¡´ íŒ¨í„´ (8ê°œ)
                                          { key: 'whale_accumulation', name: 'ê³ ë˜ ë§¤ì§‘ í›„ ê¸‰ë“±', category: 'ê¸°ì¡´' },
                                          { key: 'drain_escape', name: 'ìœ ë™ì„± ê³ ê°ˆ â†’ íƒˆì¶œ', category: 'ê¸°ì¡´' },
                                          { key: 'whale_highvolume', name: 'ê³ ë˜ + ì´ˆëŒ€ëŸ‰', category: 'ê¸°ì¡´' },
                                          { key: 'asymmetric_accumulation', name: 'ë¹„ëŒ€ì¹­ + ë§¤ì§‘', category: 'ê¸°ì¡´' },
                                          { key: 'escape_strongclose', name: 'íƒˆì¶œ + ê°•í•œ ë§ˆê°', category: 'ê¸°ì¡´' },
                                          { key: 'mfi_oversold_whale', name: 'MFI ê³¼ë§¤ë„ + ê³ ë˜', category: 'ê¸°ì¡´' },
                                          { key: 'drain_asymmetric', name: 'ê³ ê°ˆ + ë¹„ëŒ€ì¹­', category: 'ê¸°ì¡´' },
                                          { key: 'accumulation_moderate', name: 'ì¡°ìš©í•œ ë§¤ì§‘ (ì¤‘ê°„)', category: 'ê¸°ì¡´' }
                                        ];

                                        // ë§¤ì¹­ëœ íŒ¨í„´ì˜ í‚¤ ëª©ë¡
                                        const matchedKeys = stock.leadingIndicators.pattern.patterns
                                          ? stock.leadingIndicators.pattern.patterns.map(p => p.key || p.name)
                                          : [];

                                        // D-5 íŒ¨í„´ê³¼ ê¸°ì¡´ íŒ¨í„´ ë¶„ë¦¬
                                        const d5Patterns = allPatterns.filter(p => p.category === 'D-5');
                                        const existingPatterns = allPatterns.filter(p => p.category === 'ê¸°ì¡´');

                                        return (
                                          <div className="space-y-2 pl-2 text-xs">
                                            {/* D-5 ì„ í–‰ íŒ¨í„´ */}
                                            <div>
                                              <div className="font-semibold text-purple-700 mb-1">â–¸ D-5 ì„ í–‰ íŒ¨í„´ (10ê°œ):</div>
                                              <div className="grid grid-cols-2 gap-1">
                                                {d5Patterns.map((pattern, i) => {
                                                  const matched = matchedKeys.some(k =>
                                                    k === pattern.key ||
                                                    k.includes(pattern.key) ||
                                                    pattern.name.includes(k)
                                                  );
                                                  return (
                                                    <div key={i} className={matched ? "text-green-700 font-semibold" : "text-gray-500"}>
                                                      {matched ? 'âœ…' : 'â—»ï¸'} {pattern.name}
                                                    </div>
                                                  );
                                                })}
                                              </div>
                                            </div>

                                            {/* ê¸°ì¡´ íŒ¨í„´ */}
                                            <div>
                                              <div className="font-semibold text-blue-700 mb-1">â–¸ ê¸°ì¡´ íŒ¨í„´ (8ê°œ):</div>
                                              <div className="grid grid-cols-2 gap-1">
                                                {existingPatterns.map((pattern, i) => {
                                                  const matched = matchedKeys.some(k =>
                                                    k === pattern.key ||
                                                    k.includes(pattern.key) ||
                                                    pattern.name.includes(k)
                                                  );
                                                  return (
                                                    <div key={i} className={matched ? "text-green-700 font-semibold" : "text-gray-500"}>
                                                      {matched ? 'âœ…' : 'â—»ï¸'} {pattern.name}
                                                    </div>
                                                  );
                                                })}
                                              </div>
                                            </div>

                                            {/* ë§¤ì¹­ëœ íŒ¨í„´ ìƒì„¸ ì •ë³´ */}
                                            {stock.leadingIndicators.pattern.patterns && stock.leadingIndicators.pattern.patterns.length > 0 && (
                                              <div className="mt-2 pt-2 border-t border-gray-300">
                                                <div className="font-semibold text-green-700 mb-1">âœ… ë§¤ì¹­ ìƒì„¸:</div>
                                                {stock.leadingIndicators.pattern.patterns.map((p, i) => (
                                                  <div key={i} className="text-gray-700">
                                                    â€¢ <span className="font-semibold">{p.name}</span>:
                                                    ë§¤ì¹­ë„ {(p.matchScore * 100).toFixed(0)}%,
                                                    ìŠ¹ë¥  {p.winRate}%,
                                                    ì ìˆ˜ {p.points.toFixed(1)}ì 
                                                  </div>
                                                ))}
                                              </div>
                                            )}
                                          </div>
                                        );
                                      })()}
                                    </div>
                                  )}

                                  {/* DNA ê±°ë˜ëŸ‰ íŒ¨í„´ í‘œì‹œ */}
                                  {stock.leadingIndicators && stock.leadingIndicators.dna && stock.leadingIndicators.dna.volumePattern && (
                                    <div className="mt-2 pt-2 border-t border-gray-200">
                                      <div className="font-semibold mb-1 text-purple-800">ğŸ§¬ DNA ê±°ë˜ëŸ‰ íŒ¨í„´:</div>
                                      <div className="space-y-1 pl-2 text-xs">
                                        <div>â€¢ EMA í‰ê· : <span className="font-semibold">{stock.leadingIndicators.dna.volumePattern.emaAvg?.toFixed(1)}%</span></div>
                                        <div>â€¢ ìµœê·¼ 5ì¼: <span className="font-semibold">{stock.leadingIndicators.dna.volumePattern.recent5d?.toFixed(1)}%</span></div>
                                        <div>â€¢ íŠ¸ë Œë“œ: <span className="font-semibold">{stock.leadingIndicators.dna.volumePattern.segmented?.trend || 'N/A'}</span></div>
                                        <div>â€¢ ê¸‰ë“± ì„ë°•ì„±: <span className="font-semibold">{stock.leadingIndicators.dna.volumePattern.urgency || 'N/A'}</span></div>
                                      </div>
                                    </div>
                                  )}
                                </div>
                              )}
                            </div>
                          )}

                          {/* í•©ë¥˜ì  (Confluence) ì„¸ë¶€ ì§€í‘œ ëª©ë¡ */}
                          {bonus.name === 'í•©ë¥˜ì  (Confluence)' && stock.confluence && stock.confluence.signals && stock.confluence.signals.length > 0 && (
                            <div className="text-xs text-gray-700 mt-2 p-2 bg-white rounded border border-gray-200">
                              <div className="font-semibold mb-2 text-blue-800">ğŸ“Š ê°ì§€ëœ ì§€í‘œ ({stock.confluence.confluenceCount}ê°œ):</div>
                              <div className="flex flex-wrap gap-1">
                                {stock.confluence.signals.map((sig, i) => (
                                  <span key={i} className="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-semibold">
                                    {sig}
                                  </span>
                                ))}
                              </div>
                            </div>
                          )}

                          {/* ì‹ í˜¸ ì‹ ì„ ë„ ì„¸ë¶€ ì‹ í˜¸ ëª©ë¡ */}
                          {bonus.name === 'ì‹ í˜¸ ì‹ ì„ ë„' && stock.freshness && stock.freshness.freshSignals && stock.freshness.freshSignals.length > 0 && (
                            <div className="text-xs text-gray-700 mt-2 p-2 bg-white rounded border border-gray-200">
                              <div className="font-semibold mb-2 text-green-800">ğŸ• ì‹ ì„ í•œ ì‹ í˜¸ ({stock.freshness.freshCount}ê°œ):</div>
                              <div className="flex flex-wrap gap-1">
                                {stock.freshness.freshSignals.map((sig, i) => (
                                  <span key={i} className="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-semibold">
                                    {sig}
                                  </span>
                                ))}
                              </div>
                            </div>
                          )}
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  {/* ìµœì¢… ì ìˆ˜ ê³„ì‚°ì‹ */}
                  <div className="mt-4 p-4 bg-gradient-to-r from-purple-100 to-pink-100 rounded-lg border-2 border-purple-300">
                    <div className="text-center text-lg font-bold text-purple-900">
                      ìµœì¢… ì ìˆ˜ = ê¸°ë³¸ {stock.scoreBreakdown.baseScore}ì  + ê°€ì  {stock.scoreBreakdown.bonuses.reduce((sum, b) => sum + b.value, 0)}ì 
                      = <span className="text-2xl text-purple-600">{typeof stock.scoreBreakdown.finalScore === 'number' ? stock.scoreBreakdown.finalScore.toFixed(2) : stock.scoreBreakdown.finalScore}ì </span>
                    </div>
                    <div className="text-center text-sm text-gray-700 mt-2">
                      ë“±ê¸‰: <span className={`inline-block px-3 py-1 rounded-full text-white font-bold grade-${stock.recommendation.grade}`}>
                        {stock.recommendation.grade}
                      </span>
                      ({stock.recommendation.text})
                    </div>
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    }

    // ì§€í‘œ ë°•ìŠ¤
    function IndicatorBox({ title, detected, signal, detail }) {
      return (
        <div className={`p-4 rounded-lg border-2 ${detected ? 'bg-green-50 border-green-300' : 'bg-gray-50 border-gray-200'}`}>
          <h4 className="font-bold mb-2">{title}</h4>
          <p className={`font-semibold mb-1 ${detected ? 'text-green-700' : 'text-gray-500'}`}>
            {signal}
          </p>
          {detail && <p className="text-xs text-gray-600 leading-relaxed whitespace-pre-wrap break-words">{detail}</p>}
        </div>
      );
    }

    // í†µê³„ ë°•ìŠ¤
    function StatBox({ label, value, desc }) {
      return (
        <div className="bg-gray-50 p-3 rounded-lg">
          <p className="text-xs text-gray-600 mb-1">{label}</p>
          <p className="text-lg font-bold text-gray-900">{value || 'N/A'}</p>
          {desc && <p className="text-xs text-gray-500 mt-1">{desc}</p>}
        </div>
      );
    }


    // ì„±ê³¼ ê²€ì¦ ì»´í¬ë„ŒíŠ¸
    function PerformanceVerification({ apiBaseUrl }) {
      const [trackerData, setTrackerData] = useState(null);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [expandedStocks, setExpandedStocks] = useState({});
      const [expandedGrades, setExpandedGrades] = useState({});
      const [expandedCategories, setExpandedCategories] = useState({});

      useEffect(() => {
        fetchPerformanceData();
      }, []);

      const toggleExpand = (stockCode) => {
        setExpandedStocks(prev => ({
          ...prev,
          [stockCode]: !prev[stockCode]
        }));
      };

      const toggleGradeExpand = (grade) => {
        setExpandedGrades(prev => ({
          ...prev,
          [grade]: !prev[grade]
        }));
      };

      const toggleCategoryExpand = (category) => {
        setExpandedCategories(prev => ({
          ...prev,
          [category]: !prev[category]
        }));
      };

      // ì¹´í…Œê³ ë¦¬ ì„¤ëª…
      const categoryDescriptions = {
        whale: {
          icon: 'ğŸ‹',
          label: 'ê³ ë˜ ê°ì§€',
          description: 'ê±°ë˜ëŸ‰ 2.5ë°° ì´ìƒ + ê°€ê²© 3% ì´ìƒ ìƒìŠ¹. ê¸°ê´€/ì™¸êµ­ì¸ ë“± ì„¸ë ¥ ë§¤ìˆ˜ ì‹ í˜¸ë¡œ, ë‹¨ê¸° ê¸‰ë“± ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.'
        },
        accumulation: {
          icon: 'ğŸ¤«',
          label: 'ì¡°ìš©í•œ ë§¤ì§‘',
          description: 'ê°€ê²© ë³€ë™ 10% ì´ë‚´ + ê±°ë˜ëŸ‰ ì¦ê°€. ì„¸ë ¥ì´ ì¡°ìš©íˆ ë¬¼ëŸ‰ì„ ëª¨ìœ¼ëŠ” ì¤‘ìœ¼ë¡œ, 1-2ì£¼ í›„ ê¸‰ë“± ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤ (ì„ í–‰ ì§€í‘œ).'
        },
        both: {
          icon: 'ğŸ”¥',
          label: 'ê³ ë˜ + ë§¤ì§‘',
          description: 'ê³ ë˜ ê°ì§€ì™€ ì¡°ìš©í•œ ë§¤ì§‘ì´ ë™ì‹œì— ë°œìƒí•œ ì¢…ëª©. ì„¸ë ¥ì˜ ê°•í•œ ë§¤ìˆ˜ ì˜ì§€ê°€ í™•ì¸ë˜ì–´ ê°€ì¥ ë†’ì€ ê¸‰ë“± ê°€ëŠ¥ì„±ì„ ë³´ì…ë‹ˆë‹¤.'
        },
        normal: {
          icon: 'ğŸ“Š',
          label: 'ê±°ë˜ëŸ‰-ê°€ê²© ë‹¤ì´ë²„ì „ìŠ¤',
          description: 'ê±°ë˜ëŸ‰ì€ ì¦ê°€í•˜ì§€ë§Œ ê°€ê²©ì€ í¬ê²Œ ì˜¤ë¥´ì§€ ì•Šì€ ì¢…ëª©. ê±°ë˜ëŸ‰ì´ ê°€ê²©ë³´ë‹¤ ì„ í–‰í•˜ëŠ” ê²½í–¥ì„ í™œìš©í•œ ì „ëµìœ¼ë¡œ, í–¥í›„ ê°€ê²© ìƒìŠ¹ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤. ê³ ë˜ë‚˜ ë§¤ì§‘ë§Œí¼ ê°•í•œ ì‹ í˜¸ëŠ” ì•„ë‹ˆì§€ë§Œ, Volume-Price Divergence ê¸°ì¤€ìœ¼ë¡œ ì„ ì •ë˜ì—ˆìŠµë‹ˆë‹¤.'
        }
      };

      const fetchPerformanceData = async () => {
        setLoading(true);
        setError(null);

        try {
          // Supabase ê¸°ë°˜ ì‹¤ì „ ì¶”ì²œ ì¢…ëª© ì„±ê³¼ ì¡°íšŒ
          const perfRes = await fetch(`${apiBaseUrl}/recommendations/performance?days=7`);

          if (!perfRes.ok) {
            throw new Error(`API ì˜¤ë¥˜: ${perfRes.status}`);
          }

          const perfData = await perfRes.json();

          if (!perfData.success) {
            throw new Error(perfData.message || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
          }

          // ë°ì´í„° ì—†ìœ¼ë©´ ì•ˆë‚´
          if (perfData.count === 0) {
            setTrackerData({
              statistics: {
                overall: {
                  totalSignals: 0,
                  winRate: 0,
                  avgReturn: 0,
                  totalCount: 0,
                  winCount: 0,
                  maxReturn: 0,
                  minReturn: 0
                }
              },
              stocks: [],
              isEmpty: true
            });
            setLoading(false);
            return;
          }

          // ë“±ê¸‰ë³„ í†µê³„ ê³„ì‚°
          const byGrade = {};
          perfData.stocks.forEach(stock => {
            const grade = stock.recommendation_grade;
            if (!byGrade[grade]) {
              byGrade[grade] = {
                count: 0,
                winCount: 0,
                returns: [],
                maxReturn: 0
              };
            }
            byGrade[grade].count++;
            if (stock.is_winning) byGrade[grade].winCount++;
            byGrade[grade].returns.push(stock.current_return);
            if (stock.current_return > byGrade[grade].maxReturn) {
              byGrade[grade].maxReturn = stock.current_return;
            }
          });

          // ë“±ê¸‰ë³„ í‰ê·  ê³„ì‚°
          const gradeStats = {};
          Object.entries(byGrade).forEach(([grade, data]) => {
            gradeStats[grade] = {
              count: data.count,
              winRate: ((data.winCount / data.count) * 100).toFixed(1),
              avgReturn: (data.returns.reduce((a, b) => a + b, 0) / data.count).toFixed(2),
              maxReturn: data.maxReturn.toFixed(2)
            };
          });

          // ì—°ì† ê¸‰ë“±ì£¼ í•„í„°ë§ (2ì¼ ì´ìƒ ì—°ì† ìƒìŠ¹)
          const risingStocks = perfData.stocks.filter(s => s.is_rising);

          setTrackerData({
            statistics: {
              overall: {
                totalSignals: perfData.count,
                totalCount: perfData.count,
                winRate: perfData.statistics.winRate,
                winCount: perfData.statistics.winningCount,
                avgReturn: perfData.statistics.avgReturn,
                maxReturn: perfData.statistics.maxReturn,
                minReturn: perfData.statistics.minReturn
              },
              byGrade: gradeStats,
              byCategory: perfData.statistics?.byCategory || {}
            },
            stocks: perfData.stocks,
            risingStocks: risingStocks,
            recommendationDates: perfData.recommendationDates || [],
            commonStocks: perfData.commonStocks || [],
            parameters: {
              holdingDays: 'N/A (ì‹¤ì‹œê°„)',
              lookbackDays: 7
            }
          });

        } catch (err) {
          console.error('ì„±ê³¼ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', err);
          setError('ì„±ê³¼ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ' + err.message);
        } finally {
          setLoading(false);
        }
      };

      if (loading) {
        return (
          <div className="text-center py-20">
            <div className="inline-block animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-indigo-600 mb-4"></div>
            <h3 className="text-2xl font-bold text-gray-800 mb-2">ì„±ê³¼ ë°ì´í„° ë¶„ì„ ì¤‘...</h3>
            <p className="text-gray-600">ê³¼ê±° ì¶”ì²œ ì¢…ëª©ì˜ ìˆ˜ìµë¥ ì„ ê³„ì‚°í•˜ê³  ìˆìŠµë‹ˆë‹¤</p>
          </div>
        );
      }

      if (error) {
        return (
          <div className="bg-red-100 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded">
            {error}
          </div>
        );
      }

      const stats = trackerData?.statistics?.overall;

      if (!stats || trackerData.isEmpty) {
        return (
          <div className="space-y-6">
            <div className="bg-gradient-to-r from-green-600 to-teal-600 rounded-xl shadow-lg p-6 text-white">
              <h2 className="text-3xl font-bold mb-2">ğŸ“ˆ ì„±ê³¼ ê²€ì¦</h2>
              <p className="text-green-100">
                ì‹¤ì „ ì¶”ì²œ ì¢…ëª©ì˜ ì‹¤ì œ ì„±ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤
              </p>
            </div>
            <div className="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 px-4 py-3 rounded">
              <p className="font-bold mb-2">ğŸ“Š ì¶”ì  ë°ì´í„° ì—†ìŒ</p>
              <p>ì•„ì§ ì¶”ì²œ ì¢…ëª©ì´ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
              <p className="mt-2 text-sm">ğŸ’¡ <strong>ì¢…í•©ì§‘ê³„</strong> íƒ­ì—ì„œ ì¢…ëª©ì„ ì¡°íšŒí•˜ë©´ ìë™ìœ¼ë¡œ ì €ì¥ë˜ì–´ ì„±ê³¼ë¥¼ ì¶”ì í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
          </div>
        );
      }

      return (
        <div className="space-y-6">
          {/* í—¤ë” */}
          <div className="bg-gradient-to-r from-green-600 to-teal-600 rounded-xl shadow-lg p-6 text-white">
            <h2 className="text-3xl font-bold mb-2">ğŸ“ˆ ì„±ê³¼ ê²€ì¦</h2>
            <p className="text-green-100">
              íŒ¨í„´ ê¸°ë°˜ ì¢…ëª© ì¶”ì²œì˜ ì‹¤ì œ ì„±ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤
            </p>
          </div>

          {/* ì „ì²´ ìš”ì•½ ì¹´ë“œ */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <SummaryCard
              title="ì „ì²´ ìŠ¹ë¥ "
              value={`${stats.winRate}%`}
              subtext={`${stats.winCount}/${stats.totalCount} ì¢…ëª© ìƒìŠ¹`}
              color="bg-gradient-to-br from-green-500 to-green-600"
              icon="âœ…"
            />
            <SummaryCard
              title="í‰ê·  ìˆ˜ìµë¥ "
              value={`${stats.avgReturn > 0 ? '+' : ''}${stats.avgReturn}%`}
              subtext={`${trackerData.parameters?.holdingDays || 7}ì¼ ë³´ìœ  ê¸°ì¤€`}
              color="bg-gradient-to-br from-blue-500 to-blue-600"
              icon="ğŸ“ˆ"
            />
            <SummaryCard
              title="ìµœê³  ìˆ˜ìµ"
              value={`+${stats.maxReturn}%`}
              subtext={`ì†ì‹¤ ${stats.minReturn}%`}
              color="bg-gradient-to-br from-purple-500 to-purple-600"
              icon="ğŸ”¥"
            />
            <SummaryCard
              title="ë¶„ì„ ìƒ˜í”Œ"
              value={`${stats.totalCount}ê°œ`}
              subtext={`ìµœê·¼ ${trackerData.parameters?.lookbackDays || 7}ì¼`}
              color="bg-gradient-to-br from-orange-500 to-orange-600"
              icon="ğŸ“Š"
            />
          </div>

          {/* Phase 3: ê³ ê¸‰ ì§€í‘œ */}
          {trackerData.statistics?.advanced && (
            <div className="bg-white rounded-xl shadow-lg p-6">
              <h3 className="text-2xl font-bold mb-6 flex items-center gap-2">
                ğŸ¯ ê³ ê¸‰ ì„±ê³¼ ì§€í‘œ (Phase 3)
              </h3>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <AdvancedMetricBox
                  label="ìƒ¤í”„ ë¹„ìœ¨"
                  value={trackerData.statistics.advanced.sharpeRatio}
                  desc="ìœ„í—˜ ëŒ€ë¹„ ìˆ˜ìµ (>1 ì–‘í˜¸)"
                  good={trackerData.statistics.advanced.sharpeRatio > 1}
                />
                <AdvancedMetricBox
                  label="MDD (ìµœëŒ€ ë‚™í­)"
                  value={`${trackerData.statistics.advanced.maxDrawdown}%`}
                  desc="ìµœëŒ€ ì†ì‹¤ í­ (<10% ì•ˆì •)"
                  good={trackerData.statistics.advanced.maxDrawdown < 10}
                />
                <AdvancedMetricBox
                  label="Profit Factor"
                  value={trackerData.statistics.advanced.profitFactor}
                  desc="ìˆ˜ìµ/ì†ì‹¤ ë¹„ìœ¨ (>1.5 ìš°ìˆ˜)"
                  good={trackerData.statistics.advanced.profitFactor > 1.5}
                />
                <AdvancedMetricBox
                  label="KOSPI ì´ˆê³¼ìˆ˜ìµ"
                  value={`${trackerData.statistics.advanced.excessReturn > 0 ? '+' : ''}${trackerData.statistics.advanced.excessReturn}%`}
                  desc="ì‹œì¥ ëŒ€ë¹„ ì´ˆê³¼ ì„±ê³¼"
                  good={trackerData.statistics.advanced.excessReturn > 0}
                />
              </div>
              <div className="mt-4 p-4 bg-blue-50 rounded-lg">
                <h4 className="font-bold text-blue-900 mb-2">ğŸ’¡ ì¢…í•© í•´ì„</h4>
                <div className="space-y-1">
                  {trackerData.statistics.advanced.interpretation.map((interp, i) => (
                    <div key={i} className="text-sm text-blue-800">{interp}</div>
                  ))}
                </div>
              </div>
            </div>
          )}

          {/* ë“±ê¸‰ë³„ ì„±ê³¼ */}
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h3 className="text-2xl font-bold mb-4">ğŸ“Š ë“±ê¸‰ë³„ ì„±ê³¼</h3>

            {/* ë“±ê¸‰ ê¸°ì¤€ ì„¤ëª… */}
            <div className="mb-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg">
              <h4 className="font-bold text-blue-900 mb-3">ğŸ¯ ë“±ê¸‰ ë¶€ì—¬ ê¸°ì¤€ (100ì  ë§Œì )</h4>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                <div className="bg-white p-3 rounded border-l-4 border-red-500">
                  <div className="font-bold text-red-700 mb-1">Së“±ê¸‰: 64ì  ì´ìƒ / 85ì  ë§Œì </div>
                  <div className="text-gray-700">ğŸ”¥ ìµœìš°ì„  ë§¤ìˆ˜ - ê¸‰ë“± ì˜ˆì • ì‹ í˜¸ ê°•í•¨</div>
                </div>
                <div className="bg-white p-3 rounded border-l-4 border-orange-500">
                  <div className="font-bold text-orange-700 mb-1">Aë“±ê¸‰: 49~63ì </div>
                  <div className="text-gray-700">ğŸŸ¢ ì ê·¹ ë§¤ìˆ˜ - ìƒìŠ¹ ê°€ëŠ¥ì„± ë†’ìŒ</div>
                </div>
                <div className="bg-white p-3 rounded border-l-4 border-yellow-500">
                  <div className="font-bold text-yellow-700 mb-1">Bë“±ê¸‰: 36~48ì </div>
                  <div className="text-gray-700">ğŸŸ¡ ë§¤ìˆ˜ ê³ ë ¤ - ì ì • ìƒìŠ¹ ê°€ëŠ¥ì„±</div>
                </div>
                <div className="bg-white p-3 rounded border-l-4 border-gray-400">
                  <div className="font-bold text-gray-700 mb-1">Cë“±ê¸‰: 21~35ì </div>
                  <div className="text-gray-700">âšª ì£¼ëª© - ê´€ë§ í•„ìš”</div>
                </div>
              </div>
              <div className="mt-3 p-3 bg-blue-100 rounded text-xs text-blue-900">
                <strong>ğŸ’¡ ì ìˆ˜ êµ¬ì„±:</strong> ê¸°ë³¸ ì ìˆ˜ (0-20ì ) + ì„ í–‰ ì§€í‘œ (0-80ì ) = ì´ 100ì <br/>
                â€¢ ê¸°ë³¸: ê±°ë˜ëŸ‰ ë¹„ìœ¨, OBV ì¶”ì„¸, VWAP ëª¨ë©˜í…€, ë¹„ëŒ€ì¹­ ë¹„ìœ¨<br/>
                â€¢ ì„ í–‰: VPM, ê¸°ê´€/ì™¸êµ­ì¸ ìˆ˜ê¸‰, í•©ë¥˜ì , íŒ¨í„´+DNA, ì‹ í˜¸ ì‹ ì„ ë„, Cup&Handle, ëŒíŒŒ í™•ì¸
              </div>
            </div>

            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-gray-100">
                  <tr>
                    <th className="px-4 py-3 text-left">ë“±ê¸‰</th>
                    <th className="px-4 py-3 text-left">ìƒ˜í”Œ ìˆ˜</th>
                    <th className="px-4 py-3 text-left">ìŠ¹ë¥ </th>
                    <th className="px-4 py-3 text-left">í‰ê·  ìˆ˜ìµë¥ </th>
                    <th className="px-4 py-3 text-left">ìµœê³  ìˆ˜ìµ</th>
                  </tr>
                </thead>
                <tbody>
                  {Object.entries(trackerData.statistics?.byGrade || {}).map(([grade, gstats]) => {
                    const gradeStocks = trackerData.stocks.filter(s => s.recommendation_grade === grade);
                    const isExpanded = expandedGrades[grade] || false;

                    return (
                      <React.Fragment key={grade}>
                        <tr
                          className="border-b hover:bg-gray-50 cursor-pointer transition"
                          onClick={() => toggleGradeExpand(grade)}
                        >
                          <td className="px-4 py-3">
                            <div className="flex items-center gap-2">
                              <span className="text-gray-500">{isExpanded ? 'â–¼' : 'â–¶'}</span>
                              <span className={`inline-block px-3 py-1 rounded-full text-white font-bold grade-${grade}`}>
                                {grade}
                              </span>
                            </div>
                          </td>
                          <td className="px-4 py-3">{gstats.count}ê°œ</td>
                          <td className="px-4 py-3">
                            <span className={gstats.winRate >= 70 ? 'text-green-600 font-bold' : gstats.winRate >= 50 ? 'text-blue-600' : 'text-gray-600'}>
                              {gstats.winRate}%
                            </span>
                          </td>
                          <td className="px-4 py-3">
                            <span className={gstats.avgReturn > 0 ? 'text-red-600 font-bold' : 'text-blue-600'}>
                              {gstats.avgReturn > 0 ? '+' : ''}{gstats.avgReturn}%
                            </span>
                          </td>
                          <td className="px-4 py-3 text-green-600 font-semibold">+{gstats.maxReturn}%</td>
                        </tr>

                        {/* í™•ì¥ëœ ì¢…ëª© ëª©ë¡ */}
                        {isExpanded && gradeStocks.length > 0 && (
                          <tr>
                            <td colSpan="5" className="px-4 py-4 bg-gray-50">
                              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                {gradeStocks.map(stock => (
                                  <div key={stock.stock_code} className="bg-white rounded-lg p-3 border shadow-sm hover:shadow-md transition">
                                    <div className="flex justify-between items-start mb-2">
                                      <div>
                                        <div className="font-bold text-sm">{stock.stock_name}</div>
                                        <div className="text-xs text-gray-500">{stock.stock_code}</div>
                                      </div>
                                      <div className={`text-lg font-bold ${stock.current_return >= 0 ? 'text-red-600' : 'text-blue-600'}`}>
                                        {stock.current_return >= 0 ? '+' : ''}{stock.current_return}%
                                      </div>
                                    </div>
                                    <div className="text-xs space-y-1">
                                      <div className="flex justify-between">
                                        <span className="text-gray-600">ì¶”ì²œê°€:</span>
                                        <span>{stock.recommended_price.toLocaleString()}ì›</span>
                                      </div>
                                      <div className="flex justify-between">
                                        <span className="text-gray-600">í˜„ì¬ê°€:</span>
                                        <span className="font-semibold">{stock.current_price.toLocaleString()}ì›</span>
                                      </div>
                                      <div className="flex justify-between text-gray-500 pt-1 border-t">
                                        <span>ì¶”ì²œì¼:</span>
                                        <span>{stock.recommendation_date}</span>
                                      </div>
                                    </div>
                                  </div>
                                ))}
                              </div>
                            </td>
                          </tr>
                        )}
                      </React.Fragment>
                    );
                  })}
                </tbody>
              </table>
            </div>
          </div>

          {/* ğŸ”¥ ì—°ì† ê¸‰ë“±ì£¼ (2ì¼ ì´ìƒ ì—°ì† ìƒìŠ¹) */}
          {trackerData.risingStocks && trackerData.risingStocks.length > 0 && (
            <div className="bg-gradient-to-br from-red-50 to-orange-50 border-2 border-red-300 rounded-xl shadow-lg p-6">
              <h3 className="text-2xl font-bold mb-4 text-red-900 flex items-center gap-2">
                ğŸ”¥ ì—°ì† ê¸‰ë“±ì£¼
                <span className="text-sm font-normal text-red-700">
                  (2ì¼ ì´ìƒ ì—°ì† ìƒìŠ¹ ì¤‘)
                </span>
              </h3>

              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {trackerData.risingStocks.map((stock) => (
                  <div key={stock.stock_code} className="bg-white rounded-lg p-4 border-2 border-red-400 shadow-md hover:shadow-lg transition">
                    <div className="flex justify-between items-start mb-2">
                      <div>
                        <h4 className="font-bold text-lg">{stock.stock_name}</h4>
                        <div className="text-xs text-gray-500">{stock.stock_code}</div>
                      </div>
                      <div className={`px-3 py-1 rounded-full text-white text-xs font-bold grade-${stock.recommendation_grade}`}>
                        {stock.recommendation_grade}
                      </div>
                    </div>

                    <div className="space-y-2 text-sm">
                      {/* ì¶”ì²œê°€ vs í˜„ì¬ê°€ */}
                      <div className="flex justify-between">
                        <span className="text-gray-600">ì¶”ì²œê°€:</span>
                        <span className="font-semibold">{stock.recommended_price.toLocaleString()}ì›</span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-600">í˜„ì¬ê°€:</span>
                        <span className="font-semibold text-red-600">{stock.current_price.toLocaleString()}ì›</span>
                      </div>

                      {/* ìˆ˜ìµë¥  */}
                      <div className="flex justify-between items-center pt-2 border-t">
                        <span className="text-gray-700 font-semibold">ìˆ˜ìµë¥ :</span>
                        <span className={`text-xl font-bold ${stock.current_return >= 0 ? 'text-red-600' : 'text-blue-600'}`}>
                          {stock.current_return >= 0 ? '+' : ''}{stock.current_return}%
                        </span>
                      </div>

                      {/* ì—°ì† ìƒìŠ¹ì¼ */}
                      <div className="bg-red-100 rounded px-3 py-2 mt-2">
                        <div className="flex items-center justify-between">
                          <span className="text-red-800 font-semibold text-xs">ğŸ”¥ ì—°ì† ìƒìŠ¹:</span>
                          <span className="text-red-900 font-bold">{stock.consecutive_rise_days}ì¼ì§¸</span>
                        </div>
                      </div>

                      {/* ì¶”ì²œ ê²½ê³¼ì¼ */}
                      <div className="text-xs text-gray-500 text-center pt-2">
                        ì¶”ì²œ í›„ {stock.days_since_recommendation}ì¼ ê²½ê³¼
                      </div>
                    </div>
                  </div>
                ))}
              </div>

              <div className="mt-4 p-4 bg-red-100 rounded-lg">
                <p className="text-sm text-red-900">
                  ğŸ’¡ <strong>{trackerData.risingStocks.length}ê°œ ì¢…ëª©</strong>ì´ 2ì¼ ì´ìƒ ì—°ì† ìƒìŠ¹ ì¤‘ì…ë‹ˆë‹¤.
                  ê°•í•œ ìƒìŠ¹ ì¶”ì„¸ê°€ ì§€ì†ë˜ê³  ìˆìœ¼ë‹ˆ ì£¼ëª©í•´ì£¼ì„¸ìš”!
                </p>
              </div>
            </div>
          )}

          {/* ì¹´í…Œê³ ë¦¬ë³„ ì„±ê³¼ */}
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h3 className="text-2xl font-bold mb-4">ğŸ¯ ì¹´í…Œê³ ë¦¬ë³„ ì„±ê³¼</h3>

            {/* ì¹´í…Œê³ ë¦¬ ìƒì„¸ ì„¤ëª… */}
            <div className="mb-6 grid grid-cols-1 md:grid-cols-2 gap-4">
              {Object.entries(categoryDescriptions).map(([key, desc]) => (
                <div key={key} className="p-4 bg-gradient-to-br from-gray-50 to-white border-2 border-gray-200 rounded-lg hover:shadow-md transition">
                  <div className="flex items-center gap-2 mb-2">
                    <span className="text-2xl">{desc.icon}</span>
                    <h4 className="font-bold text-lg text-gray-800">{desc.label}</h4>
                  </div>
                  <p className="text-sm text-gray-700 leading-relaxed">{desc.description}</p>
                  <div className="mt-3 pt-3 border-t border-gray-200">
                    <div className="text-xs text-gray-600">
                      <strong>íŒë³„ ì¡°ê±´:</strong>
                      {key === 'whale' && ' whale_detected = true (ê±°ë˜ëŸ‰ 2.5ë°°+ && ê°€ê²© 3%+)'}
                      {key === 'accumulation' && ' accumulation_detected = true (ê°€ê²© ë³€ë™ 10% ì´ë‚´ && ê±°ë˜ëŸ‰ ì¦ê°€)'}
                      {key === 'both' && ' whale_detected && accumulation_detected ëª¨ë‘ true'}
                      {key === 'normal' && ' whale_detected = false && accumulation_detected = false. ê±°ë˜ëŸ‰ ì¦ê°€ìœ¨ì´ ë†’ì§€ë§Œ ì•„ì§ í° ê°€ê²© ìƒìŠ¹ì´ ì—†ëŠ” ì¢…ëª©ìœ¼ë¡œ, ê±°ë˜ëŸ‰ì´ ê°€ê²©ì„ ì„ í–‰í•œë‹¤ëŠ” ì „ì œ í•˜ì— í–¥í›„ ìƒìŠ¹ ê°€ëŠ¥ì„± ì¡´ì¬.'}
                    </div>
                  </div>
                </div>
              ))}
            </div>

            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-gray-100">
                  <tr>
                    <th className="px-4 py-3 text-left">ì¹´í…Œê³ ë¦¬</th>
                    <th className="px-4 py-3 text-left">ìƒ˜í”Œ ìˆ˜</th>
                    <th className="px-4 py-3 text-left">ìŠ¹ë¥ </th>
                    <th className="px-4 py-3 text-left">í‰ê·  ìˆ˜ìµë¥ </th>
                    <th className="px-4 py-3 text-left">ìµœê³  ìˆ˜ìµ</th>
                  </tr>
                </thead>
                <tbody>
                  {Object.entries(trackerData.statistics?.byCategory || {}).map(([key, cstats]) => {
                    // ì¹´í…Œê³ ë¦¬ë³„ ì¢…ëª© í•„í„°ë§
                    const categoryStocks = trackerData.stocks.filter(stock => {
                      if (key === 'whale') return stock.whale_detected && !stock.accumulation_detected;
                      if (key === 'accumulation') return stock.accumulation_detected && !stock.whale_detected;
                      if (key === 'both') return stock.whale_detected && stock.accumulation_detected;
                      if (key === 'normal') return !stock.whale_detected && !stock.accumulation_detected;
                      return false;
                    }).sort((a, b) => {
                      // ë“±ê¸‰ ìˆœì„œ: S > A > B > C
                      const gradeOrder = { 'S': 0, 'A': 1, 'B': 2, 'C': 3, 'D': 4 };
                      return (gradeOrder[a.recommendation_grade] || 99) - (gradeOrder[b.recommendation_grade] || 99);
                    });
                    const isExpanded = expandedCategories[key] || false;

                    return (
                      <React.Fragment key={key}>
                        <tr
                          className="border-b hover:bg-gray-50 cursor-pointer transition"
                          onClick={() => toggleCategoryExpand(key)}
                        >
                          <td className="px-4 py-3">
                            <div className="flex items-center gap-2">
                              <span className="text-gray-500">{isExpanded ? 'â–¼' : 'â–¶'}</span>
                              <span className="font-semibold">{cstats.label}</span>
                            </div>
                          </td>
                          <td className="px-4 py-3">{cstats.count}ê°œ</td>
                          <td className="px-4 py-3">
                            <span className={cstats.winRate >= 70 ? 'text-green-600 font-bold' : cstats.winRate >= 50 ? 'text-blue-600' : 'text-gray-600'}>
                              {cstats.winRate}%
                            </span>
                          </td>
                          <td className="px-4 py-3">
                            <span className={cstats.avgReturn > 0 ? 'text-red-600 font-bold' : 'text-blue-600'}>
                              {cstats.avgReturn > 0 ? '+' : ''}{cstats.avgReturn}%
                            </span>
                          </td>
                          <td className="px-4 py-3 text-green-600 font-semibold">+{cstats.maxReturn}%</td>
                        </tr>

                        {/* í™•ì¥ëœ ì¢…ëª© ëª©ë¡ */}
                        {isExpanded && categoryStocks.length > 0 && (
                          <tr>
                            <td colSpan="5" className="px-4 py-4 bg-gray-50">
                              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                {categoryStocks.map(stock => (
                                  <div key={stock.stock_code} className="bg-white rounded-lg p-3 border shadow-sm hover:shadow-md transition">
                                    <div className="flex justify-between items-start mb-2">
                                      <div>
                                        <div className="font-bold text-sm">{stock.stock_name}</div>
                                        <div className="text-xs text-gray-500">{stock.stock_code}</div>
                                      </div>
                                      <div className="flex flex-col items-end gap-1">
                                        <div className={`px-2 py-0.5 rounded text-white text-xs font-bold grade-${stock.recommendation_grade}`}>
                                          {stock.recommendation_grade}
                                        </div>
                                        <div className={`text-lg font-bold ${stock.current_return >= 0 ? 'text-red-600' : 'text-blue-600'}`}>
                                          {stock.current_return >= 0 ? '+' : ''}{stock.current_return}%
                                        </div>
                                      </div>
                                    </div>
                                    <div className="text-xs space-y-1">
                                      <div className="flex justify-between">
                                        <span className="text-gray-600">ì¶”ì²œê°€:</span>
                                        <span>{stock.recommended_price.toLocaleString()}ì›</span>
                                      </div>
                                      <div className="flex justify-between">
                                        <span className="text-gray-600">í˜„ì¬ê°€:</span>
                                        <span className="font-semibold">{stock.current_price.toLocaleString()}ì›</span>
                                      </div>
                                      <div className="flex justify-between text-gray-500 pt-1 border-t">
                                        <span>ì¶”ì²œì¼:</span>
                                        <span>{stock.recommendation_date}</span>
                                      </div>
                                    </div>
                                  </div>
                                ))}
                              </div>
                            </td>
                          </tr>
                        )}
                      </React.Fragment>
                    );
                  })}
                </tbody>
              </table>
            </div>
          </div>

          {/* ì¶”ì²œì¼ìë³„ ì„±ê³¼ */}
          {trackerData.recommendationDates && trackerData.recommendationDates.length > 0 && (
            <div className="bg-white rounded-xl shadow-lg p-6">
              <h3 className="text-2xl font-bold mb-6">ğŸ“… ì¶”ì²œì¼ìë³„ ì„±ê³¼</h3>
              <div className="space-y-4">
                {trackerData.recommendationDates.map((dateGroup, idx) => {
                  // ë‚ ì§œë³„ë¡œ ë‹¤ë¥¸ ê·¸ë¼ë°ì´ì…˜ ìƒ‰ìƒ ì ìš©
                  const gradientColors = [
                    'from-blue-50 to-cyan-50 border-blue-300',
                    'from-green-50 to-emerald-50 border-green-300',
                    'from-purple-50 to-pink-50 border-purple-300',
                    'from-yellow-50 to-orange-50 border-yellow-300',
                    'from-red-50 to-rose-50 border-red-300',
                    'from-indigo-50 to-violet-50 border-indigo-300',
                    'from-teal-50 to-cyan-50 border-teal-300'
                  ];
                  const colorClass = gradientColors[idx % gradientColors.length];

                  return (
                  <div key={idx} className={`bg-gradient-to-br ${colorClass} border-2 rounded-xl shadow-lg p-6 hover:shadow-xl transition`}>
                    {/* ë‚ ì§œ í—¤ë” - ì„œë¹„ìŠ¤ì¹´ë“œ ìŠ¤íƒ€ì¼ */}
                    <div className="flex flex-col md:flex-row md:justify-between md:items-center mb-4 pb-4 border-b-2 border-gray-300">
                      <div className="mb-3 md:mb-0">
                        <div className="text-2xl font-bold text-gray-900 mb-1">ğŸ“… {dateGroup.date}</div>
                        <div className="text-sm text-gray-700 font-semibold">{dateGroup.stocks.length}ê°œ ì¢…ëª© ì¶”ì²œ</div>
                      </div>
                      <div className="flex gap-4">
                        <div className="bg-white rounded-lg px-4 py-3 shadow-md border-2 border-gray-200">
                          <div className="text-xs text-gray-600 font-semibold mb-1">í‰ê·  ìˆ˜ìµë¥ </div>
                          <div className={`text-2xl font-bold ${dateGroup.avgReturn >= 0 ? 'text-red-600' : 'text-blue-600'}`}>
                            {dateGroup.avgReturn >= 0 ? '+' : ''}{dateGroup.avgReturn}%
                          </div>
                        </div>
                        <div className="bg-white rounded-lg px-4 py-3 shadow-md border-2 border-gray-200">
                          <div className="text-xs text-gray-600 font-semibold mb-1">ìŠ¹ë¥ </div>
                          <div className={`text-2xl font-bold ${dateGroup.winRate >= 70 ? 'text-green-600' : dateGroup.winRate >= 50 ? 'text-blue-600' : 'text-gray-600'}`}>
                            {dateGroup.winRate}%
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* ì¢…ëª© ëª©ë¡ - ì¹´ë“œ ê·¸ë¦¬ë“œ */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                      {dateGroup.stocks.sort((a, b) => {
                        // ë“±ê¸‰ ìˆœì„œ: S > A > B > C
                        const gradeOrder = { 'S': 0, 'A': 1, 'B': 2, 'C': 3, 'D': 4 };
                        return (gradeOrder[a.recommendation_grade] || 99) - (gradeOrder[b.recommendation_grade] || 99);
                      }).map((stock, sIdx) => {
                        const stockKey = `${dateGroup.date}_${stock.stock_code}`;
                        const expanded = expandedStocks[stockKey] || false;

                        return (
                          <div key={sIdx} className="bg-white rounded-lg border-2 border-gray-200 shadow-md hover:shadow-lg overflow-hidden transition">
                            {/* ì¢…ëª© í—¤ë” (í´ë¦­ ê°€ëŠ¥) */}
                            <button
                              onClick={() => toggleExpand(stockKey)}
                              className="w-full px-4 py-3 hover:bg-gray-50 transition flex flex-col gap-2"
                            >
                              <div className="flex justify-between items-start w-full">
                                <div className="flex items-center gap-2">
                                  <div className={`px-3 py-1 rounded-full text-white text-xs font-bold grade-${stock.recommendation_grade}`}>
                                    {stock.recommendation_grade}
                                  </div>
                                  <div className="text-left">
                                    <div className="font-bold text-base">{stock.stock_name}</div>
                                    <div className="text-xs text-gray-500">{stock.stock_code}</div>
                                  </div>
                                </div>
                                <div className="text-gray-400 text-sm">
                                  {expanded ? 'â–¼' : 'â–¶'}
                                </div>
                              </div>
                              <div className="flex justify-between items-center w-full">
                                <div className="text-left text-xs">
                                  <div className="text-gray-600">ì¶”ì²œê°€</div>
                                  <div className="font-semibold">{stock.recommended_price.toLocaleString()}ì›</div>
                                </div>
                                <div className="text-center text-xs">
                                  <div className="text-gray-600">í˜„ì¬ê°€</div>
                                  <div className="font-semibold">{stock.current_price.toLocaleString()}ì›</div>
                                </div>
                                <div className="text-right">
                                  <div className="text-xs text-gray-600">ìˆ˜ìµë¥ </div>
                                  <div className={`text-xl font-bold ${stock.current_return >= 0 ? 'text-red-600' : 'text-blue-600'}`}>
                                    {stock.current_return >= 0 ? '+' : ''}{stock.current_return}%
                                  </div>
                                </div>
                              </div>
                              {stock.is_rising && (
                                <div className="w-full bg-red-100 rounded-full px-3 py-1 text-center">
                                  <span className="text-xs text-red-700 font-bold">
                                    ğŸ”¥ {stock.consecutive_rise_days}ì¼ ì—°ì† ìƒìŠ¹
                                  </span>
                                </div>
                              )}
                            </button>

                            {/* ì¼ë³„ ê°€ê²© ì¶”ì´ (í¼ì³¤ì„ ë•Œë§Œ ë³´ì„) */}
                            {expanded && stock.daily_prices && stock.daily_prices.length > 0 && (
                              <div className="p-3 bg-white border-t">
                                <div className="text-xs text-gray-600 mb-2">
                                  ğŸ“Š ì¶”ì²œ ì´í›„ {stock.daily_prices.length}ì¼ê°„ì˜ ê°€ê²© ì¶”ì´
                                  {(() => {
                                    // ê±°ë˜ëŸ‰ ë³€ë™ìœ¨ ê¸°í•˜í‰ê·  ê³„ì‚°
                                    if (stock.daily_prices.length >= 2) {
                                      const volumeChanges = [];
                                      for (let i = 1; i < stock.daily_prices.length; i++) {
                                        const prev = stock.daily_prices[i-1].volume;
                                        const curr = stock.daily_prices[i].volume;
                                        if (prev && curr && prev > 0) {
                                          const change = ((curr - prev) / prev) * 100;
                                          volumeChanges.push(1 + (change / 100));
                                        }
                                      }
                                      if (volumeChanges.length > 0) {
                                        const product = volumeChanges.reduce((acc, val) => acc * val, 1);
                                        const geometricMean = Math.pow(product, 1 / volumeChanges.length);
                                        const avgChange = (geometricMean - 1) * 100;
                                        return (
                                          <span className="ml-2 font-semibold">
                                            (ê±°ë˜ëŸ‰ ë³€ë™ìœ¨ í‰ê· : {avgChange >= 0 ? '+' : ''}{avgChange.toFixed(1)}%)
                                          </span>
                                        );
                                      }
                                    }
                                    return null;
                                  })()}
                                </div>
                                <div className="overflow-x-auto">
                                  <table className="w-full text-xs">
                                    <thead className="bg-gray-100">
                                      <tr>
                                        <th className="px-2 py-1 text-left">ë‚ ì§œ</th>
                                        <th className="px-2 py-1 text-center">D+</th>
                                        <th className="px-2 py-1 text-right">ì¢…ê°€</th>
                                        <th className="px-2 py-1 text-right">ìˆ˜ìµë¥ </th>
                                        <th className="px-2 py-1 text-right">ê±°ë˜ëŸ‰ ë³€ë™ìœ¨</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      {stock.daily_prices.map((dailyData, dIdx) => {
                                        // ì „ì¼ ëŒ€ë¹„ ê±°ë˜ëŸ‰ ë³€ë™ìœ¨ ê³„ì‚°
                                        let volumeChangeRate = null;
                                        if (dIdx > 0 && dailyData.volume && stock.daily_prices[dIdx-1].volume) {
                                          const prevVolume = stock.daily_prices[dIdx-1].volume;
                                          if (prevVolume > 0) {
                                            volumeChangeRate = ((dailyData.volume - prevVolume) / prevVolume) * 100;
                                          }
                                        }

                                        return (
                                        <tr key={dIdx} className="border-b hover:bg-gray-50">
                                          <td className="px-2 py-1">{dailyData.date}</td>
                                          <td className="px-2 py-1 text-center text-gray-500">{dailyData.daysSince}</td>
                                          <td className="px-2 py-1 text-right font-semibold">{dailyData.price.toLocaleString()}ì›</td>
                                          <td className={`px-2 py-1 text-right font-bold ${dailyData.return >= 0 ? 'text-red-600' : 'text-blue-600'}`}>
                                            {dailyData.return >= 0 ? '+' : ''}{dailyData.return}%
                                          </td>
                                          <td className={`px-2 py-1 text-right ${volumeChangeRate !== null ? (volumeChangeRate >= 0 ? 'text-red-600' : 'text-blue-600') : 'text-gray-400'}`}>
                                            {volumeChangeRate !== null ?
                                              `${volumeChangeRate >= 0 ? '+' : ''}${volumeChangeRate.toFixed(1)}%` :
                                              '-'
                                            }
                                          </td>
                                        </tr>
                                        );
                                      })}
                                    </tbody>
                                  </table>
                                </div>
                              </div>
                            )}

                            {/* ë°ì´í„° ì—†ì„ ë•Œ */}
                            {expanded && (!stock.daily_prices || stock.daily_prices.length === 0) && (
                              <div className="p-3 bg-yellow-50 text-center text-gray-600 border-t text-xs">
                                ğŸ“Š ì•„ì§ ì¼ë³„ ê°€ê²© ë°ì´í„°ê°€ ìˆ˜ì§‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
                                <br />
                                <span className="text-xs">ë§¤ì¼ 16ì‹œ ìë™ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.</span>
                              </div>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>
                  );
                })}
              </div>
            </div>
          )}

          {/* ê³µí†µ ì¶”ì²œ ì¢…ëª© (2íšŒ ì´ìƒ ì¶”ì²œ) */}
          {trackerData.commonStocks && trackerData.commonStocks.length > 0 && (
            <div className="bg-gradient-to-br from-purple-50 to-pink-50 border-2 border-purple-300 rounded-xl shadow-lg p-6">
              <h3 className="text-2xl font-bold mb-4 text-purple-900 flex items-center gap-2">
                ğŸ”„ ê³µí†µ ì¶”ì²œ ì¢…ëª©
                <span className="text-sm font-normal text-purple-700">
                  (2íšŒ ì´ìƒ ì¶”ì²œëœ ì¢…ëª©)
                </span>
              </h3>

              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {trackerData.commonStocks.map((stock, idx) => (
                  <div key={idx} className="bg-white rounded-lg p-4 border-2 border-purple-400 shadow-md hover:shadow-lg transition">
                    <div className="flex justify-between items-start mb-3">
                      <div>
                        <h4 className="font-bold text-lg">{stock.stock_name}</h4>
                        <div className="text-xs text-gray-500">{stock.stock_code}</div>
                      </div>
                      <div className="bg-purple-600 text-white px-3 py-1 rounded-full text-xs font-bold">
                        {stock.recommendation_count}íšŒ ì¶”ì²œ
                      </div>
                    </div>

                    <div className="space-y-2 text-sm">
                      <div className="flex justify-between items-center">
                        <span className="text-gray-600">í‰ê·  ìˆ˜ìµë¥ :</span>
                        <span className={`text-lg font-bold ${stock.avg_return >= 0 ? 'text-red-600' : 'text-blue-600'}`}>
                          {stock.avg_return >= 0 ? '+' : ''}{stock.avg_return}%
                        </span>
                      </div>

                      <div className="pt-2 border-t">
                        <div className="text-xs text-gray-600 mb-1">ì¶”ì²œ ë‚ ì§œ:</div>
                        <div className="flex flex-wrap gap-1">
                          {stock.recommendation_dates.map((date, dIdx) => (
                            <span key={dIdx} className="bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs">
                              {date}
                            </span>
                          ))}
                        </div>
                      </div>

                      <div className="pt-2 border-t">
                        <div className="text-xs text-gray-600 mb-1">ê° ì¶”ì²œë³„ ìˆ˜ìµë¥ :</div>
                        <div className="flex flex-wrap gap-1">
                          {stock.returns.map((ret, rIdx) => (
                            <span key={rIdx} className={`px-2 py-1 rounded text-xs font-semibold ${ret >= 0 ? 'bg-red-100 text-red-700' : 'bg-blue-100 text-blue-700'}`}>
                              {ret >= 0 ? '+' : ''}{ret}%
                            </span>
                          ))}
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
              </div>

              <div className="mt-4 p-4 bg-purple-100 rounded-lg">
                <p className="text-sm text-purple-900">
                  ğŸ’¡ <strong>{trackerData.commonStocks.length}ê°œ ì¢…ëª©</strong>ì´ ì—¬ëŸ¬ ë²ˆ ì¶”ì²œë˜ì—ˆìŠµë‹ˆë‹¤.
                  ì‹œìŠ¤í…œì´ ì¼ê´€ì„± ìˆê²Œ ì„ ì •í•˜ëŠ” ì¢…ëª©ë“¤ë¡œ, íŠ¹íˆ ì£¼ëª©í•  ë§Œí•©ë‹ˆë‹¤!
                </p>
              </div>
            </div>
          )}

          {/* Phase 3: í¬íŠ¸í´ë¦¬ì˜¤ ì‹œë®¬ë ˆì´ì…˜ */}
          {trackerData.portfolio && (
            <div className="bg-white rounded-xl shadow-lg p-6">
              <h3 className="text-2xl font-bold mb-6 flex items-center gap-2">
                ğŸ’¼ í¬íŠ¸í´ë¦¬ì˜¤ ì‹œë®¬ë ˆì´ì…˜ (5ì¢…ëª© ê· ë“± ë¶„ì‚°)
              </h3>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div className="bg-green-50 p-4 rounded-lg">
                  <p className="text-sm text-gray-600">í¬íŠ¸í´ë¦¬ì˜¤ í‰ê·  ìˆ˜ìµë¥ </p>
                  <p className="text-2xl font-bold text-green-700">
                    {trackerData.portfolio.summary.avgReturn > 0 ? '+' : ''}{trackerData.portfolio.summary.avgReturn}%
                  </p>
                </div>
                <div className="bg-blue-50 p-4 rounded-lg">
                  <p className="text-sm text-gray-600">ì´ ëˆ„ì  ìˆ˜ìµ</p>
                  <p className="text-2xl font-bold text-blue-700">
                    {trackerData.portfolio.summary.totalProfit.toLocaleString()}ì›
                  </p>
                </div>
                <div className="bg-purple-50 p-4 rounded-lg">
                  <p className="text-sm text-gray-600">í¬íŠ¸í´ë¦¬ì˜¤ ìˆ˜</p>
                  <p className="text-2xl font-bold text-purple-700">
                    {trackerData.portfolio.summary.portfolioCount}ê°œ
                  </p>
                </div>
              </div>

              {/* ìµœê³ /ìµœì € í¬íŠ¸í´ë¦¬ì˜¤ */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="bg-green-50 border-2 border-green-300 rounded-lg p-4">
                  <h4 className="font-bold text-green-900 mb-2">ğŸ† ìµœê³  ì„±ê³¼ í¬íŠ¸í´ë¦¬ì˜¤</h4>
                  <p className="text-sm text-gray-600 mb-2">ë‚ ì§œ: {trackerData.portfolio.summary.bestPortfolio?.date}</p>
                  <p className="text-2xl font-bold text-green-700 mb-2">
                    +{trackerData.portfolio.summary.bestPortfolio?.portfolioReturn}%
                  </p>
                  <div className="text-xs text-gray-700">
                    {trackerData.portfolio.summary.bestPortfolio?.stocks.map((s, i) => (
                      <div key={i}>{s.name} ({s.return > 0 ? '+' : ''}{s.return}%)</div>
                    ))}
                  </div>
                </div>

                <div className="bg-red-50 border-2 border-red-300 rounded-lg p-4">
                  <h4 className="font-bold text-red-900 mb-2">âš ï¸ ìµœì € ì„±ê³¼ í¬íŠ¸í´ë¦¬ì˜¤</h4>
                  <p className="text-sm text-gray-600 mb-2">ë‚ ì§œ: {trackerData.portfolio.summary.worstPortfolio?.date}</p>
                  <p className="text-2xl font-bold text-red-700 mb-2">
                    {trackerData.portfolio.summary.worstPortfolio?.portfolioReturn}%
                  </p>
                  <div className="text-xs text-gray-700">
                    {trackerData.portfolio.summary.worstPortfolio?.stocks.map((s, i) => (
                      <div key={i}>{s.name} ({s.return > 0 ? '+' : ''}{s.return}%)</div>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Phase 3: ì‹œì¥ ìƒí™©ë³„ ë¶„ì„ */}
          {trackerData.byMarket && (
            <div className="bg-white rounded-xl shadow-lg p-6">
              <h3 className="text-2xl font-bold mb-6">ğŸ“Š ì‹œì¥ ìƒí™©ë³„ ì„±ê³¼</h3>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                {Object.entries(trackerData.byMarket).map(([key, mstats]) => (
                  <div key={key} className="bg-gray-50 border-2 border-gray-200 rounded-lg p-4">
                    <h4 className="font-bold text-gray-900 mb-2">{mstats.label}</h4>
                    <div className="space-y-1 text-sm">
                      <div>ìƒ˜í”Œ: {mstats.count}ê°œ</div>
                      <div className={mstats.winRate >= 60 ? 'text-green-600 font-bold' : 'text-gray-700'}>
                        ìŠ¹ë¥ : {mstats.winRate}%
                      </div>
                      <div className={mstats.avgReturn > 0 ? 'text-red-600 font-bold' : 'text-blue-600'}>
                        í‰ê· : {mstats.avgReturn > 0 ? '+' : ''}{mstats.avgReturn}%
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* ë°ì´í„° ìƒì„± ì‹œê°„ */}
          <div className="text-center text-sm text-gray-500">
            ë°ì´í„° ì¡°íšŒ: {new Date().toLocaleString('ko-KR')}
          </div>
        </div>
      );
    }

    // ìš”ì•½ ì¹´ë“œ
    function SummaryCard({ title, value, subtext, color, icon }) {
      return (
        <div className={`${color} rounded-xl shadow-lg p-6 text-white`}>
          <div className="flex items-center justify-between mb-2">
            <h3 className="text-sm font-semibold opacity-90">{title}</h3>
            <span className="text-2xl">{icon}</span>
          </div>
          <p className="text-3xl font-bold mb-1">{value}</p>
          <p className="text-sm opacity-80">{subtext}</p>
        </div>
      );
    }

    // ê³ ê¸‰ ì§€í‘œ ë°•ìŠ¤
    function AdvancedMetricBox({ label, value, desc, good }) {
      return (
        <div className={`p-4 rounded-lg border-2 ${good ? 'bg-green-50 border-green-300' : 'bg-gray-50 border-gray-200'}`}>
          <p className="text-xs text-gray-600 mb-1">{label}</p>
          <p className={`text-2xl font-bold mb-1 ${good ? 'text-green-700' : 'text-gray-700'}`}>{value}</p>
          <p className="text-xs text-gray-500">{desc}</p>
        </div>
      );
    }

    // DNA ì¶”ì¶œ ì»´í¬ë„ŒíŠ¸
    function DnaExtraction({ apiBaseUrl }) {
      const [stocks, setStocks] = useState([{ code: '', startDate: '', endDate: '' }]);
      const [extractedDNA, setExtractedDNA] = useState(null);
      const [matchedStocks, setMatchedStocks] = useState(null);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState(null);
      const [scanOptions, setScanOptions] = useState({
        matchThreshold: 70,
        limit: 10,
        days: 25
      });

      // ì¢…ëª© ì¶”ê°€
      const addStock = () => {
        setStocks([...stocks, { code: '', startDate: '', endDate: '' }]);
      };

      // ì¢…ëª© ì œê±°
      const removeStock = (index) => {
        if (stocks.length > 1) {
          const newStocks = stocks.filter((_, i) => i !== index);
          setStocks(newStocks);
        }
      };

      // ì¢…ëª© ì •ë³´ ì—…ë°ì´íŠ¸
      const updateStock = (index, field, value) => {
        const newStocks = [...stocks];
        newStocks[index][field] = value;
        setStocks(newStocks);
      };

      // DNA ì¶”ì¶œ
      const extractDNA = async () => {
        try {
          setLoading(true);
          setError(null);
          setExtractedDNA(null);
          setMatchedStocks(null);

          // ìœ íš¨ì„± ê²€ì‚¬
          const validStocks = stocks.filter(s => s.code && s.startDate && s.endDate);
          if (validStocks.length === 0) {
            throw new Error('ìµœì†Œ 1ê°œ ì¢…ëª©ì˜ ì½”ë“œì™€ ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš”');
          }

          const response = await fetch(`${apiBaseUrl}/patterns/volume-dna`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              mode: 'extract',
              stocks: validStocks
            })
          });

          const result = await response.json();

          if (result.success) {
            setExtractedDNA(result.result);
          } else {
            throw new Error(result.error || 'DNA ì¶”ì¶œ ì‹¤íŒ¨');
          }
        } catch (err) {
          setError(err.message);
        } finally {
          setLoading(false);
        }
      };

      // ì‹œì¥ ìŠ¤ìº”
      const scanMarket = async () => {
        if (!extractedDNA) {
          setError('ë¨¼ì € DNAë¥¼ ì¶”ì¶œí•˜ì„¸ìš”');
          return;
        }

        try {
          setLoading(true);
          setError(null);

          const response = await fetch(`${apiBaseUrl}/patterns/volume-dna`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              mode: 'scan',
              commonDNA: extractedDNA.commonDNA,
              options: scanOptions
            })
          });

          const result = await response.json();

          if (result.success) {
            setMatchedStocks(result.result);
          } else {
            throw new Error(result.error || 'ì‹œì¥ ìŠ¤ìº” ì‹¤íŒ¨');
          }
        } catch (err) {
          setError(err.message);
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="space-y-6">
          {/* í—¤ë” */}
          <div className="bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl shadow-lg p-6 text-white">
            <h2 className="text-3xl font-bold mb-2">ğŸ§¬ ê±°ë˜ëŸ‰ DNA ì¶”ì¶œ ì‹œìŠ¤í…œ</h2>
            <p className="text-purple-100">
              ê³¼ê±° ê¸‰ë“±ì£¼ì˜ ê±°ë˜ëŸ‰ íŒ¨í„´ì—ì„œ DNAë¥¼ ì¶”ì¶œí•˜ì—¬ í˜„ì¬ ì‹œì¥ì—ì„œ ìœ ì‚¬í•œ ì¢…ëª©ì„ ì°¾ìŠµë‹ˆë‹¤
            </p>
          </div>

          {error && (
            <div className="bg-red-100 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded">
              {error}
            </div>
          )}

          {/* Phase 1: DNA ì¶”ì¶œ */}
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h3 className="text-xl font-bold text-gray-800 mb-4">ğŸ“Š Phase 1: DNA ì¶”ì¶œ</h3>
            <p className="text-sm text-gray-600 mb-4">
              ê³¼ê±° ê¸‰ë“±í–ˆë˜ ì¢…ëª©ë“¤ì˜ ê±°ë˜ëŸ‰ íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬ ê³µí†µ DNAë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤
            </p>

            {/* ì¢…ëª© ì…ë ¥ í¼ */}
            <div className="space-y-3 mb-4">
              {stocks.map((stock, index) => (
                <div key={index} className="flex gap-2 items-center">
                  <input
                    type="text"
                    placeholder="ì¢…ëª©ì½”ë“œ (ì˜ˆ: 005930)"
                    value={stock.code}
                    onChange={(e) => updateStock(index, 'code', e.target.value)}
                    className="flex-1 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                  />
                  <input
                    type="text"
                    placeholder="ì‹œì‘ì¼ (YYYYMMDD)"
                    value={stock.startDate}
                    onChange={(e) => updateStock(index, 'startDate', e.target.value)}
                    className="w-40 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                  />
                  <input
                    type="text"
                    placeholder="ì¢…ë£Œì¼ (YYYYMMDD)"
                    value={stock.endDate}
                    onChange={(e) => updateStock(index, 'endDate', e.target.value)}
                    className="w-40 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                  />
                  {stocks.length > 1 && (
                    <button
                      onClick={() => removeStock(index)}
                      className="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600"
                    >
                      âœ•
                    </button>
                  )}
                </div>
              ))}
            </div>

            <div className="flex gap-2">
              <button
                onClick={addStock}
                className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"
              >
                + ì¢…ëª© ì¶”ê°€
              </button>
              <button
                onClick={extractDNA}
                disabled={loading}
                className="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50"
              >
                {loading ? 'ğŸ” ì¶”ì¶œ ì¤‘...' : 'ğŸ§¬ DNA ì¶”ì¶œ'}
              </button>
            </div>
          </div>

          {/* ì¶”ì¶œëœ DNA ê²°ê³¼ */}
          {extractedDNA && (
            <div className="bg-white rounded-xl shadow-lg p-6">
              <h3 className="text-xl font-bold text-gray-800 mb-4">âœ… ì¶”ì¶œëœ DNA</h3>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div className="bg-purple-50 p-4 rounded-lg">
                  <p className="text-sm text-gray-600">DNA ê°•ë„</p>
                  <p className="text-2xl font-bold text-purple-600">{extractedDNA.dnaStrength}%</p>
                </div>
                <div className="bg-indigo-50 p-4 rounded-lg">
                  <p className="text-sm text-gray-600">ë¶„ì„ ì¢…ëª©</p>
                  <p className="text-2xl font-bold text-indigo-600">{extractedDNA.basedOnStocks}ê°œ</p>
                </div>
              </div>

              {/* DNA ì„¸ë¶€ ì •ë³´ */}
              <div className="space-y-4">
                {extractedDNA.commonDNA.volumeRate && (
                  <div className="border-l-4 border-purple-500 pl-4">
                    <p className="font-semibold text-gray-800">ê±°ë˜ëŸ‰ ì¦ê°€ìœ¨ DNA</p>
                    <div className="text-sm text-gray-600 mt-2 space-y-1">
                      <p>â€¢ í‰ê·  EMA: <span className="font-semibold">{extractedDNA.commonDNA.volumeRate.avgEMA.toFixed(2)}%</span></p>
                      <p>â€¢ ìµœê·¼ 5ì¼ í‰ê· : <span className="font-semibold">{extractedDNA.commonDNA.volumeRate.avgRecent5d.toFixed(2)}%</span></p>
                      <p>â€¢ ì„ê³„ê°’ (EMA): <span className="font-semibold">{extractedDNA.commonDNA.volumeRate.threshold.emaMin.toFixed(2)}%</span></p>
                    </div>
                  </div>
                )}

                {extractedDNA.commonDNA.institutionFlow && (
                  <div className="border-l-4 border-indigo-500 pl-4">
                    <p className="font-semibold text-gray-800">ê¸°ê´€ íˆ¬ìì DNA</p>
                    <div className="text-sm text-gray-600 mt-2">
                      <p>â€¢ í‰ê·  ì—°ì† ë§¤ìˆ˜: <span className="font-semibold">{extractedDNA.commonDNA.institutionFlow.avgConsecutiveDays}ì¼</span></p>
                    </div>
                  </div>
                )}

                {extractedDNA.commonDNA.foreignFlow && (
                  <div className="border-l-4 border-blue-500 pl-4">
                    <p className="font-semibold text-gray-800">ì™¸êµ­ì¸ íˆ¬ìì DNA</p>
                    <div className="text-sm text-gray-600 mt-2">
                      <p>â€¢ í‰ê·  ì—°ì† ë§¤ìˆ˜: <span className="font-semibold">{extractedDNA.commonDNA.foreignFlow.avgConsecutiveDays}ì¼</span></p>
                    </div>
                  </div>
                )}
              </div>

              {/* Phase 2: ì‹œì¥ ìŠ¤ìº” */}
              <div className="mt-6 pt-6 border-t">
                <h3 className="text-lg font-bold text-gray-800 mb-4">ğŸ” Phase 2: ì‹œì¥ ìŠ¤ìº”</h3>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                  <div>
                    <label className="block text-sm text-gray-600 mb-1">ë§¤ì¹­ ì„ê³„ê°’</label>
                    <input
                      type="number"
                      value={scanOptions.matchThreshold}
                      onChange={(e) => setScanOptions({...scanOptions, matchThreshold: parseInt(e.target.value)})}
                      className="w-full px-4 py-2 border rounded-lg"
                      min="0"
                      max="100"
                    />
                  </div>
                  <div>
                    <label className="block text-sm text-gray-600 mb-1">ìµœëŒ€ ë°˜í™˜ ê°œìˆ˜</label>
                    <input
                      type="number"
                      value={scanOptions.limit}
                      onChange={(e) => setScanOptions({...scanOptions, limit: parseInt(e.target.value)})}
                      className="w-full px-4 py-2 border rounded-lg"
                      min="1"
                      max="50"
                    />
                  </div>
                  <div>
                    <label className="block text-sm text-gray-600 mb-1">ë¶„ì„ ê¸°ê°„ (ì¼)</label>
                    <input
                      type="number"
                      value={scanOptions.days}
                      onChange={(e) => setScanOptions({...scanOptions, days: parseInt(e.target.value)})}
                      className="w-full px-4 py-2 border rounded-lg"
                      min="10"
                      max="60"
                    />
                  </div>
                </div>

                <button
                  onClick={scanMarket}
                  disabled={loading}
                  className="w-full px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 font-semibold"
                >
                  {loading ? 'ğŸ” ìŠ¤ìº” ì¤‘...' : 'ğŸš€ í˜„ì¬ ì‹œì¥ì—ì„œ ë§¤ì¹­ ì¢…ëª© ì°¾ê¸°'}
                </button>
              </div>
            </div>
          )}

          {/* ë§¤ì¹­ëœ ì¢…ëª© ê²°ê³¼ */}
          {matchedStocks && (
            <div className="bg-white rounded-xl shadow-lg p-6">
              <h3 className="text-xl font-bold text-gray-800 mb-4">
                ğŸ¯ DNA ë§¤ì¹­ ì¢…ëª© ({matchedStocks.matchedStocks.length}ê°œ)
              </h3>

              {matchedStocks.matchedStocks.length === 0 ? (
                <div className="text-center py-8 text-gray-500">
                  <p className="mb-2">ë§¤ì¹­ë˜ëŠ” ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤</p>
                  <p className="text-sm">ì„ê³„ê°’ì„ ë‚®ì¶”ê±°ë‚˜ ë¶„ì„ ê¸°ê°„ì„ ì¡°ì •í•´ë³´ì„¸ìš”</p>
                </div>
              ) : (
                <div className="space-y-4">
                  {matchedStocks.matchedStocks.map((stock, index) => (
                    <div key={index} className="border rounded-lg p-4 hover:bg-gray-50">
                      <div className="flex justify-between items-start mb-3">
                        <div>
                          <h4 className="font-bold text-lg text-gray-800">
                            {stock.stockName} ({stock.stockCode})
                          </h4>
                          <p className="text-sm text-gray-600">
                            ë¶„ì„ ì¼ìˆ˜: {stock.analyzedDays}ì¼
                          </p>
                        </div>
                        <div className="text-right">
                          <p className="text-2xl font-bold text-purple-600">
                            {stock.matchScore}ì 
                          </p>
                          <p className="text-sm text-gray-500">ë§¤ì¹­ ì ìˆ˜</p>
                        </div>
                      </div>

                      {/* ì ìˆ˜ ì„¸ë¶€ */}
                      {stock.scoreDetails.volumeRate && (
                        <div className="bg-purple-50 p-3 rounded mb-2">
                          <p className="text-sm font-semibold text-gray-700 mb-1">ê±°ë˜ëŸ‰ ì¦ê°€ìœ¨</p>
                          <div className="text-xs text-gray-600 space-y-1">
                            <p>â€¢ EMA í‰ê· : {stock.scoreDetails.volumeRate.current.emaAvg.toFixed(2)}% (ê¸°ì¤€: {stock.scoreDetails.volumeRate.threshold.emaMin.toFixed(2)}%)</p>
                            <p>â€¢ ìµœê·¼ 5ì¼: {stock.scoreDetails.volumeRate.current.recent5d.toFixed(2)}% (ê¸°ì¤€: {stock.scoreDetails.volumeRate.threshold.recent5dMin.toFixed(2)}%)</p>
                          </div>
                        </div>
                      )}

                      {/* íŒ¨í„´ ì •ë³´ */}
                      {stock.pattern.volumeRate && (
                        <div className="flex gap-2 text-xs">
                          <span className={`px-2 py-1 rounded ${
                            stock.pattern.volumeRate.segmented.trend === 'accelerating'
                              ? 'bg-green-100 text-green-700'
                              : stock.pattern.volumeRate.segmented.trend === 'mixed'
                              ? 'bg-yellow-100 text-yellow-700'
                              : 'bg-gray-100 text-gray-700'
                          }`}>
                            íŠ¸ë Œë“œ: {stock.pattern.volumeRate.segmented.trend}
                          </span>
                          <span className={`px-2 py-1 rounded ${
                            stock.pattern.volumeRate.urgency === 'high'
                              ? 'bg-red-100 text-red-700'
                              : stock.pattern.volumeRate.urgency === 'medium'
                              ? 'bg-orange-100 text-orange-700'
                              : 'bg-blue-100 text-blue-700'
                          }`}>
                            ê¸‰ë“± ì„ë°•ì„±: {stock.pattern.volumeRate.urgency}
                          </span>
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}
        </div>
      );
    }

    // ë Œë”ë§
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
