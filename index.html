<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stock Volume Analyzer - AI ì¶”ì²œ ì¢…ëª©</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
    }

    .stock-card {
      transition: all 0.3s ease;
    }

    .stock-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .pulse-animation {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: .5; }
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .slide-in {
      animation: slideIn 0.5s ease-out;
    }

    .grade-S { background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%); }
    .grade-A { background: linear-gradient(135deg, #00cc00 0%, #008800 100%); }
    .grade-B { background: linear-gradient(135deg, #ffaa00 0%, #ff8800 100%); }
    .grade-C { background: linear-gradient(135deg, #888888 0%, #666666 100%); }
    .grade-D { background: linear-gradient(135deg, #cccccc 0%, #999999 100%); }
  </style>
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // API URL ìë™ ê°ì§€ (ë¡œì»¬ vs Vercel)
    const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
      ? 'http://localhost:3001/api'
      : 'https://investar-xi.vercel.app/api';  // Vercel ë°°í¬ í›„ ë³€ê²½

    // ë©”ì¸ ì•±
    function App() {
      const [recommendations, setRecommendations] = useState([]);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState(null);
      const [selectedStock, setSelectedStock] = useState(null);
      const [selectedCategory, setSelectedCategory] = useState('all');
      const [lastUpdate, setLastUpdate] = useState(null);
      const [activeTab, setActiveTab] = useState('screening'); // screening or performance

      // ì¶”ì²œ ì¢…ëª© ë¶ˆëŸ¬ì˜¤ê¸°
      const fetchRecommendations = async (category = 'all') => {
        try {
          setLoading(true);
          setError(null);

          const url = category === 'all'
            ? `${API_BASE_URL}/screening/recommend?limit=10`
            : `${API_BASE_URL}/screening/${category}`;

          const response = await fetch(url);
          const result = await response.json();

          if (result.success) {
            setRecommendations(result.recommendations);
            setLastUpdate(new Date());
          } else {
            setError(result.error || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
          }
        } catch (err) {
          setError('ì„œë²„ì™€ ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + err.message);
        } finally {
          setLoading(false);
        }
      };

      // ì¢…ëª© ìƒì„¸ ë¶„ì„
      const fetchStockDetail = async (stockCode) => {
        try {
          const response = await fetch(`${API_BASE_URL}/stock/${stockCode}/advanced-analysis`);
          const result = await response.json();

          if (result.success) {
            setSelectedStock(result.analysis);
          }
        } catch (err) {
          console.error('ìƒì„¸ ë¶„ì„ ì‹¤íŒ¨:', err);
        }
      };

      // ì¹´í…Œê³ ë¦¬ ë³€ê²½
      const handleCategoryChange = (category) => {
        setSelectedCategory(category);
        fetchRecommendations(category);
      };

      // ì´ˆê¸° ë¡œë“œ
      useEffect(() => {
        fetchRecommendations();
      }, []);

      return (
        <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50">
          {/* í—¤ë” */}
          <header className="bg-white shadow-lg border-b-4 border-indigo-600">
            <div className="max-w-7xl mx-auto px-4 py-6">
              <div className="flex items-center justify-between">
                <div>
                  <h1 className="text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                    ğŸ¤– AI Stock Screener
                  </h1>
                  <p className="text-gray-600 mt-2">ê±°ë˜ëŸ‰ AIê°€ ì¶”ì²œí•˜ëŠ” ì˜¤ëŠ˜ì˜ ì¢…ëª©</p>
                </div>
                <button
                  onClick={() => activeTab === 'screening' ? fetchRecommendations(selectedCategory) : window.location.reload()}
                  disabled={loading}
                  className="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50 font-semibold shadow-lg"
                >
                  {loading ? 'ë¶„ì„ì¤‘...' : 'ğŸ”„ ìƒˆë¡œê³ ì¹¨'}
                </button>
              </div>
              {/* íƒ­ ë©”ë‰´ */}
              <div className="flex gap-4 mt-6 border-b border-gray-200">
                <button
                  onClick={() => setActiveTab('screening')}
                  className={`px-6 py-3 font-semibold transition-all ${
                    activeTab === 'screening'
                      ? 'text-indigo-600 border-b-4 border-indigo-600'
                      : 'text-gray-500 hover:text-gray-700'
                  }`}
                >
                  ğŸ“Š ì¢…ëª© ìŠ¤í¬ë¦¬ë‹
                </button>
                <button
                  onClick={() => setActiveTab('performance')}
                  className={`px-6 py-3 font-semibold transition-all ${
                    activeTab === 'performance'
                      ? 'text-indigo-600 border-b-4 border-indigo-600'
                      : 'text-gray-500 hover:text-gray-700'
                  }`}
                >
                  ğŸ“ˆ ì„±ê³¼ ê²€ì¦
                </button>
              </div>
            </div>
          </header>

          <main className="max-w-7xl mx-auto px-4 py-8">
            {/* ì—ëŸ¬ ë©”ì‹œì§€ */}
            {error && (
              <div className="bg-red-100 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded mb-4 shadow">
                <div className="flex justify-between">
                  <span>{error}</span>
                  <button onClick={() => setError(null)} className="font-bold">Ã—</button>
                </div>
              </div>
            )}

            {/* íƒ­ë³„ ì½˜í…ì¸  */}
            {activeTab === 'screening' ? (
              <>
                {/* ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ */}
                {lastUpdate && (
                  <div className="text-sm text-gray-600 mb-4 text-center">
                    ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: {lastUpdate.toLocaleString('ko-KR')}
                  </div>
                )}

                {/* ì¹´í…Œê³ ë¦¬ í•„í„° */}
                <CategoryFilter
                  selected={selectedCategory}
                  onChange={handleCategoryChange}
                  loading={loading}
                />

                {/* ì¶”ì²œ ì¢…ëª© ê·¸ë¦¬ë“œ */}
                {loading && recommendations.length === 0 ? (
                  <LoadingScreen />
                ) : (
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-8">
                    {recommendations.map((stock, index) => (
                      <RecommendationCard
                        key={stock.stockCode}
                        stock={stock}
                        rank={index + 1}
                        onClick={() => fetchStockDetail(stock.stockCode)}
                      />
                    ))}
                  </div>
                )}

                {/* ì¢…ëª© ìƒì„¸ ëª¨ë‹¬ */}
                {selectedStock && (
                  <StockDetailModal
                    stock={selectedStock}
                    onClose={() => setSelectedStock(null)}
                  />
                )}
              </>
            ) : (
              <PerformanceVerification apiBaseUrl={API_BASE_URL} />
            )}
          </main>
        </div>
      );
    }

    // ì¹´í…Œê³ ë¦¬ í•„í„°
    function CategoryFilter({ selected, onChange, loading }) {
      const categories = [
        {
          id: 'all',
          name: 'ğŸ† ì¢…í•© TOP 10',
          icon: 'ğŸ†',
          desc: 'ëª¨ë“  ì§€í‘œë¥¼ ì¢…í•©í•˜ì—¬ ì ìˆ˜ê°€ ë†’ì€ ìƒìœ„ 10ê°œ ì¢…ëª©'
        },
        {
          id: 'whale',
          name: 'ğŸ‹ ê³ ë˜ ê°ì§€',
          icon: 'ğŸ‹',
          desc: 'ê±°ë˜ëŸ‰ ê¸‰ì¦ + ê°€ê²© ìƒìŠ¹ = í°ì†ì˜ ë§¤ìˆ˜ ì‹ í˜¸ í¬ì°©'
        },
        {
          id: 'accumulation',
          name: 'ğŸ¤« ì¡°ìš©í•œ ë§¤ì§‘',
          icon: 'ğŸ¤«',
          desc: 'ë‚®ì€ ë³€ë™ì„± + ê±°ë˜ëŸ‰ ì¦ê°€ = ë¬¼ëŸ‰ ì¡°ìš©íˆ ëª¨ìœ¼ëŠ” ì¤‘'
        },
        {
          id: 'escape',
          name: 'ğŸš€ íƒˆì¶œ ì†ë„',
          icon: 'ğŸš€',
          desc: 'ì €í•­ì„  ëŒíŒŒ + í­ë°œì  ê±°ë˜ëŸ‰ = ìƒìŠ¹ íƒ„ë ¥ ë°œìƒ'
        },
        {
          id: 'drain',
          name: 'ğŸ’§ ìœ ë™ì„± ê³ ê°ˆ',
          icon: 'ğŸ’§',
          desc: 'ê±°ë˜ëŸ‰ ê¸‰ê° + ë³€ë™ì„± í•˜ë½ = ê³§ í° ë³€ë™ ê°€ëŠ¥ì„±'
        },
        {
          id: 'volume-surge',
          name: 'ğŸ”¥ ê±°ë˜ëŸ‰ í­ë°œ',
          icon: 'ğŸ”¥',
          desc: 'í‰ê·  ëŒ€ë¹„ 2.5ë°° ì´ìƒ ê±°ë˜ëŸ‰ ê¸‰ì¦ ì¢…ëª©'
        }
      ];

      return (
        <div className="bg-white rounded-xl shadow-lg p-4">
          <div className="flex flex-wrap gap-3 justify-center">
            {categories.map(cat => (
              <div key={cat.id} className="relative group">
                <button
                  onClick={() => onChange(cat.id)}
                  disabled={loading}
                  className={`px-6 py-3 rounded-lg font-semibold transition-all ${
                    selected === cat.id
                      ? 'bg-indigo-600 text-white shadow-lg scale-105'
                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                  }`}
                >
                  <span className="text-xl mr-2">{cat.icon}</span>
                  {cat.name}
                </button>
                {/* íˆ´íŒ */}
                <div className="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-10 shadow-xl">
                  {cat.desc}
                  <div className="absolute top-full left-1/2 transform -translate-x-1/2 -mt-1">
                    <div className="border-4 border-transparent border-t-gray-900"></div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    // ì¶”ì²œ ì¢…ëª© ì¹´ë“œ
    function RecommendationCard({ stock, rank, onClick }) {
      const gradeClass = `grade-${stock.recommendation.grade}`;
      const isPositive = stock.changeRate >= 0;

      // ê±°ë˜ëŸ‰ ë¹„ìœ¨ ê³„ì‚°
      const volumeRatio = stock.volumeAnalysis.current.volumeMA20
        ? (stock.volume / stock.volumeAnalysis.current.volumeMA20).toFixed(1)
        : null;

      // ë±ƒì§€ ë°ì´í„°
      const badges = [];
      if (stock.rankBadges) {
        if (stock.rankBadges.volumeSurge) badges.push({ text: 'ê±°ë˜ëŸ‰ê¸‰ì¦', color: 'bg-red-500' });
        if (stock.rankBadges.tradingValue) badges.push({ text: 'ê±°ë˜ëŒ€ê¸ˆ', color: 'bg-orange-500' });
        if (stock.rankBadges.volume) badges.push({ text: 'ê±°ë˜ëŸ‰', color: 'bg-yellow-500' });
      }

      return (
        <div
          className="stock-card bg-white rounded-xl shadow-lg overflow-hidden cursor-pointer slide-in"
          onClick={onClick}
        >
          {/* ë“±ê¸‰ ë°°ì§€ */}
          <div className={`${gradeClass} px-4 py-3 flex justify-between items-center`}>
            <span className="text-white font-bold text-lg">#{rank}</span>
            <span className="text-white font-bold text-2xl">{stock.recommendation.grade}</span>
            <span className="text-white text-sm">ì ìˆ˜: {stock.totalScore}</span>
          </div>

          {/* ì¢…ëª© ì •ë³´ */}
          <div className="p-5">
            <div className="flex justify-between items-start mb-4">
              <div className="flex-1">
                <h3 className="text-xl font-bold text-gray-900">{stock.stockName}</h3>
                <p className="text-sm text-gray-500">{stock.stockCode}</p>
                {/* ë­í‚¹ ë±ƒì§€ */}
                {badges.length > 0 && (
                  <div className="flex flex-wrap gap-1 mt-2">
                    {badges.map((badge, i) => (
                      <span key={i} className={`${badge.color} text-white text-xs px-2 py-1 rounded-full font-semibold`}>
                        ğŸ† {badge.text}
                      </span>
                    ))}
                  </div>
                )}
              </div>
              <div className="text-right">
                <p className="text-2xl font-bold text-gray-900">
                  {stock.currentPrice.toLocaleString()}
                </p>
                <p className={`text-sm font-semibold ${isPositive ? 'text-red-600' : 'text-blue-600'}`}>
                  {isPositive ? 'â–²' : 'â–¼'} {Math.abs(stock.changeRate).toFixed(2)}%
                </p>
              </div>
            </div>

            {/* ì¶”ì²œ ì´ìœ  */}
            <div className="bg-gray-50 rounded-lg p-3 mb-4">
              <p className="text-sm font-semibold text-indigo-600 mb-2">
                {stock.recommendation.text}
              </p>
              <div className="flex flex-wrap gap-1 mb-2">
                {stock.advancedAnalysis.signals.slice(0, 3).map((signal, i) => (
                  <span key={i} className="text-xs bg-white px-2 py-1 rounded-full border border-gray-200">
                    {signal}
                  </span>
                ))}
              </div>
              {/* ì„ ì • ê¸°ì¤€ ìƒì„¸ */}
              <div className="text-xs text-gray-600 mt-2 space-y-1">
                {stock.advancedAnalysis.indicators.whale.length > 0 && (
                  <div>ğŸ‹ ê³ ë˜ê°ì§€: {stock.advancedAnalysis.indicators.whale.length}ê±´ (ìµœê·¼ ê°•ë„ {stock.advancedAnalysis.indicators.whale[stock.advancedAnalysis.indicators.whale.length - 1].intensity.toFixed(1)})</div>
                )}
                {stock.advancedAnalysis.indicators.accumulation.detected && (
                  <div>ğŸ¤« ì¡°ìš©í•œë§¤ì§‘: ê±°ë˜ëŸ‰â†‘{stock.advancedAnalysis.indicators.accumulation.volumeGrowth}% / ë³€ë™ì„±â†“{stock.advancedAnalysis.indicators.accumulation.priceVolatility}%</div>
                )}
                {stock.advancedAnalysis.indicators.escape.detected && (
                  <div>ğŸš€ íƒˆì¶œì†ë„: ì €í•­ì„  {stock.advancedAnalysis.indicators.escape.resistance.toLocaleString()}ì› ëŒíŒŒ (+{stock.advancedAnalysis.indicators.escape.priceBreakout}%)</div>
                )}
                {stock.advancedAnalysis.indicators.drain.detected && (
                  <div>ğŸ’§ ìœ ë™ì„±ê³ ê°ˆ: ê±°ë˜ëŸ‰â†“{stock.advancedAnalysis.indicators.drain.volumeDecline}% / ë³€ë™ì„±â†“{stock.advancedAnalysis.indicators.drain.volatilityDecline}%</div>
                )}
                <div className="relative group inline-block">
                  <span className="cursor-help border-b border-dotted border-gray-400">
                    ğŸ“Š ë¹„ëŒ€ì¹­ë¹„ìœ¨: {stock.advancedAnalysis.indicators.asymmetric.ratio} ({stock.advancedAnalysis.indicators.asymmetric.upDays}ì¼ ìƒìŠ¹ vs {stock.advancedAnalysis.indicators.asymmetric.downDays}ì¼ í•˜ë½)
                  </span>
                  {/* ì¸ë¼ì¸ íˆ´íŒ */}
                  <div className="absolute left-0 top-full mt-1 w-72 px-3 py-2 bg-gray-800 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 shadow-xl">
                    <div className="font-bold mb-1">ğŸ’¡ ìƒìŠ¹ì¼ ê±°ë˜ëŸ‰ì´ {stock.advancedAnalysis.indicators.asymmetric.ratio}ë°° ë” ë§ìŒ</div>
                    <div>â€¢ ë¹„ìœ¨ &gt; 1.5: ì„¸ë ¥ì´ ê°•í•˜ê²Œ ë§¤ì§‘ ì¤‘ ğŸ”¥</div>
                    <div>â€¢ ë¹„ìœ¨ &lt; 0.7: ì„¸ë ¥ì´ ë¬¼ëŸ‰ ë˜ì§€ëŠ” ì¤‘ âš ï¸</div>
                    <div className="mt-1 text-green-300">â†’ {stock.advancedAnalysis.indicators.asymmetric.signal}</div>
                  </div>
                </div>
              </div>
            </div>

            {/* ì£¼ìš” ì§€í‘œ */}
            <div className="grid grid-cols-3 gap-2 text-sm">
              <div className="bg-blue-50 p-2 rounded">
                <p className="text-gray-600 text-xs">ê±°ë˜ëŸ‰ ë¹„ìœ¨</p>
                <p className="font-bold text-blue-700">{volumeRatio ? `${volumeRatio}x` : 'N/A'}</p>
              </div>
              <div className="bg-purple-50 p-2 rounded">
                <p className="text-gray-600 text-xs">MFI</p>
                <p className="font-bold text-purple-700">
                  {stock.volumeAnalysis.indicators.mfi?.toFixed(1) || 'N/A'}
                </p>
              </div>
              <div className="bg-green-50 p-2 rounded relative group">
                <p className="text-gray-600 text-xs">ë¹„ëŒ€ì¹­ â“˜</p>
                <p className="font-bold text-green-700">
                  {stock.advancedAnalysis.indicators.asymmetric.ratio || 'N/A'}
                </p>
                {/* íˆ´íŒ */}
                <div className="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 shadow-xl">
                  <div className="font-bold mb-1">ğŸ“Š ë¹„ëŒ€ì¹­ ë¹„ìœ¨ì´ë€?</div>
                  <div className="space-y-1">
                    <div>"ìƒìŠ¹ì¼ vs í•˜ë½ì¼ ê±°ë˜ëŸ‰ ë¹„êµ"</div>
                    <div className="text-yellow-300">â€¢ {stock.advancedAnalysis.indicators.asymmetric.ratio}ë°° = ìƒìŠ¹ì¼ ê±°ë˜ëŸ‰ì´ {stock.advancedAnalysis.indicators.asymmetric.ratio}ë°° ë” ë§ìŒ</div>
                    <div>â€¢ ìƒìŠ¹: {stock.advancedAnalysis.indicators.asymmetric.upDays}ì¼ ({(stock.advancedAnalysis.indicators.asymmetric.upVolume / 1000000).toFixed(1)}M)</div>
                    <div>â€¢ í•˜ë½: {stock.advancedAnalysis.indicators.asymmetric.downDays}ì¼ ({(stock.advancedAnalysis.indicators.asymmetric.downVolume / 1000000).toFixed(1)}M)</div>
                    <div className="text-green-300 mt-1">â†’ {stock.advancedAnalysis.indicators.asymmetric.signal}</div>
                  </div>
                  <div className="absolute top-full left-1/2 transform -translate-x-1/2 -mt-1">
                    <div className="border-4 border-transparent border-t-gray-900"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ë¡œë”© í™”ë©´
    function LoadingScreen() {
      return (
        <div className="text-center py-20">
          <div className="inline-block animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-indigo-600 mb-4"></div>
          <h3 className="text-2xl font-bold text-gray-800 mb-2">AIê°€ ì¢…ëª©ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</h3>
          <p className="text-gray-600">ì „ì²´ ì¢…ëª© ìŠ¤í¬ë¦¬ë‹ ì¤‘ (ìˆ˜ ë¶„ ì†Œìš”)</p>
        </div>
      );
    }

    // ì¢…ëª© ìƒì„¸ ëª¨ë‹¬
    function StockDetailModal({ stock, onClose }) {
      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" onClick={onClose}>
          <div className="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl" onClick={(e) => e.stopPropagation()}>
            {/* í—¤ë” */}
            <div className="sticky top-0 bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-6 rounded-t-2xl">
              <div className="flex justify-between items-start">
                <div>
                  <h2 className="text-3xl font-bold">{stock.stockName}</h2>
                  <p className="text-indigo-100 mt-1">{stock.stockCode}</p>
                </div>
                <button
                  onClick={onClose}
                  className="text-white hover:text-gray-200 text-3xl leading-none"
                >
                  Ã—
                </button>
              </div>

              <div className="mt-4 flex items-baseline gap-4">
                <span className="text-4xl font-bold">{stock.currentPrice.toLocaleString()}ì›</span>
                <span className={`text-xl font-semibold ${stock.changeRate >= 0 ? 'text-red-300' : 'text-blue-300'}`}>
                  {stock.changeRate >= 0 ? 'â–²' : 'â–¼'} {Math.abs(stock.changeRate).toFixed(2)}%
                </span>
              </div>
            </div>

            {/* ì½˜í…ì¸  */}
            <div className="p-6 space-y-6">
              {/* ì¢…í•© í‰ê°€ */}
              <div className="bg-gradient-to-br from-yellow-50 to-orange-50 border-2 border-yellow-300 rounded-xl p-6">
                <h3 className="text-xl font-bold mb-3">ğŸ¯ ì¢…í•© í‰ê°€</h3>
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-3xl font-bold text-indigo-600">{stock.totalScore}ì </p>
                    <p className="text-gray-600 mt-1">{stock.recommendation.text}</p>
                  </div>
                  <div className={`grade-${stock.recommendation.grade} w-24 h-24 rounded-full flex items-center justify-center`}>
                    <span className="text-white text-5xl font-bold">{stock.recommendation.grade}</span>
                  </div>
                </div>
              </div>

              {/* ì°½ì˜ì  ì§€í‘œ */}
              <div className="bg-white border-2 border-gray-200 rounded-xl p-6">
                <h3 className="text-xl font-bold mb-4">ğŸ” ì°½ì˜ì  ì§€í‘œ ë¶„ì„</h3>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {/* ê³ ë˜ ê°ì§€ */}
                  <IndicatorBox
                    title="ğŸ‹ ê³ ë˜ ê°ì§€"
                    detected={stock.advancedAnalysis.indicators.whale.length > 0}
                    signal={stock.advancedAnalysis.indicators.whale.length > 0 ? `${stock.advancedAnalysis.indicators.whale.length}ê±´ ê°ì§€` : 'ì—†ìŒ'}
                    detail={stock.advancedAnalysis.indicators.whale.length > 0 ?
                      stock.advancedAnalysis.indicators.whale.map(w =>
                        `${w.date.slice(4,6)}/${w.date.slice(6,8)}: ê±°ë˜ëŸ‰ ${w.volumeRatio}ë°°, ê°€ê²© +${w.priceChange}%, ê°•ë„ ${w.intensity.toFixed(1)}`
                      ).join(' | ') : 'ê±°ë˜ëŸ‰ ê¸‰ì¦ + ê°€ê²© ìƒìŠ¹ ì¡°í•© ë¯¸ë°œê²¬'}
                  />

                  {/* ì¡°ìš©í•œ ë§¤ì§‘ */}
                  <IndicatorBox
                    title="ğŸ¤« ì¡°ìš©í•œ ë§¤ì§‘"
                    detected={stock.advancedAnalysis.indicators.accumulation.detected}
                    signal={stock.advancedAnalysis.indicators.accumulation.signal}
                    detail={`ê±°ë˜ëŸ‰â†‘${stock.advancedAnalysis.indicators.accumulation.volumeGrowth}% / ë³€ë™ì„±â†“${stock.advancedAnalysis.indicators.accumulation.priceVolatility}% / í‰ê· ê°€ ${stock.advancedAnalysis.indicators.accumulation.avgPrice.toLocaleString()}ì› / ì ìˆ˜ ${stock.advancedAnalysis.indicators.accumulation.score}`}
                  />

                  {/* íƒˆì¶œ ì†ë„ */}
                  <IndicatorBox
                    title="ğŸš€ íƒˆì¶œ ì†ë„"
                    detected={stock.advancedAnalysis.indicators.escape.detected}
                    signal={stock.advancedAnalysis.indicators.escape.signal}
                    detail={stock.advancedAnalysis.indicators.escape.detected ?
                      `ì €í•­ì„  ${stock.advancedAnalysis.indicators.escape.resistance.toLocaleString()}ì› â†’ í˜„ì¬ ${stock.advancedAnalysis.indicators.escape.currentPrice.toLocaleString()}ì› (+${stock.advancedAnalysis.indicators.escape.priceBreakout}%) / ê±°ë˜ëŸ‰ ${stock.advancedAnalysis.indicators.escape.volumeRatio}ë°° / ëª¨ë©˜í…€ ${stock.advancedAnalysis.indicators.escape.momentum} / ì ìˆ˜ ${stock.advancedAnalysis.indicators.escape.score.toFixed(1)}`
                      : `ì €í•­ì„  ëŒíŒŒ ì‹¤íŒ¨ / ì ìˆ˜ ${stock.advancedAnalysis.indicators.escape.score}`}
                  />

                  {/* ìœ ë™ì„± ê³ ê°ˆ */}
                  <IndicatorBox
                    title="ğŸ’§ ìœ ë™ì„± ê³ ê°ˆ"
                    detected={stock.advancedAnalysis.indicators.drain.detected}
                    signal={stock.advancedAnalysis.indicators.drain.signal}
                    detail={`ê±°ë˜ëŸ‰â†“${stock.advancedAnalysis.indicators.drain.volumeDecline}% / ë³€ë™ì„±â†“${stock.advancedAnalysis.indicators.drain.volatilityDecline}% / ìµœê·¼í‰ê·  ${(stock.advancedAnalysis.indicators.drain.avgVolumeRecent / 1000).toFixed(0)}K / ì ìˆ˜ ${stock.advancedAnalysis.indicators.drain.score}`}
                  />

                  {/* ë¹„ëŒ€ì¹­ ê±°ë˜ëŸ‰ */}
                  <IndicatorBox
                    title="ğŸ“Š ë¹„ëŒ€ì¹­ ê±°ë˜ëŸ‰"
                    detected={stock.advancedAnalysis.indicators.asymmetric.ratio >= 1.5}
                    signal={stock.advancedAnalysis.indicators.asymmetric.signal}
                    detail={`ë¹„ìœ¨ ${stock.advancedAnalysis.indicators.asymmetric.ratio} | ìƒìŠ¹ ${stock.advancedAnalysis.indicators.asymmetric.upDays}ì¼ (${(stock.advancedAnalysis.indicators.asymmetric.upVolume / 1000000).toFixed(1)}M) vs í•˜ë½ ${stock.advancedAnalysis.indicators.asymmetric.downDays}ì¼ (${(stock.advancedAnalysis.indicators.asymmetric.downVolume / 1000000).toFixed(1)}M) | ìƒìŠ¹ì¼ ê±°ë˜ëŸ‰ì´ ${stock.advancedAnalysis.indicators.asymmetric.ratio}ë°° ë” ë§ìŒ â†’ ${stock.advancedAnalysis.indicators.asymmetric.ratio >= 3 ? 'ì„¸ë ¥ ê°•ë ¥ ë§¤ì§‘ ğŸ”¥ğŸ”¥' : stock.advancedAnalysis.indicators.asymmetric.ratio >= 1.5 ? 'ì„¸ë ¥ ë§¤ì§‘ ì¤‘ ğŸ”¥' : stock.advancedAnalysis.indicators.asymmetric.ratio <= 0.7 ? 'ì„¸ë ¥ ë§¤ë„ ì¤‘ âš ï¸' : 'ì¤‘ë¦½ âš–ï¸'} / ì ìˆ˜ ${stock.advancedAnalysis.indicators.asymmetric.score.toFixed(1)}`}
                  />
                </div>

                <div className="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                  <h4 className="font-bold text-blue-900 mb-2">ğŸ’¡ ë¹„ëŒ€ì¹­ ê±°ë˜ëŸ‰ í•´ì„</h4>
                  <div className="text-sm text-blue-800 space-y-1">
                    <div>â€¢ ë¹„ìœ¨ &gt; 3.0: ì„¸ë ¥ì´ ê°•ë ¥í•˜ê²Œ ë§¤ì§‘ ì¤‘ (ìƒìŠ¹ì¼ ê±°ë˜ëŸ‰ì´ 3ë°° ì´ìƒ) ğŸ”¥ğŸ”¥ğŸ”¥</div>
                    <div>â€¢ ë¹„ìœ¨ 1.5~3.0: ì„¸ë ¥ì´ ë§¤ì§‘ ì¤‘ (ìƒìŠ¹ì¼ ê±°ë˜ëŸ‰ ìš°ìœ„) ğŸ”¥</div>
                    <div>â€¢ ë¹„ìœ¨ 0.7~1.5: ì¤‘ë¦½ (ê· í˜•) âš–ï¸</div>
                    <div>â€¢ ë¹„ìœ¨ &lt; 0.7: ì„¸ë ¥ì´ ë§¤ë„ ì¤‘ (í•˜ë½ì¼ ê±°ë˜ëŸ‰ ë” ë§ìŒ) âš ï¸</div>
                  </div>
                </div>
              </div>

              {/* ê±°ë˜ëŸ‰ ì§€í‘œ */}
              <div className="bg-white border-2 border-gray-200 rounded-xl p-6">
                <h3 className="text-xl font-bold mb-4">ğŸ“Š ê±°ë˜ëŸ‰ ì§€í‘œ</h3>
                <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                  <StatBox
                    label="MFI (ìê¸ˆíë¦„ì§€ìˆ˜)"
                    value={stock.volumeAnalysis.indicators.mfi?.toFixed(1)}
                    desc={
                      stock.volumeAnalysis.indicators.mfi >= 70 ? 'ê³¼ë§¤ìˆ˜' :
                      stock.volumeAnalysis.indicators.mfi <= 30 ? 'ê³¼ë§¤ë„' : 'ì¤‘ë¦½'
                    }
                  />
                  <StatBox
                    label="OBV (ê±°ë˜ëŸ‰ ì¶”ì„¸)"
                    value={(stock.volumeAnalysis.indicators.obv / 1000000).toFixed(1) + 'M'}
                    desc={stock.volumeAnalysis.signals.obvTrend}
                  />
                  <StatBox
                    label="VWAP (í‰ê· ê°€)"
                    value={stock.volumeAnalysis.indicators.vwap?.toLocaleString()}
                    desc={stock.volumeAnalysis.signals.priceVsVWAP}
                  />
                </div>
                <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                  <StatBox
                    label="ê±°ë˜ëŸ‰ ë¹„ìœ¨"
                    value={stock.volumeAnalysis.current.volumeMA20 ?
                      (stock.volume / stock.volumeAnalysis.current.volumeMA20).toFixed(1) + 'x' : 'N/A'}
                    desc="vs 20ì¼ í‰ê· "
                  />
                  <StatBox
                    label="ë¹„ëŒ€ì¹­ ë¹„ìœ¨ (ìƒìŠ¹ì¼/í•˜ë½ì¼)"
                    value={stock.advancedAnalysis.indicators.asymmetric.ratio}
                    desc={`${stock.advancedAnalysis.indicators.asymmetric.signal} | ìƒìŠ¹ ${stock.advancedAnalysis.indicators.asymmetric.upDays}ì¼(${(stock.advancedAnalysis.indicators.asymmetric.upVolume / 1000000).toFixed(0)}M) vs í•˜ë½ ${stock.advancedAnalysis.indicators.asymmetric.downDays}ì¼(${(stock.advancedAnalysis.indicators.asymmetric.downVolume / 1000000).toFixed(0)}M)`}
                  />
                  <StatBox
                    label="ì‹œê°€ì´ì•¡"
                    value={(stock.marketCap / 100000000).toFixed(0) + 'ì–µ'}
                    desc="ì›"
                  />
                </div>
              </div>

              {/* ì‹ í˜¸ ìš”ì•½ */}
              <div className="bg-indigo-50 border-2 border-indigo-200 rounded-xl p-6">
                <h3 className="text-xl font-bold mb-4 text-indigo-900">ğŸ“¢ ê°ì§€ëœ ì‹ í˜¸</h3>
                <div className="flex flex-wrap gap-2">
                  {stock.advancedAnalysis.signals.map((signal, i) => (
                    <span key={i} className="bg-white px-4 py-2 rounded-lg border-2 border-indigo-300 font-semibold text-indigo-700">
                      {signal}
                    </span>
                  ))}
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ì§€í‘œ ë°•ìŠ¤
    function IndicatorBox({ title, detected, signal, detail }) {
      return (
        <div className={`p-4 rounded-lg border-2 ${detected ? 'bg-green-50 border-green-300' : 'bg-gray-50 border-gray-200'}`}>
          <h4 className="font-bold mb-2">{title}</h4>
          <p className={`font-semibold mb-1 ${detected ? 'text-green-700' : 'text-gray-500'}`}>
            {signal}
          </p>
          {detail && <p className="text-xs text-gray-600 leading-relaxed whitespace-pre-wrap break-words">{detail}</p>}
        </div>
      );
    }

    // í†µê³„ ë°•ìŠ¤
    function StatBox({ label, value, desc }) {
      return (
        <div className="bg-gray-50 p-3 rounded-lg">
          <p className="text-xs text-gray-600 mb-1">{label}</p>
          <p className="text-lg font-bold text-gray-900">{value || 'N/A'}</p>
          {desc && <p className="text-xs text-gray-500 mt-1">{desc}</p>}
        </div>
      );
    }

    // ì„±ê³¼ ê²€ì¦ ì»´í¬ë„ŒíŠ¸
    function PerformanceVerification({ apiBaseUrl }) {
      const [backtestData, setBacktestData] = useState(null);
      const [trackerData, setTrackerData] = useState(null);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [activeView, setActiveView] = useState('backtest'); // backtest or realtime

      useEffect(() => {
        fetchPerformanceData();
      }, []);

      const fetchPerformanceData = async () => {
        setLoading(true);
        setError(null);

        try {
          // ë°±í…ŒìŠ¤íŒ… ë°ì´í„°
          const backtestRes = await fetch(`${apiBaseUrl}/backtest`);
          const backtestResult = await backtestRes.json();

          if (backtestResult.success) {
            setBacktestData(backtestResult.data);
          }

          // ì‹¤ì‹œê°„ ì¶”ì  ë°ì´í„°
          const trackerRes = await fetch(`${apiBaseUrl}/tracker?action=performance`);
          const trackerResult = await trackerRes.json();

          if (trackerResult.success) {
            setTrackerData(trackerResult.data);
          }
        } catch (err) {
          setError('ì„±ê³¼ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ' + err.message);
        } finally {
          setLoading(false);
        }
      };

      if (loading) {
        return (
          <div className="text-center py-20">
            <div className="inline-block animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-indigo-600 mb-4"></div>
            <h3 className="text-2xl font-bold text-gray-800 mb-2">ì„±ê³¼ ë°ì´í„° ë¶„ì„ ì¤‘...</h3>
            <p className="text-gray-600">ê³¼ê±° ì¶”ì²œ ì¢…ëª©ì˜ ìˆ˜ìµë¥ ì„ ê³„ì‚°í•˜ê³  ìˆìŠµë‹ˆë‹¤</p>
          </div>
        );
      }

      if (error) {
        return (
          <div className="bg-red-100 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded">
            {error}
          </div>
        );
      }

      const data = activeView === 'backtest' ? backtestData : trackerData;
      const stats = data?.statistics?.overall;

      if (!stats) {
        return (
          <div className="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 px-4 py-3 rounded">
            ì¶©ë¶„í•œ ì„±ê³¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì‹œìŠ¤í…œì´ ì¢…ëª©ì„ ì¶”ì²œí•˜ê³  ì‹œê°„ì´ ì§€ë‚˜ì•¼ ì„±ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </div>
        );
      }

      return (
        <div className="space-y-6">
          {/* ë·° ì„ íƒ */}
          <div className="bg-white rounded-xl shadow-lg p-4">
            <div className="flex gap-4 justify-center">
              <button
                onClick={() => setActiveView('backtest')}
                className={`px-6 py-3 rounded-lg font-semibold transition-all ${
                  activeView === 'backtest'
                    ? 'bg-indigo-600 text-white shadow-lg'
                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                }`}
              >
                ğŸ“Š ê³¼ê±° ë°±í…ŒìŠ¤íŒ…
              </button>
              <button
                onClick={() => setActiveView('realtime')}
                className={`px-6 py-3 rounded-lg font-semibold transition-all ${
                  activeView === 'realtime'
                    ? 'bg-indigo-600 text-white shadow-lg'
                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                }`}
              >
                â±ï¸ ì‹¤ì‹œê°„ ì¶”ì 
              </button>
            </div>
          </div>

          {/* ì „ì²´ ìš”ì•½ ì¹´ë“œ */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <SummaryCard
              title="ì „ì²´ ìŠ¹ë¥ "
              value={`${stats.winRate}%`}
              subtext={`${stats.winCount}/${stats.totalCount} ì¢…ëª© ìƒìŠ¹`}
              color="bg-gradient-to-br from-green-500 to-green-600"
              icon="âœ…"
            />
            <SummaryCard
              title="í‰ê·  ìˆ˜ìµë¥ "
              value={`${stats.avgReturn > 0 ? '+' : ''}${stats.avgReturn}%`}
              subtext={`${data.parameters?.holdingDays || 7}ì¼ ë³´ìœ  ê¸°ì¤€`}
              color="bg-gradient-to-br from-blue-500 to-blue-600"
              icon="ğŸ“ˆ"
            />
            <SummaryCard
              title="ìµœê³  ìˆ˜ìµ"
              value={`+${stats.maxReturn}%`}
              subtext={`ì†ì‹¤ ${stats.minReturn}%`}
              color="bg-gradient-to-br from-purple-500 to-purple-600"
              icon="ğŸ”¥"
            />
            <SummaryCard
              title="ë¶„ì„ ìƒ˜í”Œ"
              value={`${stats.totalCount}ê°œ`}
              subtext={`${data.parameters?.lookbackDays || 30}ì¼ ê¸°ê°„`}
              color="bg-gradient-to-br from-orange-500 to-orange-600"
              icon="ğŸ“Š"
            />
          </div>

          {/* Phase 3: ê³ ê¸‰ ì§€í‘œ */}
          {data.statistics?.advanced && (
            <div className="bg-white rounded-xl shadow-lg p-6">
              <h3 className="text-2xl font-bold mb-6 flex items-center gap-2">
                ğŸ¯ ê³ ê¸‰ ì„±ê³¼ ì§€í‘œ (Phase 3)
              </h3>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <AdvancedMetricBox
                  label="ìƒ¤í”„ ë¹„ìœ¨"
                  value={data.statistics.advanced.sharpeRatio}
                  desc="ìœ„í—˜ ëŒ€ë¹„ ìˆ˜ìµ (>1 ì–‘í˜¸)"
                  good={data.statistics.advanced.sharpeRatio > 1}
                />
                <AdvancedMetricBox
                  label="MDD (ìµœëŒ€ ë‚™í­)"
                  value={`${data.statistics.advanced.maxDrawdown}%`}
                  desc="ìµœëŒ€ ì†ì‹¤ í­ (<10% ì•ˆì •)"
                  good={data.statistics.advanced.maxDrawdown < 10}
                />
                <AdvancedMetricBox
                  label="Profit Factor"
                  value={data.statistics.advanced.profitFactor}
                  desc="ìˆ˜ìµ/ì†ì‹¤ ë¹„ìœ¨ (>1.5 ìš°ìˆ˜)"
                  good={data.statistics.advanced.profitFactor > 1.5}
                />
                <AdvancedMetricBox
                  label="KOSPI ì´ˆê³¼ìˆ˜ìµ"
                  value={`${data.statistics.advanced.excessReturn > 0 ? '+' : ''}${data.statistics.advanced.excessReturn}%`}
                  desc="ì‹œì¥ ëŒ€ë¹„ ì´ˆê³¼ ì„±ê³¼"
                  good={data.statistics.advanced.excessReturn > 0}
                />
              </div>
              <div className="mt-4 p-4 bg-blue-50 rounded-lg">
                <h4 className="font-bold text-blue-900 mb-2">ğŸ’¡ ì¢…í•© í•´ì„</h4>
                <div className="space-y-1">
                  {data.statistics.advanced.interpretation.map((interp, i) => (
                    <div key={i} className="text-sm text-blue-800">{interp}</div>
                  ))}
                </div>
              </div>
            </div>
          )}

          {/* ë“±ê¸‰ë³„ ì„±ê³¼ */}
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h3 className="text-2xl font-bold mb-6">ğŸ“Š ë“±ê¸‰ë³„ ì„±ê³¼</h3>
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-gray-100">
                  <tr>
                    <th className="px-4 py-3 text-left">ë“±ê¸‰</th>
                    <th className="px-4 py-3 text-left">ìƒ˜í”Œ ìˆ˜</th>
                    <th className="px-4 py-3 text-left">ìŠ¹ë¥ </th>
                    <th className="px-4 py-3 text-left">í‰ê·  ìˆ˜ìµë¥ </th>
                    <th className="px-4 py-3 text-left">ìµœê³  ìˆ˜ìµ</th>
                  </tr>
                </thead>
                <tbody>
                  {Object.entries(data.statistics?.byGrade || {}).map(([grade, gstats]) => (
                    <tr key={grade} className="border-b hover:bg-gray-50">
                      <td className="px-4 py-3">
                        <span className={`inline-block px-3 py-1 rounded-full text-white font-bold grade-${grade}`}>
                          {grade}
                        </span>
                      </td>
                      <td className="px-4 py-3">{gstats.count}ê°œ</td>
                      <td className="px-4 py-3">
                        <span className={gstats.winRate >= 70 ? 'text-green-600 font-bold' : gstats.winRate >= 50 ? 'text-blue-600' : 'text-gray-600'}>
                          {gstats.winRate}%
                        </span>
                      </td>
                      <td className="px-4 py-3">
                        <span className={gstats.avgReturn > 0 ? 'text-red-600 font-bold' : 'text-blue-600'}>
                          {gstats.avgReturn > 0 ? '+' : ''}{gstats.avgReturn}%
                        </span>
                      </td>
                      <td className="px-4 py-3 text-green-600 font-semibold">+{gstats.maxReturn}%</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>

          {/* ì¹´í…Œê³ ë¦¬ë³„ ì„±ê³¼ */}
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h3 className="text-2xl font-bold mb-6">ğŸ¯ ì¹´í…Œê³ ë¦¬ë³„ ì„±ê³¼</h3>
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-gray-100">
                  <tr>
                    <th className="px-4 py-3 text-left">ì¹´í…Œê³ ë¦¬</th>
                    <th className="px-4 py-3 text-left">ìƒ˜í”Œ ìˆ˜</th>
                    <th className="px-4 py-3 text-left">ìŠ¹ë¥ </th>
                    <th className="px-4 py-3 text-left">í‰ê·  ìˆ˜ìµë¥ </th>
                    <th className="px-4 py-3 text-left">ìµœê³  ìˆ˜ìµ</th>
                  </tr>
                </thead>
                <tbody>
                  {Object.entries(data.statistics?.byCategory || {}).map(([key, cstats]) => (
                    <tr key={key} className="border-b hover:bg-gray-50">
                      <td className="px-4 py-3 font-semibold">{cstats.label}</td>
                      <td className="px-4 py-3">{cstats.count}ê°œ</td>
                      <td className="px-4 py-3">
                        <span className={cstats.winRate >= 70 ? 'text-green-600 font-bold' : cstats.winRate >= 50 ? 'text-blue-600' : 'text-gray-600'}>
                          {cstats.winRate}%
                        </span>
                      </td>
                      <td className="px-4 py-3">
                        <span className={cstats.avgReturn > 0 ? 'text-red-600 font-bold' : 'text-blue-600'}>
                          {cstats.avgReturn > 0 ? '+' : ''}{cstats.avgReturn}%
                        </span>
                      </td>
                      <td className="px-4 py-3 text-green-600 font-semibold">+{cstats.maxReturn}%</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>

          {/* Phase 3: í¬íŠ¸í´ë¦¬ì˜¤ ì‹œë®¬ë ˆì´ì…˜ */}
          {data.portfolio && (
            <div className="bg-white rounded-xl shadow-lg p-6">
              <h3 className="text-2xl font-bold mb-6 flex items-center gap-2">
                ğŸ’¼ í¬íŠ¸í´ë¦¬ì˜¤ ì‹œë®¬ë ˆì´ì…˜ (5ì¢…ëª© ê· ë“± ë¶„ì‚°)
              </h3>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div className="bg-green-50 p-4 rounded-lg">
                  <p className="text-sm text-gray-600">í¬íŠ¸í´ë¦¬ì˜¤ í‰ê·  ìˆ˜ìµë¥ </p>
                  <p className="text-2xl font-bold text-green-700">
                    {data.portfolio.summary.avgReturn > 0 ? '+' : ''}{data.portfolio.summary.avgReturn}%
                  </p>
                </div>
                <div className="bg-blue-50 p-4 rounded-lg">
                  <p className="text-sm text-gray-600">ì´ ëˆ„ì  ìˆ˜ìµ</p>
                  <p className="text-2xl font-bold text-blue-700">
                    {data.portfolio.summary.totalProfit.toLocaleString()}ì›
                  </p>
                </div>
                <div className="bg-purple-50 p-4 rounded-lg">
                  <p className="text-sm text-gray-600">í¬íŠ¸í´ë¦¬ì˜¤ ìˆ˜</p>
                  <p className="text-2xl font-bold text-purple-700">
                    {data.portfolio.summary.portfolioCount}ê°œ
                  </p>
                </div>
              </div>

              {/* ìµœê³ /ìµœì € í¬íŠ¸í´ë¦¬ì˜¤ */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="bg-green-50 border-2 border-green-300 rounded-lg p-4">
                  <h4 className="font-bold text-green-900 mb-2">ğŸ† ìµœê³  ì„±ê³¼ í¬íŠ¸í´ë¦¬ì˜¤</h4>
                  <p className="text-sm text-gray-600 mb-2">ë‚ ì§œ: {data.portfolio.summary.bestPortfolio?.date}</p>
                  <p className="text-2xl font-bold text-green-700 mb-2">
                    +{data.portfolio.summary.bestPortfolio?.portfolioReturn}%
                  </p>
                  <div className="text-xs text-gray-700">
                    {data.portfolio.summary.bestPortfolio?.stocks.map((s, i) => (
                      <div key={i}>{s.name} ({s.return > 0 ? '+' : ''}{s.return}%)</div>
                    ))}
                  </div>
                </div>

                <div className="bg-red-50 border-2 border-red-300 rounded-lg p-4">
                  <h4 className="font-bold text-red-900 mb-2">âš ï¸ ìµœì € ì„±ê³¼ í¬íŠ¸í´ë¦¬ì˜¤</h4>
                  <p className="text-sm text-gray-600 mb-2">ë‚ ì§œ: {data.portfolio.summary.worstPortfolio?.date}</p>
                  <p className="text-2xl font-bold text-red-700 mb-2">
                    {data.portfolio.summary.worstPortfolio?.portfolioReturn}%
                  </p>
                  <div className="text-xs text-gray-700">
                    {data.portfolio.summary.worstPortfolio?.stocks.map((s, i) => (
                      <div key={i}>{s.name} ({s.return > 0 ? '+' : ''}{s.return}%)</div>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Phase 3: ì‹œì¥ ìƒí™©ë³„ ë¶„ì„ */}
          {data.byMarket && (
            <div className="bg-white rounded-xl shadow-lg p-6">
              <h3 className="text-2xl font-bold mb-6">ğŸ“Š ì‹œì¥ ìƒí™©ë³„ ì„±ê³¼</h3>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                {Object.entries(data.byMarket).map(([key, mstats]) => (
                  <div key={key} className="bg-gray-50 border-2 border-gray-200 rounded-lg p-4">
                    <h4 className="font-bold text-gray-900 mb-2">{mstats.label}</h4>
                    <div className="space-y-1 text-sm">
                      <div>ìƒ˜í”Œ: {mstats.count}ê°œ</div>
                      <div className={mstats.winRate >= 60 ? 'text-green-600 font-bold' : 'text-gray-700'}>
                        ìŠ¹ë¥ : {mstats.winRate}%
                      </div>
                      <div className={mstats.avgReturn > 0 ? 'text-red-600 font-bold' : 'text-blue-600'}>
                        í‰ê· : {mstats.avgReturn > 0 ? '+' : ''}{mstats.avgReturn}%
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* ë°ì´í„° ìƒì„± ì‹œê°„ */}
          <div className="text-center text-sm text-gray-500">
            ë°ì´í„° ìƒì„±: {new Date(data.generatedAt).toLocaleString('ko-KR')}
          </div>
        </div>
      );
    }

    // ìš”ì•½ ì¹´ë“œ
    function SummaryCard({ title, value, subtext, color, icon }) {
      return (
        <div className={`${color} rounded-xl shadow-lg p-6 text-white`}>
          <div className="flex items-center justify-between mb-2">
            <h3 className="text-sm font-semibold opacity-90">{title}</h3>
            <span className="text-2xl">{icon}</span>
          </div>
          <p className="text-3xl font-bold mb-1">{value}</p>
          <p className="text-sm opacity-80">{subtext}</p>
        </div>
      );
    }

    // ê³ ê¸‰ ì§€í‘œ ë°•ìŠ¤
    function AdvancedMetricBox({ label, value, desc, good }) {
      return (
        <div className={`p-4 rounded-lg border-2 ${good ? 'bg-green-50 border-green-300' : 'bg-gray-50 border-gray-200'}`}>
          <p className="text-xs text-gray-600 mb-1">{label}</p>
          <p className={`text-2xl font-bold mb-1 ${good ? 'text-green-700' : 'text-gray-700'}`}>{value}</p>
          <p className="text-xs text-gray-500">{desc}</p>
        </div>
      );
    }

    // ë Œë”ë§
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
