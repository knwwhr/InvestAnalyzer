# 📊 Investar 지표 상세 설명서

## 목차
1. [고래 감지 (Whale Detection)](#1-고래-감지-whale-detection)
2. [조용한 매집 (Silent Accumulation)](#2-조용한-매집-silent-accumulation)
3. [탈출 속도 (Escape Velocity)](#3-탈출-속도-escape-velocity)
4. [유동성 고갈 (Liquidity Drain)](#4-유동성-고갈-liquidity-drain)
5. [거래량 폭발 (Volume Surge)](#5-거래량-폭발-volume-surge)
6. [비대칭 거래량 (Asymmetric Volume)](#6-비대칭-거래량-asymmetric-volume)
7. [과열 감지 (Overheating Detection)](#7-과열-감지-overheating-detection)
8. [점수 계산 체계](#8-점수-계산-체계)

---

## 1. 고래 감지 (Whale Detection)

### 📋 정의
**대형 투자자(기관/외국인)의 매집/매도 패턴 감지**

### 🔢 감지 조건 (AND 조건)
```javascript
// 파일: backend/advancedIndicators.js, Line 38-41
✅ 거래량 비율: 20일 평균 대비 2.5배 이상
✅ 가격 변동: 당일 등락폭 3% 이상
✅ 분석 기간: 최근 10일
```

### 📐 세부 기준

#### 1.1 거래량 비율 계산
```javascript
거래량 비율 = 당일 거래량 / 최근 20일 평균 거래량

예시:
- 당일 거래량: 500,000주
- 20일 평균: 150,000주
- 거래량 비율: 3.33배 → ✅ 감지 (2.5배 이상)
```

#### 1.2 가격 변동률 계산
```javascript
가격 변동률 = |종가 - 시가| / 시가 × 100

예시:
- 시가: 10,000원
- 종가: 10,400원
- 가격 변동률: 4% → ✅ 감지 (3% 이상)
```

#### 1.3 윗꼬리 필터 (되돌림 경고)
```javascript
// Line 27-35
윗꼬리 비율 = (당일 고가 - 종가) / (고가 - 저가) × 100
고가 대비 낙폭 = (당일 고가 - 종가) / 고가 × 100

⚠️ 윗꼬리 30% 이상: 강도 점수 50% 감점
⚠️ 고가 대비 낙폭 표시
```

#### 1.4 강도 점수 계산
```javascript
// Line 45-52
기본 강도 = (거래량 비율 × 가격 변동률) / 10

예시:
- 거래량 비율: 3.33
- 가격 변동: 4%
- 기본 강도: (3.33 × 4) / 10 = 1.33

윗꼬리 30% 이상 시:
- 최종 강도: 1.33 × 0.5 = 0.67 (50% 감점)
```

### 📊 점수 배점
```
최대 점수: 25점 (종합 점수 중 25%)
계산식: min(강도 점수, 25)
```

### 🎯 해석
- **🐋 매수 고래**: 종가 > 시가 (상승 마감)
- **🐳 매도 고래**: 종가 < 시가 (하락 마감)
- **⚠️ 윗꼬리 경고**: 장중 급등 후 되돌림 (추가 하락 위험)

---

## 2. 조용한 매집 (Silent Accumulation)

### 📋 정의
**가격 횡보 + 거래량 점진 증가 = 세력 매집 중**

### 🔢 감지 조건 (AND 조건)
```javascript
// 파일: backend/advancedIndicators.js, Line 94-97
✅ 가격 변동성: 3% 미만 (횡보)
✅ 거래량 증가: 20% 이상 (후반 vs 전반)
✅ 분석 기간: 최근 20일
```

### 📐 세부 기준

#### 2.1 가격 변동성 계산
```javascript
// Line 79-85
1. 최근 20일 종가 수집
2. 평균 종가 계산
3. 표준편차 계산
4. 변동성 = (표준편차 / 평균 종가) × 100

예시:
- 평균 종가: 10,000원
- 표준편차: 250원
- 가격 변동성: 2.5% → ✅ 감지 (3% 미만)
```

#### 2.2 거래량 증가 계산
```javascript
// Line 88-92
전반 10일 평균 거래량: avgVolumeFirst
후반 10일 평균 거래량: avgVolumeSecond
거래량 증가율 = (후반 - 전반) / 전반 × 100

예시:
- 전반 평균: 100,000주
- 후반 평균: 135,000주
- 거래량 증가: 35% → ✅ 감지 (20% 이상)
```

### 📊 점수 배점
```
최대 점수: 25점
계산식: min(거래량 증가율 / 2, 25)

예시:
- 거래량 증가: 35%
- 점수: min(35 / 2, 25) = min(17.5, 25) = 17.5점
```

### 🎯 해석
- 세력이 **가격 자극 없이** 물량을 조용히 모으는 중
- 1~2주 후 급등 가능성 높음
- 개인 투자자들이 모르는 사이 매집 완료

---

## 3. 탈출 속도 (Escape Velocity)

### 📋 정의
**저항선 돌파 + 거래량 폭발 = 모멘텀 시작**

### 🔢 감지 조건 (AND 조건)
```javascript
// 파일: backend/advancedIndicators.js, Line 142-154
✅ 저항선 돌파: 종가 > 최근 25일 고점
✅ 거래량 폭발: 25일 평균 대비 2배 이상
✅ 상승 캔들: 종가 > 시가
✅ 강한 마감: Closing Strength 70% 이상
✅ 되돌림 제한: 고가 대비 낙폭 10% 미만
✅ 분석 기간: 최근 30일
```

### 📐 세부 기준

#### 3.1 저항선 계산
```javascript
// Line 121
저항선 = 최근 30일 중 초반 25일의 최고가

예시:
- 30일 중 25일 최고가: 11,500원
- 현재 종가: 11,650원
- 돌파율: +1.3% → ✅ 돌파 성공
```

#### 3.2 거래량 비율
```javascript
// Line 124-125, 149
평균 거래량 = 최근 25일 평균
거래량 비율 = 당일 거래량 / 평균 거래량

예시:
- 당일 거래량: 300,000주
- 25일 평균: 120,000주
- 거래량 비율: 2.5배 → ✅ 감지 (2배 이상)
```

#### 3.3 Closing Strength (종가 강도)
```javascript
// Line 127-130
Closing Strength = (종가 - 당일 저가) / (고가 - 저가) × 100

예시:
- 고가: 12,000원
- 저가: 11,000원
- 종가: 11,850원
- Closing Strength: (11,850 - 11,000) / 1,000 × 100 = 85%
→ ✅ 감지 (70% 이상)

해석:
- 100%: 고가 마감 (최강)
- 70~99%: 강한 마감
- 50~69%: 중립
- 0~49%: 약한 마감 (윗꼬리)
```

#### 3.4 고가 대비 낙폭 체크
```javascript
// Line 138-152
고가 대비 낙폭 = (당일 고가 - 종가) / 고가 × 100

예시:
- 고가: 12,000원
- 종가: 11,850원
- 낙폭: 1.25% → ✅ 정상 (10% 미만)

⚠️ 10% 이상: 감지 실패 (되돌림 위험)
```

#### 3.5 모멘텀 강도 계산
```javascript
// Line 157-158
모멘텀 강도 = (돌파율 × 거래량 비율 × Closing Strength)

예시:
- 돌파율: 1.3%
- 거래량 비율: 2.5
- Closing Strength: 85%
- 모멘텀: 1.3 × 2.5 × 0.85 = 2.76
```

### 📊 점수 배점
```
최대 점수: 30점
계산식: min(모멘텀 강도, 30)
```

### 🎯 해석
- **🚀 탈출 속도 달성**: 5개 조건 모두 충족 → 매수 신호
- **⚠️ 윗꼬리 과다**: 고가 대비 10% 이상 하락 → 관망
- **⚠️ 약한 마감**: Closing Strength 70% 미만 → 대기

---

## 4. 유동성 고갈 (Liquidity Drain)

### 📋 정의
**거래량 급감 + 변동성 축소 = 스프링 압축 (큰 움직임 직전)**

### 🔢 감지 조건 (AND 조건)
```javascript
// 파일: backend/advancedIndicators.js, Line 203-205
✅ 거래량 감소: -30% 이하 (최근 10일 vs 이전 20일)
✅ 변동성 감소: -20% 이하 (최근 10일 vs 이전 20일)
✅ 분석 기간: 최근 30일
```

### 📐 세부 기준

#### 4.1 거래량 감소율 계산
```javascript
// Line 187-190
최근 10일 평균 거래량 = avgVolumeRecent
이전 20일 평균 거래량 = avgVolumePrevious
거래량 감소율 = (최근 - 이전) / 이전 × 100

예시:
- 이전 평균: 200,000주
- 최근 평균: 120,000주
- 감소율: -40% → ✅ 감지 (-30% 이하)
```

#### 4.2 변동성 감소율 계산
```javascript
// Line 193-200
변동성 = 각 일자의 (고가 - 저가) / 종가 × 100 평균

예시:
- 이전 20일 변동성: 4.5%
- 최근 10일 변동성: 2.8%
- 변동성 감소: -37.8% → ✅ 감지 (-20% 이하)
```

### 📊 점수 배점
```
최대 점수: 10점
계산식: min(|거래량 감소 + 변동성 감소| / 5, 10)

예시:
- 거래량 감소: -40%
- 변동성 감소: -37.8%
- 합계: |-40 + (-37.8)| = 77.8
- 점수: min(77.8 / 5, 10) = min(15.56, 10) = 10점 (만점)
```

### 🎯 해석
- **💧 유동성 고갈**: 시장 무관심 → 곧 폭발적 움직임
- 방향: 상승/하락 모두 가능 (다른 지표와 조합 필요)
- 타이밍: 3~7일 내 큰 움직임 예상

---

## 5. 거래량 폭발 (Volume Surge)

### 📋 정의
**평소 대비 거래량 급증 (단순 거래량 비율)**

### 🔢 감지 조건
```javascript
// 파일: backend/screening.js, Line 94-100
✅ 거래량 비율 기준:
   - 5배 이상: 초대량 → 30점
   - 3배 이상: 대량 → 20점
   - 2배 이상: 급증 → 12점
   - 1.5배 이상: 증가 → 5점
✅ 비교 기준: 20일 이동평균
```

### 📐 세부 기준

#### 5.1 거래량 비율 계산
```javascript
거래량 비율 = 당일 거래량 / 20일 평균 거래량

예시:
- 당일 거래량: 450,000주
- 20일 평균: 150,000주
- 거래량 비율: 3배 → 20점 부여
```

### 📊 점수 배점
```
최대 점수: 30점

배점표:
- 5배 이상: 30점 (초대량 거래)
- 3~5배: 20점 (대량 거래)
- 2~3배: 12점 (거래량 급증)
- 1.5~2배: 5점 (거래량 증가)
- 1.5배 미만: 0점
```

### 🎯 해석
- **5배 이상**: 특별한 재료 가능성 (호재 or 악재)
- **3~5배**: 큰 손 매매 진행 중
- **2~3배**: 관심 집중, 모멘텀 시작
- **1.5~2배**: 평소보다 활발

---

## 6. 비대칭 거래량 (Asymmetric Volume)

### 📋 정의
**상승일 거래량 vs 하락일 거래량 비교 (실제 매수/매도 세력)**

### 🔢 감지 조건
```javascript
// 파일: backend/advancedIndicators.js, Line 222-250
✅ 분석 기간: 최근 20일
✅ 비율 기준:
   - 1.5배 이상: 강한 매수세
   - 0.7배 미만: 강한 매도세
   - 0.7~1.5배: 균형
```

### 📐 세부 기준

#### 6.1 비대칭 비율 계산
```javascript
// Line 230-240
상승일 = 종가 > 시가인 날
하락일 = 종가 < 시가인 날

상승일 총 거래량 = upVolume
하락일 총 거래량 = downVolume
비대칭 비율 = upVolume / downVolume

예시:
- 상승일 10일, 총 거래량: 1,800,000주
- 하락일 8일, 총 거래량: 950,000주
- 비대칭 비율: 1.89 → 📈 강한 매수세
```

### 📊 점수 배점
```
최대 점수: 10점
계산식: min(|비율 - 1| × 50 / 5, 10)

예시:
- 비율: 1.89
- 점수: |1.89 - 1| × 50 / 5 = 8.9점
```

### 🎯 해석
- **📈 비율 1.5 이상**: 세력 매집 중 (상승일 거래량 많음)
- **📉 비율 0.7 미만**: 세력 매도 중 (하락일 거래량 많음)
- **⚖️ 비율 0.7~1.5**: 균형 상태 (방향성 불분명)

---

## 7. 과열 감지 (Overheating Detection)

### 📋 정의
**고점 매수 방지 필터 (조정 위험 경고)**

### 🔢 감지 조건 (OR 조건)
```javascript
// 파일: backend/advancedIndicators.js, Line 479-508
⚠️ 과열 경고 (3개 중 1개 이상):
   - 10일간 30% 이상 급등
   - 거래량 10배 이상 초과열
   - MFI 90 이상 극과매수

⚠️ 되돌림 경고 (2개 중 1개 이상):
   - 고가 대비 낙폭 10% 이상
   - Closing Strength 50% 미만 (약한 마감)
```

### 📐 세부 기준

#### 7.1 급등률 계산
```javascript
// Line 484-486
급등률 = (현재가 - 10일 전 종가) / 10일 전 종가 × 100

예시:
- 10일 전: 8,000원
- 현재가: 11,200원
- 급등률: 40% → ⚠️ 과열 (30% 이상)
```

#### 7.2 거래량 과열
```javascript
// Line 489
거래량 비율 = 당일 거래량 / 평균 거래량

예시:
- 거래량 비율: 12배 → ⚠️ 극과열 (10배 이상)
```

#### 7.3 MFI (Money Flow Index)
```javascript
// Line 492
MFI = 거래량 반영한 RSI (0~100)

기준:
- 90 이상: 극과매수 → ⚠️ 과열
- 70~90: 과매수
- 30~70: 정상
- 30 이하: 과매도 → 매수 기회
```

#### 7.4 고가 대비 낙폭
```javascript
// Line 495-498
고가 대비 낙폭 = (당일 고가 - 종가) / 고가 × 100

예시:
- 고가: 12,000원
- 종가: 10,500원
- 낙폭: 12.5% → ⚠️ 되돌림 (10% 이상)
```

### 📊 과열도 점수 (Heat Score)
```javascript
// Line 511-523
과열도 = 0~100점 (높을수록 위험)

배점:
- 급등 50% 이상: +40점
- 급등 30~50%: +25점
- 거래량 15배 이상: +35점
- 거래량 10~15배: +20점
- MFI 95 이상: +25점
- MFI 90~95: +15점
- 낙폭 15% 이상: +30점
- 낙폭 10~15%: +20점
```

### 📊 점수 페널티
```javascript
// Line 549
종합 점수에서 차감:
- 과열 경고: -50점
- 되돌림 경고 (낙폭 10%+): -40점
- 과열 징후 (Heat Score 50+): -25점
```

### 🎯 해석
- **⚠️ 과열 종목**: 10~20% 조정 후 재진입 권장
- **⚠️ 장중 되돌림**: 익일 추가 하락 가능성, 고가 돌파 대기
- **⚠️ 과열 징후**: 소량 분할 매수 권장
- **✅ 정상 범위**: 정상 매수 가능

---

## 8. 점수 계산 체계

### 📊 종합 점수 구성 (0~100점)

```javascript
// 파일: backend/screening.js, Line 87-117

총점 = 창의적 지표 (40점) + 거래량 지표 (30점) + MFI (15점) +
       OBV (10점) + 가격 모멘텀 (5점) + 패턴 보너스 (20점) +
       과열 페널티 (-50~0점)
```

### 📐 세부 배점

#### 8.1 창의적 지표 (0~40점)
```javascript
// Line 90-91
원래 점수 = 고래(25) + 매집(25) + 탈출(30) + 고갈(10) + 비대칭(10)
            = 최대 100점

가중치 적용 = 원래 점수 × 0.4
최대 = 100 × 0.4 = 40점
```

#### 8.2 거래량 비율 (0~30점)
```javascript
// Line 94-100
거래량 비율에 따른 배점:
- 5배 이상: 30점
- 3~5배: 20점
- 2~3배: 12점
- 1.5~2배: 5점
- 1.5배 미만: 0점
```

#### 8.3 MFI (0~15점)
```javascript
// Line 103-107
MFI 값에 따른 배점:
- MFI ≤ 20 (극과매도): 15점 ← 최대 기회
- MFI ≤ 30 (과매도): 10점 ← 매수 기회
- MFI ≥ 80 (강세): 8점 ← 강한 상승세 인정
- MFI ≥ 70 (과매수): 5점 ← 상승세
- 기타: 0점
```

#### 8.4 OBV 추세 (0~10점)
```javascript
// Line 110-112
OBV (On-Balance Volume) 추세:
- 상승 추세: 10점
- 횡보 추세: 5점
- 하락 추세: 0점
```

#### 8.5 가격 모멘텀 (0~5점)
```javascript
// Line 115
현재가 vs VWAP:
- 상승세 (현재가 > VWAP): 5점
- 기타: 0점
```

#### 8.6 패턴 매칭 보너스 (0~20점)
```javascript
// 파일: backend/smartPatternMining.js, Line 256-296

완전 매칭 (100%):
- 보너스 = (패턴 승률 / 100) × 15점
- 예: 승률 80% → 12점 보너스

부분 매칭 (60~99%):
- 보너스 = (패턴 승률 / 100) × 5 × 매칭도
- 예: 승률 70%, 매칭도 80% → 2.8점 보너스

최대 합계: 20점
```

#### 8.7 과열 페널티 (-50~0점)
```javascript
// 파일: backend/advancedIndicators.js, Line 549
페널티:
- 과열 경고 (급등+초거래량+극과매수): -50점
- 되돌림 경고 (고가 대비 10%+ 하락): -40점
- 과열 징후 (Heat Score 50+): -25점
- 정상: 0점 (페널티 없음)
```

### 📊 추천 등급 기준

```javascript
// 파일: backend/screening.js, Line 127-147

S등급 (70점 이상): 🔥 최우선 매수
A등급 (55~69점): 🟢 적극 매수
B등급 (40~54점): 🟡 매수 고려
C등급 (30~39점): ⚪ 주목
D등급 (30점 미만): ⚫ 관망
```

### 🎯 등급 수정 규칙

```javascript
// Line 149-166
티어 시스템:
- watch 티어: 👁️ 관심종목 (선행지표)
- buy 티어 + 60점 이상: 🚀 매수신호 (트리거 발동)

과열 경고:
- 과열 경고 발생: ⚠️ 과열 - 조정 대기 (등급 무시)
- Heat Score 50+ : ⚠️ [원래 등급] (신중) (경고 추가)
```

---

## 📋 주기적 조정 가이드

### 🔧 조정 가능한 파라미터

#### 고래 감지
```javascript
// backend/advancedIndicators.js
Line 41: 거래량 배수 (현재 2.5배)
Line 41: 가격 변동 (현재 3%)
Line 49: 윗꼬리 기준 (현재 30%)
```

#### 조용한 매집
```javascript
Line 97: 가격 변동성 (현재 3%)
Line 97: 거래량 증가 (현재 20%)
```

#### 탈출 속도
```javascript
Line 149: 거래량 배수 (현재 2배)
Line 151: Closing Strength (현재 70%)
Line 152: 낙폭 제한 (현재 10%)
```

#### 유동성 고갈
```javascript
Line 205: 거래량 감소 (현재 -30%)
Line 205: 변동성 감소 (현재 -20%)
```

#### 거래량 폭발
```javascript
// backend/screening.js
Line 96-99: 거래량 배수별 점수
```

#### 비대칭 거래량
```javascript
// backend/advancedIndicators.js
Line 248: 강한 매수세 (현재 1.5)
Line 248: 강한 매도세 (현재 0.7)
```

#### 과열 감지
```javascript
Line 486: 급등 기준 (현재 30%)
Line 489: 거래량 기준 (현재 10배)
Line 492: MFI 기준 (현재 90)
Line 498: 낙폭 기준 (현재 10%)
```

### 📊 조정 예시

**거래량 폭발 기준 완화하기:**
```javascript
// 변경 전 (backend/screening.js:96)
if (volumeRatio >= 5) score += 30;

// 변경 후 (더 쉽게 감지)
if (volumeRatio >= 3) score += 30;  // 3배로 완화
```

**조용한 매집 기준 강화하기:**
```javascript
// 변경 전 (backend/advancedIndicators.js:97)
const isSilentAccumulation = priceVolatility < 3 && volumeGrowth > 20;

// 변경 후 (더 엄격하게)
const isSilentAccumulation = priceVolatility < 2 && volumeGrowth > 30;
```

---

## 📚 참고 자료

### 파일 위치
- **지표 정의**: `backend/advancedIndicators.js`
- **거래량 지표**: `backend/volumeIndicators.js`
- **점수 계산**: `backend/screening.js`
- **패턴 매칭**: `backend/smartPatternMining.js`

### 테스트 방법
```bash
# 로컬 테스트
curl http://localhost:3001/api/screening/recommend?limit=5

# 프로덕션 테스트
curl https://investar-xi.vercel.app/api/screening/recommend?limit=5
```

---

**Last Updated**: 2025-10-27
**Version**: 2.1
**Author**: Claude Code with @knwwhr
