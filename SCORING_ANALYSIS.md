# 점수 체계 재검토 분석 보고서 (Priority 2)

## 📊 백테스트 결과 재분석: C등급 역설

### 등급별 성과 비교 (BACKTEST_RESULTS.md 기준)

| 등급 | 점수 범위 | 샘플 수 | 승률 | 평균 수익률 | 최대 수익 | 최대 손실 |
|------|----------|---------|------|-------------|-----------|-----------|
| **S등급** | 75+ | 5 | **100%** | +8.06% | +15.45% | N/A |
| **A등급** | 58-74 | 15 | 86.67% | +24.87% | +86.97% | -7.84% |
| **B등급** | 42-57 | 45 | 77.78% | +27.5% | +82.35% | -5.95% |
| **C등급** | 25-41 | 75 | **89.33%** ⭐ | +24.89% | +86.32% | -14.4% |
| **D등급** | <25 | 5 | **100%** | +13.08% | +15.95% | N/A |

### 핵심 발견: 점수 역설

**현상**:
1. C등급 승률(89.33%) > A등급(86.67%)
2. B등급 평균 수익률(+27.5%) > A등급(+24.87%)
3. C등급이 샘플 수도 가장 많음 (75개, 51.7%)

**가설**: 점수가 높을수록 "이미 급등한 종목"일 가능성

---

## 🔬 점수 체계 분석

### 현재 구조 (실제 85점 만점)

```
기본 점수 (0-20점):
├─ 거래량 비율: 0-8점
├─ OBV 추세: 0-7점
├─ VWAP 모멘텀: 0-5점
├─ 비대칭 비율: 0-5점
└─ 고점 되돌림: -5~0점

선행 지표 (0-65점):
├─ VPD (Volume-Price Divergence): 0-25점 (38.5% 비중) ⭐
├─ 기관/외국인 수급: 0-15점 (23.1%)
├─ 합류점 (Confluence): 0-12점 (18.5%)
├─ 선행 지표 (패턴+DNA): 0-10점 (15.4%)
├─ 신호 신선도: 0-8점 (12.3%) ⭐
├─ Cup&Handle: 0-5점 (7.7%)
├─ 돌파 확인: 0-3점 (4.6%)
└─ Triangle: 0-2점 (3.1%)

총점: 최대 85점
```

### 문제 지표 분석

#### 1. VPD (Volume-Price Divergence) - 25점 (38.5%)

**현재 로직**:
```javascript
divergence = volumeRatio - priceRatio

if (divergence >= 3.0 && 가격 변동 ±10%)  → 28-35점 (조용한 매집)
if (divergence >= 2.0 && 가격 변동 ±15%)  → 20-27점 (초기 단계)
if (divergence >= 1.0)                    → 12-19점 (중간 단계)

// 페널티
if (가격 20% 이상 급등)  → -15~-25점 (이미 급등)

// 스케일링
최종 점수 = VPD 점수 × 0.714  // 35점 → 25점
```

**문제점**:
- **거래량 폭발 자체가 이미 뉴스가 난 것**
- volumeRatio 5배 = 시장 관심 집중 = 이미 상승 중
- "조용한 매집" 조건(가격 ±10%)은 실제로 드묾
- 대부분 거래량 증가 시 가격도 이미 상승 시작

**개선 방향**:
```
옵션 1: VPD 가중치 25점 → 15점 (-40%)
옵션 2: 조용한 매집 조건 강화 (가격 ±5%)
옵션 3: 거래량 비율 기준 하향 (5배 → 3배)
```

#### 2. 신호 신선도 (Freshness) - 8점 (12.3%)

**현재 로직**:
```javascript
신선한 신호 = count(신호 발생일이 D-0 또는 D-1인 지표)

신선도 점수 = 신선한 신호 개수 × 3  // 최대 15점
최종 점수 = min(신선도 점수 × 0.53, 8)
```

**문제점**:
- **D-0, D-1 신호 = 이미 급등 중**
- 선행 지표가 아니라 **동행/후행 지표**
- 오늘/어제 발생한 신호는 이미 가격에 반영됨

**개선 방향**:
```
옵션 1: 신선도 역전 (D-2~D-5 신호에 가점)
옵션 2: 신선도 가중치 8점 → 3점 (-62.5%)
옵션 3: 신선도 지표 완전 제거
```

#### 3. 기관/외국인 수급 - 15점 (23.1%)

**현재 로직**:
```javascript
if (기관 3일+ && 외국인 3일+)  → 15점 (동반 매수)
if (기관 3일+ || 외국인 3일+)  → 10점 (단독 매수)
```

**문제점**:
- **기관/외국인은 후행 지표**
- 개인보다 먼저 움직이지만, 가격 상승 후 들어옴
- 3일 연속 매수 = 이미 어느 정도 상승한 후

**개선 방향**:
```
옵션 1: 기관/외국인 가중치 15점 → 8점 (-46.7%)
옵션 2: 초기 진입 조건 추가 (1-2일 매수만 인정)
옵션 3: 누적 매수량 기준으로 변경 (연속일 대신)
```

---

## 💡 개선 제안: 3가지 옵션

### 옵션 A: 보수적 조정 (가중치 재분배)

**변경사항**:
```
VPD: 25점 → 15점 (-40%)
기관/외국인: 15점 → 8점 (-46.7%)
신선도: 8점 → 3점 (-62.5%)

절약된 27점 재분배:
├─ 패턴+DNA: 10점 → 20점 (+100%)
├─ 합류점: 12점 → 15점 (+25%)
└─ Cup&Handle: 5점 → 10점 (+100%)

새로운 총점: 85점 유지
```

**장점**:
- 기존 시스템 큰 변화 없음
- 선행 지표(패턴+DNA) 강화
- 후행 지표(VPD, 신선도, 기관) 약화

**단점**:
- 근본적 해결은 아님
- C등급 역설 일부만 해결 가능

---

### 옵션 B: 신선도 역전 (시간 가중치 역전)

**변경사항**:
```javascript
// 기존: D-0, D-1 신호에 가점
freshCount = count(신호일 === D-0 || D-1)

// 신규: D-2~D-5 신호에 가점 (선행성 강화)
leadingCount = count(D-2 <= 신호일 <= D-5)
lateCount = count(신호일 === D-0 || D-1)

if (leadingCount >= 3 && lateCount === 0)  → +8점 (진짜 선행)
if (leadingCount >= 2 && lateCount <= 1)   → +5점 (약간 선행)
if (leadingCount === 1 && lateCount === 0) → +2점 (최소 선행)
if (lateCount >= 2)                        → -3점 (후행 페널티)
```

**장점**:
- 진짜 선행 지표 포착
- D-2~D-5 신호 = 아직 급등 전
- 시간적 우위 확보

**단점**:
- 로직 복잡도 증가
- 백테스트 재검증 필요

---

### 옵션 C: 등급 체계 재정의 (점수 의미 역전)

**현재 등급** (85점 만점):
```
S: 75+ (최우선 매수) - "이미 급등 중"
A: 58-74 (적극 매수) - "상승 추세"
B: 42-57 (매수 고려) - "진입 적기"
C: 25-41 (주목) - "선행 신호" ⭐ 최고 승률
D: <25 (관망) - "신호 부족"
```

**새로운 등급** (의미 역전):
```
🔥 S등급 (25-41점): "선행 신호" - 최우선 매수
   → C등급을 S등급으로 승격
   → 거래량/기관 진입 전, 패턴만 감지
   → 승률 89.33%, 평균 +24.89%

🟢 A등급 (42-57점): "진입 적기" - 적극 매수
   → B등급을 A등급으로 승격
   → 거래량 증가 시작, 기관 초기 진입
   → 승률 77.78%, 평균 +27.5%

🟡 B등급 (58-74점): "추세 진행" - 매수 고려
   → A등급을 B등급으로 강등
   → 거래량 폭발, 기관 본격 매수
   → 승률 86.67%, 평균 +24.87%

⚠️ C등급 (75+): "과열 경고" - 단기 차익 또는 관망
   → S등급을 C등급으로 강등
   → 모든 지표 점등, 이미 급등 완료
   → 승률 100% (샘플 5개, 신뢰도 낮음)

⚫ D등급 (<25점): "신호 부족" - 관망
   → 유지
```

**구현**:
```javascript
// screening.js getRecommendation() 수정
function getRecommendation(score) {
  if (score <= 41 && score >= 25) {
    return {
      grade: 'S',
      text: '🔥 최우선 매수 (선행 신호)',
      color: '#ff4444',
      tooltip: '거래량/기관 진입 전 패턴 감지 (승률 89.3%, 평균 +24.9%)'
    };
  } else if (score >= 42 && score <= 57) {
    return {
      grade: 'A',
      text: '🟢 적극 매수 (진입 적기)',
      color: '#00cc00',
      tooltip: '거래량 증가 시작, 기관 초기 진입 (승률 77.8%, 평균 +27.5%)'
    };
  } else if (score >= 58 && score <= 74) {
    return {
      grade: 'B',
      text: '🟡 매수 고려 (추세 진행)',
      color: '#ffaa00',
      tooltip: '거래량 폭발, 기관 본격 매수 (승률 86.7%, 평균 +24.9%)'
    };
  } else if (score >= 75) {
    return {
      grade: 'C',
      text: '⚠️ 과열 경고 (단기 차익)',
      color: '#ff9900',
      tooltip: '모든 지표 점등, 단기 차익 또는 조정 대기'
    };
  } else {
    return {
      grade: 'D',
      text: '⚫ 관망 (신호 부족)',
      color: '#cccccc'
    };
  }
}
```

**장점**:
- 백테스트 결과를 그대로 반영
- 점수 계산 로직 변경 불필요
- 사용자 경험 즉시 개선

**단점**:
- 기존 사용자 혼란 가능
- 점수 의미가 직관과 반대
- 문서 전체 수정 필요

---

## 🎯 권장 방향: 옵션 A + 옵션 C 하이브리드

### Phase 1: 즉시 적용 (옵션 C)

**등급 체계 재정의** - 백테스트 결과 반영
```
C등급 (25-41점) → S등급 (🔥 최우선 매수)
B등급 (42-57점) → A등급 (🟢 적극 매수)
A등급 (58-74점) → B등급 (🟡 매수 고려)
S등급 (75+점) → C등급 (⚠️ 과열 경고)
```

**이유**:
- 코드 변경 최소 (getRecommendation() 함수만)
- 백테스트 데이터 즉시 반영
- 사용자 경험 즉시 개선

### Phase 2: 중기 개선 (옵션 A)

**가중치 재분배**
```
VPD: 25점 → 15점
기관/외국인: 15점 → 8점
신선도: 8점 → 3점

패턴+DNA: 10점 → 20점
합류점: 12점 → 15점
Cup&Handle: 5점 → 10점
```

**이유**:
- 선행 지표(패턴+DNA) 강화
- 후행 지표(VPD, 신선도) 약화
- 등급 분포 재조정

### Phase 3: 장기 개선 (옵션 B)

**신선도 로직 역전**
```
D-2~D-5 신호: +8점 (진짜 선행)
D-0~D-1 신호: -3점 (후행 페널티)
```

**이유**:
- 시간적 선행성 확보
- 급등 전 조기 포착
- 백테스트 재검증 후 적용

---

## 📋 실행 계획

### 1단계: 등급 체계 재정의 (즉시) ✅

**파일**: `backend/screening.js`
**함수**: `getRecommendation()`
**변경**: 점수 범위와 등급 의미 역전

**예상 효과**:
- C등급 종목이 S등급으로 표시 → 사용자 신뢰도 향상
- 백테스트 성과와 등급 일치 → 시스템 신뢰성 증명

### 2단계: 가중치 재분배 (1-2주 후) ⏳

**파일**: `backend/screening.js`
**변경**: VPD/신선도/기관 가중치 하향, 패턴+DNA 상향

**검증**:
- 백테스트 재실행 (옵션 A 적용 후)
- 등급 분포 변화 확인
- S등급 샘플 수 증가 기대

### 3단계: 신선도 역전 (1개월 후) ⏳

**파일**: `backend/advancedIndicators.js`
**함수**: `calculateSignalFreshness()`
**변경**: D-2~D-5 가점, D-0~D-1 감점

**검증**:
- 1개월 실제 데이터 수집
- 선행성 검증
- 백테스트 재실행

---

## 🔬 추가 분석 필요 사항

### 1. 등급별 지표 분포 분석

**목적**: 각 등급이 어떤 지표에서 점수를 얻었는지 확인

**방법**:
```javascript
// test-backtest.js 수정
const scoreBreakdown = {
  S: { vpdAvg: 0, institutionalAvg: 0, freshnessAvg: 0, ... },
  A: { vpdAvg: 0, institutionalAvg: 0, freshnessAvg: 0, ... },
  B: { vpdAvg: 0, institutionalAvg: 0, freshnessAvg: 0, ... },
  C: { vpdAvg: 0, institutionalAvg: 0, freshnessAvg: 0, ... }
};
```

**기대 결과**:
- S등급: VPD 높음, 신선도 높음, 기관 높음 → **후행 지표 집중**
- C등급: VPD 낮음, 패턴+DNA 높음 → **선행 지표 집중**

### 2. 시간대별 수익률 분석

**목적**: 보유 기간에 따른 등급별 성과 차이

**방법**:
```javascript
// 5일 보유 vs 15일 보유 vs 25일 보유
등급별 × 보유 기간별 교차 분석
```

**기대 결과**:
- S등급: 단기 수익 높음 (이미 급등 중)
- C등급: 중장기 수익 높음 (아직 급등 전)

### 3. 종목 특성 분석

**목적**: 등급별 종목 특성 차이

**항목**:
- 시가총액
- 업종
- 변동성
- 거래대금

---

## 📝 다음 단계

**즉시 실행**: 등급 체계 재정의 (옵션 C)
- `backend/screening.js` getRecommendation() 수정
- 등급 의미 역전 적용
- 프론트엔드 설명 업데이트

**후속 작업**: 가중치 재분배 (옵션 A)
- VPD/신선도/기관 가중치 하향
- 패턴+DNA 가중치 상향
- 백테스트 재실행 및 검증

**장기 과제**: 신선도 역전 (옵션 B)
- D-2~D-5 선행 신호 가점
- 실제 데이터 수집 및 검증

---

**보고서 생성 날짜**: 2025-11-14
**Priority**: 2 (Medium)
**상태**: 분석 완료, 실행 대기

**핵심 인사이트**: "점수가 낮을수록 진짜 선행 신호. C등급이 실제 S등급이었다!"
